(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["ymaps"],{10:function(t,e,n){"use strict";n.r(e),n.d(e,"mathSign",(function(){return r})),n.d(e,"mathLog2",(function(){return a})),n.d(e,"mathLog10",(function(){return s})),n.d(e,"arrayFindIndex",(function(){return _})),n.d(e,"arrayFind",(function(){return m})),n.d(e,"arrayFrom",(function(){return f})),n.d(e,"arraySome",(function(){return b})),n.d(e,"Symbol",(function(){return u})),n.d(e,"Map",(function(){return d})),n.d(e,"Set",(function(){return p})),n.d(e,"WeakMap",(function(){return h})),n.d(e,"MAX_SAFE_INTEGER",(function(){return c}));var o=n(13),i={},r=Math.sign?Math.sign.bind(Math):function(t){return t<0?-1:0===t?0:1},a=Math.log2?Math.log2.bind(Math):function(t){return Math.log(t)*Math.LOG2E},s=Math.log10?Math.log10.bind(Math):function(t){return Math.log(t)/Math.LN10},c=Number.MAX_SAFE_INTEGER||9007199254740991,u="undefined"==typeof Symbol?function(t){return"__Symbol_".concat(t,"_").concat(Date.now(),"_").concat(Math.random())}:Symbol,l=function(t){return new t([[i,1]]).has(i)?function(e){return new t(e)}:function(e){var n=new t;if(void 0!==e)for(var o=0,i=e;o<i.length;o++){var r=i[o],a=r[0],s=r[1];n.set(a,s)}return n}},d=l(Map),h=l(WeakMap),p=new Set([i]).has(i)?function(t){return new Set(t)}:function(t){var e=new Set;if(void 0!==t)for(var n=0,o=t;n<o.length;n++){var i=o[n];e.add(i)}return e};d.prototype=Map.prototype,h.prototype=WeakMap.prototype,p.prototype=Set.prototype;var _=Boolean(Array.prototype.findIndex)?function(t,e,n){return t.findIndex(e,n)}:function(t,e,n){for(var o=0;o<t.length;o++)if(e.call(n,t[o],o,t))return o;return-1},m=Boolean(Array.prototype.find)?function(t,e,n){return t.find(e,n)}:function(t,e,n){var o=_(t,e,n);return-1===o?void 0:t[o]},f=Array.from?Array.from:function(t){var e=this,n=Object(t);null==t&&Object(o.c)(new TypeError("Array.from requires an array-like object - not null or undefined"));var i=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;void 0===i||v(i)||Object(o.c)(new TypeError("Array.from: when provided, the second argument must be a function"));for(var a=g(n.length),s=v(e)?Object(new e(a)):new Array(a),c=0;c<a;){var u=n[c];s[c]=i?void 0===r?i(u,c):i.call(r,u,c):u,c+=1}return s.length=a,s},y=Object.prototype.toString;function v(t){return"function"==typeof t||"[object Function]"===y.call(t)}function g(t){var e=Number(t);return isNaN(e)||e<=0?0:Math.min(e,c)}var b=function(t,e,n){return-1!==_(t,e,n)}},100:function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return c}));var o=n(8),i=n(10),r=n(51),a=(n(35),n(108)),s=n(11),c="__root__",u=function(t){function e(e){var n=(void 0===e?{}:e).disablePointGeometry,o=t.call(this)||this;return o._features=new i.Map,o._groups=new i.Map([[c,{type:"group",id:c,style:Object(a.b)({}),children:[],parentGroupId:null}]]),o._disablePointGeometry=Boolean(n),o}return Object(o.b)(e,t),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this._groups},enumerable:!1,configurable:!0}),e.prototype.addGroup=function(t,e,n){var o={type:"group",id:t,style:Object(a.b)(e),children:[],parentGroupId:n};this._addChild(n,o),this._groups.set(t,o),this._emit("groupAdded",t),this._emit("changed")},e.prototype.removeGroupAndChildren=function(t){if(this._groups.has(t)){for(var e=this._groups.get(t),n=[e],o=[];n.length>0;){var i=n.pop();o.push(i);for(var r=0,a=i.children;r<a.length;r++){var s=a[r];"feature"===s.type?(this._features.delete(s.id),o.push(s)):n.push(s)}this._groups.delete(i.id)}e.parentGroupId&&this._removeChild(e.parentGroupId,e),this._emit("groupRemoved",{id:t,removed:o}),this._emit("changed")}},e.prototype.addFeature=function(t,e,n,o){Object(r.a)(t),this._assertPointIsAllowed(t);var i={type:"feature",id:t.id,feature:t,style:Object(a.a)(t.geometry,e),bbox:n,parentGroupId:o};this._addChild(o,i),this._features.set(i.id,i),this._emit("featureAdded",i.id),this._emit("changed")},e.prototype.removeFeatureById=function(t){if(this._features.has(t)){var e=this._features.get(t);e.parentGroupId&&this._removeChild(e.parentGroupId,e),this._features.delete(t),this._emit("featureRemoved",t),this._emit("changed")}},e.prototype.updateFeature=function(t,e,n){this._assertPointIsAllowed(t);var o=this._features.get(t.id).parentGroupId,i={type:"feature",id:t.id,feature:t,style:Object(a.a)(t.geometry,e),bbox:n,parentGroupId:o},r=this._groups.get(o),s=this._features.get(i.id),c=r.children.indexOf(s);r.children[c]=i,this._features.set(i.id,i),this._emit("featureUpdated",i.id),this._emit("changed")},e.prototype.hasFeatureWithId=function(t){return this._features.has(t)},e.prototype.moveFeatureToGroup=function(t,e){var n=this._features.get(t);n.parentGroupId!==e&&(this._removeChild(n.parentGroupId,n),this._addChild(e,n),n.parentGroupId=e,this._emit("featureMovedToGroup",t),this._emit("changed"))},e.prototype._addChild=function(t,e){this._groups.get(t).children.push(e)},e.prototype._removeChild=function(t,e){var n=this._groups.get(t),o=n.children.indexOf(e);n.children.splice(o,1)},e.prototype._assertPointIsAllowed=function(t){if(this._disablePointGeometry&&"Point"===t.geometry.type)throw new Error('Unexpected geometry type: "'.concat(t.geometry.type,'"'))},e}(Object(s.a)().with())},101:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var o=n(8),i=n(10),r=n(11),a=function(t){function e(e){var n=t.call(this)||this;return n._tiles=new i.Map,n.setSource(e),n}return Object(o.b)(e,t),Object.defineProperty(e.prototype,"priority",{get:function(){return this._source.priority},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"workerUrl",{get:function(){return this._source.workerUrl},enumerable:!1,configurable:!0}),e.prototype.setSource=function(t){this._source=t,this._emit("changed")},e.prototype.addRootTile=function(t,e,n,o){var i={uri:t,tile:e,buildingObjectIds:n,detalizationFactor:o};this._tiles.set(t,i),this._emit("rootTileAdded",i)},e.prototype.removeRootTile=function(t){this._tiles.delete(t)&&this._emit("rootTileRemoved",t)},e}(Object(r.a)().with())},107:function(t,e,n){"use strict";var o=n(8);function i(t,e){return t===e?null:{old:t,new:e}}var r=n(79),a=n(64),s=n(83),c=n(11);n(35);n.d(e,"a",(function(){return u})),n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return d}));var u=function(t){function e(e,n){var o=t.call(this)||this;return o._makeFields=function(t,e){return{tileSize:(null==e?void 0:e.size)||r.c,transparent:Boolean(null==e?void 0:e.transparent),clampMapZoom:Boolean(t.clampMapZoom),zoomRange:t.zoomRange||Object(a.c)(),fetchHotspots:null==e?void 0:e.fetchHotspots,hotspotAbortRadius:(null==e?void 0:e.hotspotAbortRadius)||r.a,vectorHotspots:t.vector&&t.vector.hotspots||{},awaitAllTilesOnFirstDisplay:Boolean(null==e?void 0:e.awaitAllTilesOnFirstDisplay)}},o.setSource(e),o.worldOptions=n,o}return Object(o.b)(e,t),Object.defineProperty(e.prototype,"rasterSourceDescription",{get:function(){return this._source.raster},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vectorSourceDescription",{get:function(){return this._source.vector},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalFindHostpotInPosition",{get:function(){var t;return null===(t=this._source.raster)||void 0===t?void 0:t._internalFindHotspotInPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vectorHotspots",{get:function(){return this._fields.vectorHotspots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRange",{get:function(){return this._fields.zoomRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clampMapZoom",{get:function(){return this._fields.clampMapZoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparent",{get:function(){return this._fields.transparent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileSize",{get:function(){return this._fields.tileSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fetchHotspots",{get:function(){return this._fields.fetchHotspots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hotspotAbortRadius",{get:function(){return this._fields.hotspotAbortRadius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"awaitAllTilesOnFirstDisplay",{get:function(){return this._fields.awaitAllTilesOnFirstDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileRevealDuration",{get:function(){var t,e;return Math.max(null!==(e=null===(t=this._source.raster)||void 0===t?void 0:t.tileRevealDuration)&&void 0!==e?e:200,0)},enumerable:!1,configurable:!0}),e.prototype.getHotspotTileDataSource=function(){return this._rasterSource.fetchHotspots?{fetchHotspots:this._rasterSource.fetchHotspots,hotspotAbortRadius:this._rasterSource.hotspotAbortRadius||r.a,tileSize:this._rasterSource.size||r.c,inset:void 0===this._rasterSource.hotspotInset?r.b:this._rasterSource.hotspotInset,padding:this._rasterSource.hotspotPadding||0,zoomRange:this.zoomRange,internalFindHotspotInPosition:this.internalFindHostpotInPosition}:null},e.prototype.setSource=function(t){var e,n=this._makeFields(t,t.raster),r=Object(o.a)(Object(o.a)({},function(t,e){for(var n={},o=0,r=Object.keys(t);o<r.length;o++){var a=r[o];n[a]=i(t[a],e[a])}return n}(this._fields||{},n)),{fetchTile:i(this._rasterSource&&this._rasterSource.tileUrl,null===(e=t.raster)||void 0===e?void 0:e.tileUrl)});this._source=t,this._fields=n,t.raster&&(this._rasterSource=t.raster,"string"==typeof this._rasterSource.tileUrl&&(this._tileUrlGenerator=l(this._rasterSource.tileUrl))),this._emit("changed"),this._emit("sourceChanged",r)},e.prototype.generateTileUrl=function(t,e,n,o){var i=this.fitTileIntoWorld(t,e,n);if(!i)return null;var r=i.x,a=i.y;return this._tileUrlGenerator(r,a,n,o)},e.prototype.fitTileIntoWorld=function(t,e,n){var o=Object(s.d)(n,this.tileSize);return Object(s.f)({x:t,y:e},o,this.worldOptions)?Object(s.h)({x:t,y:e},o):null},e}(Object(c.a)().with());function l(t){return function(e,n,o,i){return t.replace("{{x}}",String(e)).replace("{{y}}",String(n)).replace("{{z}}",String(o)).replace("{{scale}}",String(i)).replace(/\{\{d\|(\d+)\}\}/,(function(t,i){var r=(e+n+o)%Number(i)+1;return String(r)}))}}function d(t,e){return t.fetchHotspots===e.fetchHotspots&&t.hotspotAbortRadius===e.hotspotAbortRadius&&t.tileSize===e.tileSize}},108:function(t,e,n){"use strict";var o=n(8),i=n(10);n.d(e,"c",(function(){return c})),n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return d}));var r={width:1,opacity:1,color:"rgb(0,102,255)",palette:[],simplifyPalette:!0,dash:[]},a={url:"No icon url provided",offset:[0,0],scale:1},s={zIndex:0,opacity:1};function c(t){var e=Object(o.a)(Object(o.a)({},r),t);return Object(o.a)(Object(o.a)({},e),{dash:Object(o.c)([],e.dash,!0),paletteColors:[]})}function u(t,e){var n=e.stroke||[r],s="LineString"===t.type?function(t,e){for(var n=t.coordinates.length-1,o=[],r=[],a=new i.Set,s=[],u=0,l=e;u<l.length;u++){var d=l[u],h=d.palette,p=c(d);if(r.push(p),h&&0!==h.length){for(var _=new i.Map,m=0,f=0;f<h.length;f++){var y=h[f],v=y.count,g=y.color;_.set(m,g),m+=v;var b=f===h.length-1||m>n;if(b||g!==h[f+1].color){var S=b?n:m;if(a.has(S)||(a.add(S),s.push(S)),b)break}}o.push({stopsColors:_,paletteColors:p.paletteColors})}}s.sort((function(t,e){return t-e}));for(var x=0,O=o;x<O.length;x++){var E=O[x],z=(_=E.stopsColors,E.paletteColors);z.push(_.get(0));for(f=0;f<s.length-1;f++){g=_.get(s[f]);z.push("string"==typeof g?g:z[z.length-1])}}return{paletteColorStops:s,stroke:r}}(t,n):{paletteColorStops:[],stroke:n.map(c)},u=s.stroke,d=s.paletteColorStops;return{zIndex:l(e.zIndex,0),fill:e.fill||"rgb(0,102,255)",fillOpacity:l(e.fillOpacity,.6),fillRule:e.fillRule||"evenodd",stroke:u,paletteColorStops:d,cursor:e.cursor||"inherit",interactive:l(e.interactive,!0),simplificationRate:l(e.simplificationRate,2),icon:Object(o.a)(Object(o.a)({},a),e.icon)}}function l(t,e){return void 0!==t?t:e}function d(t){return Object(o.a)(Object(o.a)({},s),t)}},11:function(t,e,n){"use strict";var o=n(8),i=n(10),r=(n(35),Object(i.Symbol)("EventEmitter")),a=Object(i.Symbol)("EventEmitter.MixinConstructor"),s=Object(i.Symbol)("EventEmitter.MixinPrototype"),c=function(){function t(){}return t[a]=function(t){t._eventListenersHash={}},t[s]=function(e){e[r]=t.prototype[r],e.group=t.prototype.group,e.on=t.prototype.on,e.offSingle=t.prototype.offSingle,e._emit=t.prototype._emit},t.prototype.on=function(t,e){return this.group().on(t,e)},t.prototype.offSingle=function(t,e){var n=this._eventListenersHash[t];n&&n.delete(e)},t.prototype.group=function(){return new t._eventGroupImpl(this)},t.prototype._emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=this._eventListenersHash[t];if(o){var i=[];o.forEach((function(t){return i.push(t)}));for(var r=0,a=i;r<a.length;r++){var s=a[r];s(e[0])}}},t._eventGroupImpl=function(){function t(t){this._listeners=[],this._emitter=t}return t.prototype.on=function(t,e){var n=this._emitter._eventListenersHash[t];return n?n.add(e):(this._emitter._eventListenersHash[t]=new i.Set,this._emitter._eventListenersHash[t].add(e)),this._listeners.push([t,e]),this},t.prototype.offAll=function(){for(var t=0,e=this._listeners;t<e.length;t++){var n=e[t],o=n[0],i=n[1];this._emitter._eventListenersHash[o].delete(i)}this._listeners=[]},t}(),t}();c.prototype[r]=!0,n.d(e,"a",(function(){return l}));var u=function(){},l=function(t){return void 0===t&&(t=u),{with:function(){if(e=t.prototype,Boolean(e&&e[r]))return t;var e,n=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=t.apply(this,e)||this;return c[a](o),o}return Object(o.b)(e,t),e}(t);return c[s](n.prototype),n}}}},126:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(16);function i(){return Object(o.b)(devicePixelRatio,1,3)}},127:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var o={tilesLoaded:0,tilesReady:0,tilesTotal:0,borderLoaded:0,borderReady:0,borderTotal:0,graphicsReady:0,graphicsTotal:0}},128:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var o=n(8),i=n(11),r=n(127),a=function(t){function e(e){var n=t.call(this)||this;return n.state=r.a,n}return Object(o.b)(e,t),e.prototype.findObjectInPosition=function(t){return null},e.prototype._requestRender=function(){this._emit("requestRender")},e.prototype.update=function(t){},e.prototype.resize=function(t){},e.prototype.render=function(t){},e}(Object(i.a)().with())},16:function(t,e,n){"use strict";function o(t,e,n){return t-Math.floor((t-e)/(n-e))*(n-e)}function i(t,e,n){return Math.max(Math.min(t,n),e)}n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return i}))},17:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var o=n(8),i=n(10),r=n(16),a=n(12),s={getScale:function(t,e){return Math.pow(2,e-t)},getWorldPixelSize:function(t){return 256*Math.pow(2,t)},worldToPixels:function(t,e){var n=Math.pow(2,e)/2*256;return a.muln({x:t.x+1,y:1-t.y},n)},worldToRelativePixels:function(t,e){var n=Math.pow(2,e)/2*256;return a.mulv(t,{x:n,y:-n})},worldToTile:function(t,e,n){var o=s.worldToPixels(t,e);return a.divn(o,n)},moveCloseToCenter:function(t,e,n){n=n||t;var o=a.sub(t,e).x;return Math.abs(o)>1?a.add(n,{x:-2*Object(i.mathSign)(o),y:0}):n},convertPixelSizeToWorldSize:function(t,e,n){var o=Math.pow(2,e)/2*256;return a.divv(t,{x:o,y:-o},n)},pixelsToWorld:function(t,e){var n=Math.pow(2,e)/2*256;return{x:t.x/n-1,y:1-t.y/n}},fitViewportToWorld:function(t,e){var n=e.zoom,o=e.worldOptions,i=e.size,r=void 0===i?a.ORIGIN:i;if(o.cycledX&&o.cycledY)return t;var u=s.convertPixelSizeToWorldSize(r,n);return{x:c(t.x,u.x,o.cycledX),y:c(t.y,-u.y,o.cycledY)}},restrictToZeroWorld:function(t,e){var n=Object(o.a)({},t);return e.cycledX&&(n.x=Object(r.a)(n.x,-1,1)),e.cycledY&&(n.y=Object(r.a)(n.y,-1,1)),n},computePixelPerfectWorldCoordinates:function(t,e,n,o,i){void 0===o&&(o=1),void 0===i&&(i={x:0,y:0});var r=s.getWorldPixelSize(e)/2*o*n;return a.applyFunction(t,(function(t){return Math.round(t*r)/r}),i)}};function c(t,e,n){var o=e/2;return n?Object(r.a)(t,-1,1):Object(r.b)(t,Math.min(0,o-1),Math.max(0,1-o))}},21:function(t,e,n){"use strict";var o=n(8),i=n(12),r=n(65),a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function s(){return new Array(16)}function c(t,e){void 0===e&&(e=s());for(var n=0;n<16;++n)e[n]=t[n];return e}function u(t,e,n){void 0===n&&(n=s());for(var o=0;o<16;o+=4)for(var i=t[o],r=t[o+1],a=t[o+2],c=t[o+3],u=0;u<4;++u)n[o+u]=i*e[u]+r*e[4+u]+a*e[8+u]+c*e[12+u];return n}var l=c(a);function d(t,e,n){void 0===n&&(n=r.e(0,0,0));var o=t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15],i=(t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12])/o,a=(t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13])/o,s=(t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14])/o;return n.x=i,n.y=a,n.z=s,n}var h=n(17),p=n(13);function _(t,e){var n=e.container.getBoundingClientRect();return f({x:t.x-n.left,y:t.y-n.top},e)}function m(t,e){var n=y(t,e),o=e.container.getBoundingClientRect();return i.add(n,{x:o.left,y:o.top},n),n}function f(t,e){var n=e.size,i=e.zoom,a=e.worldCenter,s=e.azimuth,c=e.tilt,u=e.fov,l=Math.tan(.5*u),d={x:0,y:0,z:v(-h.a.convertPixelSizeToWorldSize(n,i).y,u)};r.k(d,c,d),r.l(d,s,d),r.c(d,Object(o.a)(Object(o.a)({},a),{z:0}),d);var _=n.x/n.y,m=r.e(l*_,l,1),f={x:2*(t.x-n.x/2)/n.x,y:2*(n.y/2-t.y)/n.y,z:-1};r.i(f,m,f),r.k(f,c,f),r.l(f,s,f);var y=r.h(r.b,{origin:d,direction:f});return y||Object(p.c)(new Error("Pointer above the horizon.")),y}function y(t,e){var n=e.size,p=e.zoom,_=e.worldCenter,m=e.azimuth,f=e.tilt,y=e.fov,g=h.a.convertPixelSizeToWorldSize(n,p),b=i.divn(g,2),S=v(-g.y,y),x={x:0,y:0,z:S};r.k(x,f,x),r.l(x,m,x),r.c(x,Object(o.a)(Object(o.a)({},_),{z:0}),x);var O=function(t,e,n,o,i){void 0===i&&(i=s());var a=r.m(e,n);r.j(a,a);var c=r.f(o,a);r.j(c,c);var d=r.f(a,c);return l[0]=c.x,l[1]=d.x,l[2]=a.x,l[4]=c.y,l[5]=d.y,l[6]=a.y,l[8]=c.z,l[9]=d.z,l[10]=a.z,l[12]=-r.g(c,e),l[13]=-r.g(d,e),l[14]=-r.g(a,e),u(t,l,i)}(a,x,Object(o.a)(Object(o.a)({},_),{z:0}),r.l({x:0,y:1,z:0},m));if(f>0){var E=-b.y*Math.sin(f),z=-E-S,w=E-S,j=b.x/-b.y,R=function(t,e,n,o,i,r){void 0===r&&(r=s());for(var a=1/Math.tan(.5*e),c=a/n,u=(o+i)/(o-i),l=2*o*i/(o-i),d=0;d<16;d+=4){r[d]=t[d]*c,r[d+1]=t[d+1]*a;var h=t[d+2],p=t[d+3];r[d+2]=h*u+p*l,r[d+3]=-h}return r}(c(a),y,j,z,w);return R[0]=R[0]*n.x/2,R[5]=R[5]*(-n.y/2),R[8]=-n.x/2,R[9]=-n.y/2,d(u(O,R),Object(o.a)(Object(o.a)({},t),{z:0}))}var C=d(O,Object(o.a)(Object(o.a)({},t),{z:0})),T=i.add(C,b);return h.a.worldToRelativePixels(T,p)}function v(t,e){return.5*t/Math.tan(.5*e)}n.d(e,"c",(function(){return _})),n.d(e,"e",(function(){return m})),n.d(e,"b",(function(){return f})),n.d(e,"d",(function(){return y})),n.d(e,"a",(function(){return v}))},230:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var o=n(8),i=n(10),r=n(25),a=n(83),s=n(11),c=n(46),u=n(98),l=n(17),d=n(51),h=n(16),p=n(12),_=n(13),m=function(){},f=function(t){function e(e,n,o,r,a,s){var c=t.call(this)||this;return c._newTiles=new i.Map,c._loadingTiles=new i.Map,c._readyTiles=new i.Map,c._size=e,c._camera=n,c._tileSource=o,c._zoomRoundingRule=s,c._worldOptions=a,c._queue=r,c}return Object(o.b)(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return{tilesLoaded:0,tilesReady:0,tilesTotal:0,borderTotal:0,borderLoaded:0,borderReady:0,graphicsTotal:0,graphicsReady:0}},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._loadingTiles.forEach((function(t){t.abortController.abort()}))},e.prototype.preloadHotspotsInPoint=function(t){for(var e=this._zoomRoundingRule(this._camera.zoom),n=!1,o=0,i=this._computeAffectedTiles(t,e);o<i.length;o++){var r=i[o],s=Object(a.e)(r,r.zoom);this._isTileDataReadyOrLoading(s)||this._newTiles.has(s)||(this._newTiles.set(s,{id:r}),n=!0)}var c=this._stopLoadingTilesOutsideRadius(t);(n||c)&&this._emit("hotspotsChanged"),n&&this._emit("requestRender")},e.prototype.preloadHotspotsForViewport=function(){for(var t=this,e=!1,n=0,o=this._getTilesForViewport().filter((function(e){return!t._isTileDataReadyOrLoading(Object(a.e)(e,e.zoom))}));n<o.length;n++){var i=o[n],r=Object(a.e)(i,i.zoom);this._isTileDataReadyOrLoading(r)||this._newTiles.has(r)||(this._newTiles.set(r,{id:i}),e=!0)}e&&(this._emit("hotspotsChanged"),this._emit("requestRender"))},e.prototype.resize=function(t){p.areEqual(t,this._size)||(this._size=t,this._removeTilesOutsideViewport()&&this._emit("hotspotsChanged"))},e.prototype.update=function(t,e){var n=t.worldCenter,o=t.zoom;n===this._camera.worldCenter&&o===this._camera.zoom||(this._camera=t,this._removeTilesOutsideViewport()&&this._emit("hotspotsChanged"))},e.prototype.render=function(t){var e=this;t.qualityHint<c.a.FULL||this._camera.zoom<this._tileSource.zoomRange.min||this._camera.zoom>this._tileSource.zoomRange.max||(this._newTiles.forEach((function(t){var n=Object(a.e)(t.id,t.id.zoom),i=e._loadTile(t);e._loadingTiles.set(n,i),Object(r.promiseFinally)(i.promise.then((function(r){var a=r.map((function(n){return"world"===n.type?n:function(t,e,n){var o=p.muln(e,n);return{type:"world",feature:t.feature,geometry:Object(d.d)(t.geometry,(function(t){return l.a.pixelsToWorld(p.add(t,o),e.zoom)}))}}(n,t.id,e._tileSource.tileSize)})),s=e._zoomRoundingRule(e._camera.zoom),c=e._tileSource.padding/l.a.getWorldPixelSize(s),u=0===e._tileSource.padding?a:a.map((function(t){return Object(o.a)(Object(o.a)({},t),{geometry:v(t.geometry,c)})}));e._readyTiles.set(n,{id:i.id,hotspots:u}),e._emit("hotspotsChanged")})),(function(){return e._loadingTiles.delete(n)})).catch((function(t){t&&"AbortError"===t.name||Object(_.c)(t)}))})),this._newTiles.clear())},e.prototype.findObjectInPosition=function(t){for(var e,n,o=l.a.restrictToZeroWorld(t,this._worldOptions),i=this._zoomRoundingRule(this._camera.zoom),r=!0,s=0,c=this._computeAffectedTiles(o,i);s<c.length;s++){var d=c[s],h=this._readyTiles.get(Object(a.e)(d,i));if(h)for(var p=h.hotspots.length-1;p>=0;p--){var _=h.hotspots[p];if(Object(u.a)(_.geometry,o))return{type:"raw-hotspot",feature:_.feature}}else r=!1}var m=null===(n=(e=this._tileSource).internalFindHotspotInPosition)||void 0===n?void 0:n.call(e,o,i);return m||(r?null:void 0)},e.prototype._stopLoadingTilesOutsideRadius=function(t){var e=this._zoomRoundingRule(this._camera.zoom),n=p.divn(l.a.worldToPixels(t,e),this._tileSource.tileSize),o=Math.max(this._tileSource.hotspotAbortRadius,this._tileSource.inset)/this._tileSource.tileSize;return y(this._loadingTiles,(function(t){return function(t,e,n){var o=p.create(Object(h.b)(e.x,t.x,t.x+1),Object(h.b)(e.y,t.y,t.y+1));return p.sub(o,e,o),p.length2(o)<=Math.pow(n,2)}(t.id,n,o)}),(function(t){return t.abortController.abort()}))},e.prototype._removeTilesOutsideViewport=function(){var t=this._zoomRoundingRule(this._camera.zoom),e=l.a.getScale(t,this._camera.zoom),n=p.create(this._size.x+2*this._tileSource.inset,this._size.y+2*this._tileSource.inset),o=l.a.worldToPixels(this._camera.worldCenter,t),i=Object(a.a)(o,n,e,this._tileSource.tileSize),r=function(e){var n=e.id;return n.zoom===t&&n.x<=i.maxX&&n.x+1>=i.minX&&n.y<=i.maxY&&n.y+1>=i.minY},s=y(this._newTiles,r),c=y(this._loadingTiles,r,(function(t){return t.abortController.abort()})),u=y(this._readyTiles,r);return s||c||u},e.prototype._isTileDataReadyOrLoading=function(t){return this._loadingTiles.has(t)||this._readyTiles.has(t)},e.prototype._getTilesForViewport=function(){for(var t=this._zoomRoundingRule(this._camera.zoom),e=l.a.getScale(t,this._camera.zoom),n=l.a.worldToPixels(this._camera.worldCenter,t),o=Object(a.a)(n,this._size,e,this._tileSource.tileSize),i=[],r=o.minX;r<=o.maxX;r++)for(var s=o.minY;s<=o.maxY;s++)i.push({x:r,y:s,zoom:t});return i},e.prototype._loadTile=function(t){var e=this,n=Object(a.d)(t.id.zoom,this._tileSource.tileSize),o=p.applyFunction(t.id,(function(t){return Object(h.a)(t,0,n)})),i=this._queue.enqueue((function(n){var i=e._tileSource.fetchHotspots;return!n.aborted&&i?Promise.resolve(i(o.x,o.y,t.id.zoom,n)).catch((function(t){return Object(_.c)(t)})):Promise.resolve([])})),r=i.promise,s=i.abortController;return{id:t.id,abortController:s,promise:r}},e.prototype._computeAffectedTiles=function(t,e){var n=l.a.worldToTile(t,e,this._tileSource.tileSize),o=p.applyFunction(n,Math.floor),i=p.sub(n,o);p.muln(i,this._tileSource.tileSize,i);var r=i.x<this._tileSource.inset,a=i.x>this._tileSource.tileSize-this._tileSource.inset,s=i.y<this._tileSource.inset,c=i.y>this._tileSource.tileSize-this._tileSource.inset,u=[{x:o.x,y:o.y,zoom:e}];return r&&u.push({x:o.x-1,y:o.y,zoom:e}),a&&u.push({x:o.x+1,y:o.y,zoom:e}),s&&u.push({x:o.x,y:o.y-1,zoom:e}),c&&u.push({x:o.x,y:o.y+1,zoom:e}),r&&s&&u.push({x:o.x-1,y:o.y-1,zoom:e}),r&&c&&u.push({x:o.x-1,y:o.y+1,zoom:e}),a&&s&&u.push({x:o.x+1,y:o.y-1,zoom:e}),a&&c&&u.push({x:o.x+1,y:o.y+1,zoom:e}),u},e}(Object(s.a)().with());function y(t,e,n){void 0===n&&(n=m);var o=!1;return t.forEach((function(i,r){e(i)||(n(i),t.delete(r),o=!0)})),o}function v(t,e){if("Polygon"!==t.type)return t;for(var n=t.coordinates[0],o=n.reduce((function(t,e){return p.add(t,e,t)}),p.create(0,0)),i=p.divn(o,n.length),r=1+e/n.reduce((function(t,e){return Math.max(t,p.length(p.sub(e,i)))}),0),a=0,s=n;a<s.length;a++){var c=s[a],u=p.sub(c,i);p.muln(u,r,u),p.add(u,i,c)}return t}},25:function(t,e,n){"use strict";n.r(e),n.d(e,"queueMicrotask",(function(){return r})),n.d(e,"Promise",(function(){return o})),n.d(e,"promiseFinally",(function(){return a}));var o=Promise,i=o.resolve(),r=function(t){return i.then(t)},a=function(t,e){var n=Promise.resolve(t);return"finally"in n?n.finally(e):n.then((function(t){return Promise.resolve(e()).then((function(){return Promise.resolve(t)}))}),(function(t){return Promise.resolve(e()).then((function(){return Promise.reject(t)}))}))}},35:function(t,e,n){"use strict";var o=n(8);!function(t){function e(e){var n=t.call(this,e)||this;return n.name="AssertionError",n}Object(o.b)(e,t)}(Error)},46:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return o}));var o,i=n(8),r=n(11),a=n(81),s=n(13);!function(t){t[t.QUICK=1]="QUICK",t[t.INTERMEDIATE=2]="INTERMEDIATE",t[t.FULL=3]="FULL"}(o||(o={}));var c=function(t){function e(){var e=t.call(this)||this;return e._rafId=0,e._animationsCounter=0,e._framesSinceIntermediateRendering=0,e._renderFrame=function(){e._rafId=0,e._updateIsRequested=!1;var t=Date.now();try{e._emit("beforeRender",t);var n=e._getQualityForCurrentFrame();e._emit("render",{time:t,qualityHint:n})}catch(o){o&&"object"==typeof o&&e._lastTriggerStack&&(o.additionalInfo=e._lastTriggerStack),Object(s.c)(o)}e._isRunning&&e._requestFrame()},e._updateIsRequested=!1,e._isRunning=!1,e}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isRunning},enumerable:!1,configurable:!0}),e.prototype.start=function(){this._isRunning=!0,this._requestFrame(),this._lastTriggerStack=(new Error).stack},e.prototype.stop=function(){this._isRunning&&(this._isRunning=!1,this._updateIsRequested||this._cancelFrame(),this._lastTriggerStack=void 0)},e.prototype.renderImmediately=function(t){var e=Date.now();this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._updateIsRequested=!1,this._emit("beforeRender",e),this._emit("render",{time:e,qualityHint:t})},e.prototype.update=function(){this._isRunning||(this._lastTriggerStack=(new Error).stack),this._updateIsRequested=!0,this._requestFrame()},e.prototype.destroy=function(){this._cancelFrame()},e.prototype.animate=function(t){var e=this;0===this._animationsCounter&&this.start(),this._animationsCounter++;var n=!0,o=this.on("beforeRender",(function(i){n?t(i):(o.offAll(),e._animationsCounter--,0===e._animationsCounter&&e.stop())})),i=new a.b;return{complete:i.promise,get isRunning(){return n},stop:function(){n?(n=!1,i.resolve()):console.warn("Trying to stop animation twice")}}},e.prototype.animateForDuration=function(t,e){var n=-1,o=this.animate((function(i){if(n<0)n=i;else{var r=(i-n)/e;r<1?t(r):(t(1),o.stop())}}));return o},e.prototype._requestFrame=function(){this._rafId||(this._rafId=requestAnimationFrame(this._renderFrame))},e.prototype._cancelFrame=function(){cancelAnimationFrame(this._rafId),this._rafId=0},e.prototype._getQualityForCurrentFrame=function(){return this._isRunning?this._framesSinceIntermediateRendering<12?(this._framesSinceIntermediateRendering++,o.QUICK):(this._framesSinceIntermediateRendering=1,o.INTERMEDIATE):(this._framesSinceIntermediateRendering=0,o.FULL)},e}(Object(r.a)().with())},486:function(t,e,n){},501:function(t,e,n){"use strict";n.r(e),n.d(e,"EventBlockerLayer",(function(){return i}));var o=n(4),i=function(t){function e(e){var n;return(n=t.call(this,e)||this).element=document.createElement("div"),n.element.style.width="100%",n.element.style.height="100%",n.element.style.position="absolute",n.element.style.top="0",n.element.style.left="0",n}Object(o.a)(e,t);var n=e.prototype;return n.findObjectInPosition=function(){return{type:"empty-object"}},n.destroy=function(){},e}(n(128).a)},502:function(t,e,n){function o(){var t;this.getSetting=function(t){var e=this._errorSettings[t];return null===e?null:e||""},function(t,e){var n={client:["690.2354",1e3,100,0],uncaught:["690.2361",100,10,0],external:["690.2854",100,10,0],script:["690.2609",100,10,0]},o={};e.ERROR_LEVEL={INFO:"info",DEBUG:"debug",WARN:"warn",ERROR:"error",FATAL:"fatal"},e._errorSettings={clck:"https://yandex.ru/clck/click",beacon:!0,project:"unknown",page:"",env:"",experiments:[],additional:{},platform:"",region:"",dc:"",host:"",service:"",level:"",version:"",yandexuid:"",coordinates_gp:"",referrer:!0,preventError:!1,unhandledRejection:!1,uncaughtException:!0,debug:!1,limits:{},silent:{},filters:{},pageMaxAge:864e6,initTimestamp:+new Date};var i=!1;function r(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function a(t){return"boolean"==typeof t&&(t=+t),"number"==typeof t?t+"":null}e.initErrors=function(n){r(e._errorSettings,n),!i&&e._errorSettings.uncaughtException&&(!function(){var n=e._errorSettings;if(t.addEventListener)t.addEventListener("error",s),n.resourceFails&&t.addEventListener("error",c,!0),"Promise"in t&&n.unhandledRejection&&t.addEventListener("unhandledrejection",(function(t){var e,n=t.reason,o={};n&&(n.stack&&n.message?e=n.message:"[object Event]"===(e=String(n))?e="event.type: "+n.type:"[object Object]"===e&&(o.unhandledObject=n),n.target&&n.target.src&&(o.src=n.target.src),s({message:"Unhandled rejection: "+e,stack:n.stack,additional:o}))}));else{var o=t.onerror;t.onerror=function(t,e,n,i,r){s({error:r||new Error(t||"Empty error"),message:t,lineno:n,colno:i,filename:e}),o&&o.apply(this,arguments)}}}(),i=!0)},e.updateErrors=function(t){r(e._errorSettings,t)},e.updateAdditional=function(t){e._errorSettings.additional=r(e._errorSettings.additional||{},t)},e._handleError=function(t,i){var r,a,s=e._errorSettings;if(s.preventError&&t.preventDefault&&t.preventDefault(),i)r=t,a="client";else{r=e._normalizeError(t),a=r.type;var c=s.onError;"function"==typeof c&&c(r);var u=s.transform;"function"==typeof u&&(r=u(r))}var l=+new Date,d=s.initTimestamp,h=s.pageMaxAge;if(!(-1!==h&&d&&d+h<l)){var p=n[a][1];"number"==typeof s.limits[a]&&(p=s.limits[a]);var _=n[a][2];"number"==typeof s.silent[a]&&(_=s.silent[a]);var m=n[a][3];if(m<p||-1===p){r.path=n[a][0];var f=e._getErrorData(r,{silent:m<_||-1===_?"no":"yes",isCustom:Boolean(i)},s),y=function(t){o[r.message]=!1,e._sendError(t.path,t.vars),n[a][3]++}.bind(this,f);if(void 0===s.throttleSend)y();else{if(o[r.message])return;o[r.message]=!0,setTimeout(y,s.throttleSend)}}}},e._getReferrer=function(e){var n=e.referrer,o=typeof n;return"function"===o?n():"string"===o&&n?n:!1!==n&&t.location?t.location.href:void 0},e._buildExperiments=function(t){return t instanceof Array?t.join(";"):""},e._buildAdditional=function(t,e){var n="";try{var o=r(r({},t),e);0!==Object.keys(o).length&&(n=JSON.stringify(o))}catch(i){}return n},e._getErrorData=function(n,o,i){o=o||{};var r=e._buildExperiments(i.experiments),s=e._buildAdditional(i.additional,n.additional),c={"-stack":n.stack,"-url":n.file,"-line":n.line,"-col":n.col,"-block":n.block,"-method":n.method,"-msg":n.message,"-env":i.env,"-external":n.external,"-externalCustom":n.externalCustom,"-project":i.project,"-service":n.service||i.service,"-page":n.page||i.page,"-platform":i.platform,"-level":n.level,"-experiments":r,"-version":i.version,"-region":i.region,"-dc":i.dc,"-host":i.host,"-yandexuid":i.yandexuid,"-coordinates_gp":n.coordinates_gp||i.coordinates_gp,"-referrer":e._getReferrer(i),"-source":n.source,"-sourceMethod":n.sourceMethod,"-type":o.isCustom?n.type:"","-additional":s,"-adb":a(Ya.blocker)||a(i.blocker),"-cdn":t.YaStaticRegion,"-ua":navigator.userAgent,"-silent":o.silent,"-ts":+new Date,"-init-ts":i.initTimestamp};return i.debug&&t.console&&console[console[n.level]?n.level:"error"]("[error-counter] "+n.message,c,n.stack),{path:n.path,vars:c}},e._baseNormalizeError=function(t){var e=(t=t||{}).error,n=t.filename||t.fileName||"",o=e&&e.stack||t.stack||"",i=t.message||"",r=e&&e.additional||t.additional;return{file:n,line:t.lineno||t.lineNumber,col:t.colno||t.colNumber,stack:o,message:i,additional:r}},e._normalizeError=function(t){var n=e._baseNormalizeError(t),o="uncaught",i=e._isExternalError(n.file,n.message,n.stack),r="",a="";return i.hasExternal?(o="external",r=i.common,a=i.custom):/^Script error\.?$/.test(n.message)&&(o="script"),n.external=r,n.externalCustom=a,n.type=o,n},e._createVarsString=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&(t[n]||0===t[n])&&e.push(n+"="+encodeURIComponent(t[n]).replace(/\*/g,"%2A"));return e.join(",")},e._sendError=function(t,n){e.send(null,t,e._createVarsString(n),null,null,null,null)};var s=function(t){e._handleError(t,!1)},c=function(t){var n=t.target;if(n){var o=n.srcset||n.src;if(o||(o=n.href),o){var i=n.tagName||"UNKNOWN";e.logError({message:i+" load error",additional:{src:o}})}}}}("undefined"!=typeof self?self:window,this),(t=this).logError=function(e,n){e=e||{},"string"!=typeof n&&void 0!==n||((n=new Error(n)).justCreated=!0);var o=e.message||"",i=t._baseNormalizeError(n);i.message&&(o&&(o+="; "),o+=i.message),i.message=o||"Empty error";for(var r=["service","source","type","block","additional","level","page","method","sourceMethod","coordinates_gp"],a=0;a<r.length;a++){var s=r[a];e[s]?i[s]=e[s]:n&&n[s]&&(i[s]=n[s])}t._handleError(i,!0)},function(t){function e(){var e=t.getSetting("clck"),n=t.countersBatchData.join("\r\n");if((t.countersBatchData=[],t.counterTimerId=null,e)&&!(navigator.sendBeacon&&t.getSetting("beacon")&&navigator.sendBeacon(e,n)))if("undefined"!=typeof self&&self.fetch)fetch(e,{method:"POST",body:n});else{var o=new XMLHttpRequest;o.open("POST",e),o.send(n)}}t.countersBatchData=[],t.counterTimerId,t.send=function(n,o,i,r,a,s,c){clearTimeout(t.counterTimerId);var u=function(e,n,o,i,r,a){var s=t.getSetting("slots");return[a?"/"+a.join("/"):"","/path="+n,s?"/slots="+s.join(";"):"",o?"/vars="+o:"","/cts="+(new Date).getTime(),"/*"]}(0,o,i,0,0,c);t.countersBatchData.push("/reqid="+t.getSetting("reqid")+u.join("")),t.countersBatchData.length<42?t.counterTimerId=setTimeout(e,15):e()}}(this),function(t){var e={url:{0:/(miscellaneous|extension)_bindings/,1:/^chrome:/,2:/kaspersky-labs\.com\//,3:/^(?:moz|chrome)-extension:\/\//,4:/^file:/,5:/^resource:\/\//,6:/webnetc\.top/,7:/local\.adguard\.com/},message:{0:/__adgRemoveDirect/,1:/Content Security Policy/,2:/vid_mate_check/,3:/ucapi/,4:/Access is denied/i,5:/^Uncaught SecurityError/i,6:/__ybro/,7:/__show__deepen/,8:/ntp is not defined/,9:/Cannot set property 'install' of undefined/,10:/NS_ERROR/,11:/Error loading script/,12:/^TypeError: undefined is not a function$/,13:/__firefox__\.(?:favicons|metadata|reader|searchQueryForField|searchLoginField)/},stack:{0:/(?:moz|chrome)-extension:\/\//,1:/adguard.*\.user\.js/i}};function n(t,e){if(t&&e){var n=[];for(var o in e)if(e.hasOwnProperty(o)){var i=e[o];"string"==typeof i&&(i=new RegExp(i)),i instanceof RegExp&&i.test(t)&&n.push(o)}return n.join("_")}}function o(t,o){var i,r=[];for(var a in e)e.hasOwnProperty(a)&&(i=n(t[a],o[a]))&&r.push(a+"~"+i);return r.join(";")}t._isExternalError=function(n,i,r){var a=t._errorSettings.filters||{},s={url:(n||"")+"",message:(i||"")+"",stack:(r||"")+""},c=o(s,e),u=o(s,a);return{common:c,custom:u,hasExternal:!(!c&&!u)}}}(this)}window.Ya=window.Ya||{},void 0!==t.exports?(t.exports=o,t.exports.default=o):window.Ya.ErrorLogger=o},504:function(t,e,n){"use strict";n.r(e);var o={};n.r(o),n.d(o,"computeBBoxForPoints",(function(){return d})),n.d(o,"pointIsInBBox",(function(){return u})),n.d(o,"computeOverlap",(function(){return l})),n.d(o,"expandBBox",(function(){return h})),n.d(o,"isBBoxEqual",(function(){return _})),n.d(o,"translateBBox",(function(){return m})),n.d(o,"isBBoxInBBox",(function(){return p})),n.d(o,"scaleBBox",(function(){return f}));var i=n(8),r=(n(486),n(10)),a=n(80),s=n(25),c=n(12);function u(t,e){return e.minX<=t.x&&t.x<=e.maxX&&e.minY<=t.y&&t.y<=e.maxY}function l(t,e,n){void 0===n&&(n={minX:0,maxX:0,minY:0,maxY:0});var o=t.minX>e.minX?t.minX:e.minX,i=t.maxX>e.maxX?e.maxX:t.maxX;if(o>i)return null;var r=t.minY>e.minY?t.minY:e.minY,a=t.maxY>e.maxY?e.maxY:t.maxY;return r>a?null:(n.minX=o,n.maxX=i,n.minY=r,n.maxY=a,n)}function d(t,e){if(void 0===e&&(e={minX:0,maxX:0,minY:0,maxY:0}),0===t.length)return e;e.maxX=t[0].x,e.minX=t[0].x,e.maxY=t[0].y,e.minY=t[0].y;for(var n=1;n<t.length;++n){var o=t[n],i=o.x,r=o.y;i<e.minX&&(e.minX=i),i>e.maxX&&(e.maxX=i),r<e.minY&&(e.minY=r),r>e.maxY&&(e.maxY=r)}return e}function h(t,e,n){return void 0===n&&(n={minX:0,maxX:0,minY:0,maxY:0}),n.minX=t.minX-e.x,n.maxX=t.maxX+e.x,n.minY=t.minY-e.y,n.maxY=t.maxY+e.y,n}function p(t,e){return e.minX>=t.minX&&e.minY>=t.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function _(t,e){return t.minX===e.minX&&t.maxX===e.maxX&&t.minY===e.minY&&t.maxY===e.maxY}function m(t,e,n){return void 0===n&&(n={minX:0,maxX:0,minY:0,maxY:0}),n.minX=t.minX+e.x,n.maxX=t.maxX+e.x,n.minY=t.minY+e.y,n.maxY=t.maxY+e.y,n}function f(t,e,n,o){return void 0===n&&(n=function(t){return{x:t.minX+(t.maxX-t.minX)/2,y:t.minY+(t.maxY-t.minY)/2}}(t)),void 0===o&&(o={minX:0,maxX:0,minY:0,maxY:0}),o.minX=t.minX*e,o.maxX=t.maxX*e,o.minY=t.minY*e,o.maxY=t.maxY*e,m(o,c.muln(n,1-e),o),o}var y,v=n(51),g=n(46),b=n(64),S=n(79),x=n(63),O=30*x.a,E=n(11);function z(){return/mac os/i.test(navigator.userAgent)}function w(){return/firefox/i.test(navigator.userAgent)}!function(t){t[t.INACTIVE=-1]="INACTIVE",t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=2]="SECONDARY",t[t.CTRL_PRIMARY=8]="CTRL_PRIMARY",t[t.CMD_PRIMARY=16]="CMD_PRIMARY"}(y||(y={}));var j=function(t){function e(n,o,i){var r=t.call(this)||this;return r._suppressNextClickStartTs=0,r.destroyed=!1,r.state=y.INACTIVE,r._spots=[],r._onElementPointerDown=function(){if(void 0===e._owner)e._owner=r;else if(e._owner!==r)return;r.element.removeEventListener(r._eventMap.start,r._onElementPointerDown),document.addEventListener(r._eventMap.start,r._onDocumentPointerDown),document.addEventListener(r._eventMap.end,r._onPointerUp)},r._onDocumentPointerDown=function(t){if(e._owner===r){var n=0===r._spots.length;r.state=n?r._getEventState(t):r.state,r._handleAdd(t),r._emit("spotsAdded"),n&&r._emit("stateChanged")}},r._onPointerMove=function(t){e._owner===r&&(r._handleChange(t),r._spots.length>0&&r._emit("spotsChanged"))},r._onPointerUp=function(t){e._owner===r&&(r._handleRemove(t),0===r._spots.length?(document.removeEventListener(r._eventMap.start,r._onDocumentPointerDown),document.removeEventListener(r._eventMap.end,r._onPointerUp),r.element.addEventListener(r._eventMap.start,r._onElementPointerDown),e._owner=void 0,r._emit("spotsRemoved"),r.state=y.INACTIVE,r._emit("stateChanged")):r._emit("spotsRemoved"))},r._onClick=function(t){var e=Date.now();r._suppressNextClickStartTs+500>e&&(r._suppressNextClickStartTs=0,t.stopPropagation(),t.preventDefault())},r._onDragStart=function(t){t.stopPropagation(),t.preventDefault()},r.element=n,r._eventMap=o,r.options=i,r.element.style.touchAction="none",r.element.addEventListener(r._eventMap.start,r._onElementPointerDown),r.element.addEventListener("click",r._onClick,!0),r.element.addEventListener("dragstart",r._onDragStart),document.addEventListener(r._eventMap.move,r._onPointerMove),r}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"spots",{get:function(){return this._spots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerPosition",{get:function(){return this._spots.length>0?c.avg(this._spots):this._getPointerPositionWithoutSpots()},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.destroyed||(this.element.removeEventListener(this._eventMap.start,this._onElementPointerDown),document.removeEventListener(this._eventMap.start,this._onDocumentPointerDown),document.removeEventListener(this._eventMap.move,this._onPointerMove),document.removeEventListener(this._eventMap.end,this._onPointerUp),this.element.removeEventListener("dragstart",this._onDragStart),this.element.removeEventListener("click",this._onClick,!0),this.element.style.touchAction="auto",this.destroyed=!0,e._owner===this&&(e._owner=void 0))},e.prototype.suppressNextClick=function(){this._suppressNextClickStartTs=Date.now()},e.prototype.suppressSelection=function(){},e.prototype._getEventState=function(t){return t instanceof MouseEvent?t.ctrlKey&&0===t.button?y.CTRL_PRIMARY:t.metaKey&&0===t.button&&z()?y.CMD_PRIMARY:t.button:y.PRIMARY},e}(Object(E.a)().with()),R={start:"pointerdown",move:"pointermove",end:"pointerup"};function C(t){var e=[];return t.forEach((function(t){e.push(t)})),e}var T=function(t){function e(e,n){var o=t.call(this,e,R,n)||this;return o._spotMap=new r.Map,o._pointerPosition={x:0,y:0},o._suppressSelection=!1,o._onWheel=function(t){("boolean"!=typeof t.isTrusted||t.isTrusted)&&(o._pointerPosition={x:t.clientX,y:t.clientY})},document.addEventListener("wheel",o._onWheel,!0),document.addEventListener("pointercancel",(function(){o._spotMap.clear(),o.state=y.INACTIVE,o._emit("stateChanged")})),o}return Object(i.b)(e,t),e.prototype.suppressSelection=function(){this._suppressSelection=!0},e.prototype.destroy=function(){document.removeEventListener("wheel",this._onWheel,!0),t.prototype.destroy.call(this)},e.prototype._handleAdd=function(t){var e,n=this;if(!(null===(e=this.options)||void 0===e?void 0:e.filter(t))){this._spotMap.set(t.pointerId,{x:t.clientX,y:t.clientY}),this._spots=C(this._spotMap),this._pointerPosition={x:t.clientX,y:t.clientY};var o=t.target;if(o){var i=function(t){o.removeEventListener("pointerup",i),n._handleRemove(t)};o.addEventListener("pointerup",i)}}},e.prototype._handleChange=function(t){var e;(null===(e=this.options)||void 0===e?void 0:e.filter(t))||(this._suppressSelection&&1===this._spots.length&&t.preventDefault(),this._pointerPosition={x:t.clientX,y:t.clientY},this._spots.length>0&&this._spotMap.has(t.pointerId)&&(this._spotMap.set(t.pointerId,this._pointerPosition),this._spots=C(this._spotMap)))},e.prototype._handleRemove=function(t){var e;(null===(e=this.options)||void 0===e?void 0:e.filter(t))||(this._spotMap.delete(t.pointerId),this._spots=C(this._spotMap),this._suppressSelection=!1)},e.prototype._getPointerPositionWithoutSpots=function(){return this._pointerPosition},e}(j),P={start:"touchstart",move:"touchmove",end:"touchend"},A=function(t){function e(n,o){var i=t.call(this,n,P,o)||this;return i._mouseCoords={x:0,y:0},i._holdingMouseButton=!1,i._onMouseDown=function(t){if(void 0===e._mouseOwner)e._mouseOwner=i;else if(e._mouseOwner!==i)return;i._mouseCoords={x:t.clientX,y:t.clientY};var n=i.state===y.INACTIVE;i.state=n?i._getEventState(t):i.state,i._holdingMouseButton=!0,document.addEventListener("mouseup",i._onMouseUp),i._emit("spotsAdded"),n&&i._emit("stateChanged")},i._onMouseMove=function(t){i._mouseCoords={x:t.clientX,y:t.clientY},e._mouseOwner===i&&i._holdingMouseButton&&i._emit("spotsChanged")},i._onMouseUp=function(){e._mouseOwner===i&&(e._mouseOwner=void 0,i._holdingMouseButton=!1,document.removeEventListener("mouseup",i._onMouseUp),i._emit("spotsRemoved"),i.state=y.INACTIVE,i._emit("stateChanged"))},i._onWheel=function(t){("boolean"!=typeof t.isTrusted||t.isTrusted)&&(i._mouseCoords={x:t.clientX,y:t.clientY})},i.element.addEventListener("mousedown",i._onMouseDown),document.addEventListener("mousemove",i._onMouseMove),i.element.addEventListener("wheel",i._onWheel),/ipad|iphone/i.test(navigator.userAgent)&&i.element.addEventListener("touchmove",(function(t){return t.preventDefault()})),i}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"spots",{get:function(){return 0!==this._spots.length?this._spots:this._holdingMouseButton?[this._mouseCoords]:[]},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.destroyed||(this.element.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this.element.removeEventListener("wheel",this._onWheel),t.prototype.destroy.call(this))},e.prototype._handleAdd=function(t){var e;(null===(e=this.options)||void 0===e?void 0:e.filter(t))||(this._spots=M(t.touches))},e.prototype._handleChange=function(t){var e;if(!(null===(e=this.options)||void 0===e?void 0:e.filter(t))){var n=this._spots.length;this._spots=M(t.touches),this._spots.length<n?this._emit("spotsRemoved"):this._spots.length>n&&this._emit("spotsAdded")}},e.prototype._handleRemove=function(t){var e;(null===(e=this.options)||void 0===e?void 0:e.filter(t))||(this._spots=M(t.touches))},e.prototype._getPointerPositionWithoutSpots=function(){return this._mouseCoords},e}(j);function M(t){for(var e=new Array,n=0;n<t.length;n++)e[n]={x:t[n].clientX,y:t[n].clientY};return e}var L,D=new r.WeakMap;function I(t,e){var n=D.get(t);if(!n||n.destroyed){var o=/ipad|iphone/i.test(navigator.userAgent),i=w()&&/windows/i.test(navigator.userAgent);n=o||i||!("PointerEvent"in window)?new A(t,e):new T(t,e),D.set(t,n)}return n}!function(t){t[t.IDLE=0]="IDLE",t[t.DRAGGING_BEYOND_THRESHOLD=1]="DRAGGING_BEYOND_THRESHOLD",t[t.DRAGGING=2]="DRAGGING"}(L||(L={}));var k,F={tremorPixels:3,listenToButtons:new r.Set([y.PRIMARY]),minSpotsCount:1},G=function(t){function e(e,n){void 0===n&&(n={});var o=t.call(this)||this;return o._state=L.IDLE,o._startingPoint={x:0,y:0},o._dragOffset={x:0,y:0},o._pointerPosition={x:0,y:0},o._onSpotAdded=function(){if(!(o._device.spots.length<o._options.minSpotsCount)){var t=o._device.state;if(o._state<L.DRAGGING_BEYOND_THRESHOLD&&o._options.listenToButtons.has(t)){var e=o._device.pointerPosition;o._state=L.DRAGGING_BEYOND_THRESHOLD,o._startingPoint.x=e.x,o._startingPoint.y=e.y,o._dragOffset={x:0,y:0},o._pointerPosition=o._device.pointerPosition}else o._skip(o._device.pointerPosition)}},o._onSpotsChanged=function(){if(!(o._state<L.DRAGGING_BEYOND_THRESHOLD)){var t=o._device.pointerPosition,e=o._dragOffset;o._dragOffset=c.sub(t,o._startingPoint),o._pointerPosition=o._device.pointerPosition,o._state<=L.DRAGGING_BEYOND_THRESHOLD&&Math.max(Math.abs(o._dragOffset.x),Math.abs(o._dragOffset.y))>o._options.tremorPixels?(o._emit("dragStart"),o._state=L.DRAGGING,o._device.suppressSelection()):o._state!==L.DRAGGING||c.areEqual(e,o._dragOffset)||o._emit("dragMove")}},o._onSpotsRemoved=function(){o._device.spots.length<o._options.minSpotsCount?(o._emit("dragEnd"),o._state===L.DRAGGING&&o._device.suppressNextClick(),o._state=L.IDLE,o._dragOffset={x:0,y:0},o._pointerPosition={x:0,y:0}):o._skip(o._device.pointerPosition)},o._device=e,o._options=Object(i.a)(Object(i.a)({},F),n),o._deviceSubscription=o._device.on("spotsAdded",o._onSpotAdded).on("spotsChanged",o._onSpotsChanged).on("spotsRemoved",o._onSpotsRemoved),o}return Object(i.b)(e,t),e.prototype.destroy=function(){this._deviceSubscription.offAll()},Object.defineProperty(e.prototype,"dragStartingPoint",{get:function(){return this._startingPoint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerPosition",{get:function(){return this._pointerPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dragOffset",{get:function(){return this._state===L.DRAGGING?this._dragOffset:{x:0,y:0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._state!==L.IDLE},enumerable:!1,configurable:!0}),e.prototype._skip=function(t){if(this._state<L.DRAGGING)return this._startingPoint=t,void(this._pointerPosition=t);this._emit("dragEnd"),this._startingPoint=t,this._pointerPosition=t,this._emit("dragStart")},e}(Object(E.a)().with());!function(t){t[t.SCROLL_DOWN=-1]="SCROLL_DOWN",t[t.SCROLL_UP=1]="SCROLL_UP"}(k||(k={}));var W=function(t){function e(e,n){var o=t.call(this)||this;return o._disabled=!1,o._onWheel=function(t){var e;if(!o._disabled&&("boolean"!=typeof t.isTrusted||t.isTrusted)&&!(null===(e=o.options)||void 0===e?void 0:e.filter(t))){t.preventDefault(),t.stopPropagation();var n=t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?1:40;(function(){var t,e=null===(t=navigator.userAgent)||void 0===t?void 0:t.match(/firefox\/(\d+)/i);return!!e&&Number(e[1])>=90})()&&t.deltaMode===WheelEvent.DOM_DELTA_LINE&&(n=1);var i=(void 0!==t.wheelDeltaY?t.wheelDeltaY:-t.deltaY)*n*(t.shiftKey?.25:1);t.ctrlKey&&z()&&w()&&(i*=6),o._emit("wheel",i)}},o._element=e,o._element.addEventListener("wheel",o._onWheel,{passive:!1}),o.options=n,o}return Object(i.b)(e,t),e.prototype.destroy=function(){this._element.removeEventListener("wheel",this._onWheel)},e.prototype.disable=function(){this._disabled=!0},e.prototype.enable=function(){this._disabled=!1},e}(Object(E.a)().with()),Z=12*x.a,B=function(t){function e(e){var n=t.call(this)||this;return n._scale=1,n._state=0,n._angle=0,n._angleDelta=0,n._panTiltDelta=0,n._initialTouchDistance=1,n._initialTouchesY=[0,0],n._initialDirection={x:0,y:0},n._device=e,n._deviceSubscription=n._device.on("spotsAdded",(function(){2===n._device.spots.length&&(n._state=1,n._initialTouchDistance=N(n._device.spots),n._initialTouchesY=[n._device.spots[0].y,n._device.spots[1].y],n._initialDirection=Y(n._device.spots),n._updateState())})).on("spotsChanged",(function(){if(!(n._device.spots.length<=1)&&(n._updateState(),1===n._state)){var t=Math.abs(N(n._device.spots)-n._initialTouchDistance),e=Math.abs(n._angle)>Z,o=t>=15,i=n._device.spots[0].y-n._initialTouchesY[0],a=n._device.spots[1].y-n._initialTouchesY[1],s=!e&&Object(r.mathSign)(i)===Object(r.mathSign)(a)&&Math.abs(i)>=5&&Math.abs(a)>=5&&t<10;(e||o||s)&&(n._state=2,n._initialTouchDistance=N(n._device.spots),n._initialDirection=Y(n._device.spots),n._updateState(),n._emit(o||e?"pinchRotateStart":"panTiltStart"))}})).on("spotsRemoved",(function(){n._device.spots.length<=1?(2===n._state&&n._emit("gestureEnd"),n._scale=1,n._angle=0,n._angleDelta=0,n._panTiltDelta=0,n._initialDirection={x:0,y:0},n._initialTouchDistance=0,n._initialTouchesY=[0,0]):n._updateState()})),n}return Object(i.b)(e,t),e.prototype.destroy=function(){this._deviceSubscription.offAll()},Object.defineProperty(e.prototype,"scale",{get:function(){return 2===this._state?this._scale:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return 2===this._state?this._getCorrectedAngle():0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"panTiltDelta",{get:function(){return 2===this._state?this._panTiltDelta:0},enumerable:!1,configurable:!0}),e.prototype._updateState=function(){var t,e,n=this._device.spots,o=N(n);this._scale=o?o/this._initialTouchDistance:1,this._angle=(t=Y(n),e=this._initialDirection,Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x)),this._panTiltDelta=this._initialTouchesY[0]-n[0].y},e.prototype._getCorrectedAngle=function(){var t=Math.abs(this._angle)>Z;return!this._angleDelta&&t&&(this._angleDelta=-Object(r.mathSign)(this._angle)*Z),this._angleDelta?this._angle+this._angleDelta:0},e}(Object(E.a)().with());function N(t){if(t.length<2)return 0;var e=c.sub(t[0],t[1]);return c.length(e)}function Y(t){return c.sub(t[0],t[1])}var H=n(17);n(35);function X(t){var e=document.createElement("ymaps");return t&&(e.className=t),e}var V=n(126),U=n(21),q=n(16),Q=n(13),K=function(t){function e(e){var n=t.call(this)||this;return n._device=null,n._dragger=null,n._dragStartSubscription=null,n.options=Object(i.a)({},e.options),n.options.draggable=Boolean(n.options.draggable),n.options.zIndex=n.options.zIndex||0,n.options.disableRoundCoordinates=Boolean(n.options.disableRoundCoordinates),n.container=n._makeWrapper(e.element),n.element=e.element,n._state={type:"idle",coordinates:e.coordinates},n._toggleDrag(n.options.draggable||!1),n}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"coordinates",{get:function(){if("idle"===this._state.type)return this._state.coordinates;if(this._layer){var t=$(this._state);return J(this._layer,t)}return this._state.initialCoordinates},enumerable:!1,configurable:!0}),e.prototype.toggleDrag=function(t){t!==this.options.draggable&&this._toggleDrag(t)},e.prototype.toggleRoundCoordinates=function(t){t!==this.options.disableRoundCoordinates&&(this.options.disableRoundCoordinates=t,this.reposition(!0))},e.prototype.setCoordinates=function(t){"idle"===this._state.type?this._state.coordinates=t:this._state.initialCoordinates=t,this.reposition(!0)},e.prototype.setZIndex=function(t){this.options.zIndex=t,this.reposition(!0)},e.prototype.destroy=function(){this._destroyDrag(),this._layer=void 0},e.prototype.reposition=function(t){if(void 0===t&&(t=!1),this._layer){var e=void 0,n=(e="dragging"===this._state.type?$(this._state):function(t,e,n){var o=t.zoom,i=t.size,r=t.tilt,a=t.azimuth,s=t.fov,c=n&&0===r?H.a.computePixelPerfectWorldCoordinates(t.center,o,Object(V.a)(),1):t.center,u=t.projection.toGlobalCoordinates(e),l=n?H.a.computePixelPerfectWorldCoordinates(u,o,Object(V.a)(),1):u,d=t.worldOptions.cycledX?H.a.moveCloseToCenter(l,c):l;return d.y=Object(q.b)(d.y,-1,1),Object(U.d)(d,{azimuth:a,tilt:r,worldCenter:c,zoom:o,size:i,fov:s})}(this._layer,this.coordinates,!this.options.disableRoundCoordinates&&t)).x,o=e.y;this.container.style.transform="translate(".concat(n,"px, ").concat(o,"px)"),this.container.style.zIndex=String(this.options.zIndex)}},e.prototype.attachToLayer=function(t){this._layer&&Object(Q.c)(new Error("Marker is already attached to the layer")),this._layer=t,this.options.draggable&&this._initDrag(this._layer),this.reposition()},e.prototype.detachFromLayer=function(){this._layer||Object(Q.c)(new Error("Marker is not attached to the layer")),this._destroyDrag(),this._layer=void 0},e.prototype.onLayerUpdate=function(){"dragging"===this._state.type&&this._emit("dragMove",{pointerPosition:this._dragger.pointerPosition})},e.prototype._makeWrapper=function(t){var e=X("ymaps3x0--marker");return e.appendChild(t),e},e.prototype._toggleDrag=function(t){this.options.draggable=t,t?this._layer&&this._initDrag(this._layer):this._destroyDrag()},e.prototype._initDrag=function(t){var e=this;this._device=I(this.container);var n=new G(this._device);this._dragger=n,this._dragStartSubscription=n.on("dragStart",(function(){e._emit("dragStart",{pointerPosition:n.pointerPosition}),"dragging"===e._state.type&&Object(Q.c)(new Error("Dragging can't be started more than once"));var o=e.container.getBoundingClientRect(),i=c.sub(n.dragStartingPoint,{x:o.left,y:o.top}),r={type:"dragging",pointerPosition:n.pointerPosition,layer:t,markerOffset:i,initialCoordinates:e._state.coordinates,subscription:n.group().on("dragMove",(function(){r.pointerPosition=n.pointerPosition,e.reposition(),e._emit("dragMove",{pointerPosition:n.pointerPosition})})).on("dragEnd",(function(){var o=$(r);r.subscription.offAll(),e._state={type:"idle",coordinates:J(t,o)},e.reposition(!0),e._emit("dragEnd",{pointerPosition:n.pointerPosition})}))};e._state=r}))},e.prototype._destroyDrag=function(){"dragging"===this._state.type&&(this._state.subscription.offAll(),this._state={coordinates:this._state.initialCoordinates,type:"idle"}),this._dragStartSubscription&&(this._dragStartSubscription.offAll(),this._dragStartSubscription=null),this._dragger&&(this._dragger.destroy(),this._dragger=null),this._device&&(this._device.destroy(),this._device=null)},e}(Object(E.a)().with());function J(t,e){var n=t.center,o=t.zoom,i=t.azimuth,r=t.tilt,a=t.size,s=t.projection,c=t.fov,u=Object(U.b)(e,{worldCenter:n,zoom:o,tilt:r,azimuth:i,size:a,fov:c});return s.fromGlobalCoordinates(u)}function $(t){var e=t.layer,n=t.markerOffset,o=t.pointerPosition,i=e.element.getBoundingClientRect();return{x:o.x-i.left-n.x,y:o.y-i.top-n.y}}function tt(t,e,n,o,i){var r=t.toGlobalCoordinates(e);return i?c.sub(r,et(i,n,o)):r}function et(t,e,n){var o=H.a.convertPixelSizeToWorldSize({x:(t[3]-t[1])/2,y:(t[0]-t[2])/2},e);return c.rotate(o,n,o),o}var nt,ot=n(227);var it,rt=n(107),at=n(81),st=n(99),ct=n(82),ut=n(83),lt=function(t){return Math.abs(t)>=1e21?t.toPrecision(100):t.toFixed(5)};function dt(t,e){return t.state=e,t}!function(t){t[t.QUEUED=0]="QUEUED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ANIMATING=3]="ANIMATING",t[t.READY=4]="READY",t[t.EMPTY=5]="EMPTY",t[t.REMOVED=6]="REMOVED"}(it||(it={}));var ht=function(t){function e(e,n,o,a,s,u,l,d,h,p,_,m,f){var y=t.call(this)||this;return y._currentTiles=new r.Map,y._renderedOffset={x:0,y:0},y._renderedScale=0,y._renderedAzimuth=0,y._renderedTilt=0,y._loadedTiles=new r.Set,y._haveTilesToAnimate=!1,y._tileBounds=[c.ORIGIN,c.ORIGIN,c.ORIGIN,c.ORIGIN],y.element=X("ymaps3x0--tile-layer__container"),y.state={tilesLoaded:0,tilesTotal:0,tilesReady:0,borderLoaded:0,borderReady:0,borderTotal:0,graphicsReady:0,graphicsTotal:0},y._createTile=function(t){var e=y._computeScreenCordinatesForTile(t),n=y._computeTilePriority(t),o=Object(i.a)({state:it.QUEUED,info:t,screenX:Math.round(e.x),screenY:Math.round(e.y),animate:y._tileSource.tileRevealDuration>0&&(!y._firstScreen||y._animateFirstScreen),animationStartTs:0,image:null},y._tileLoadingQueue.enqueue((function(t){var e,n=null===(e=y._tileSource.rasterSourceDescription)||void 0===e?void 0:e.tileUrl;return"function"==typeof n?y._generateTile(n,o,t):y._loadTile(o,t)}),n));return o.promise.then((function(t){o.abortController.signal.aborted||y._onTileLoad(t)})).catch((function(t){t instanceof ct.a||Object(Q.c)(t)})),o},y._updateTile=function(t,e){t.info=e;var n=y._computeScreenCordinatesForTile(t.info);t.state===it.QUEUED&&t.updatePriority(y._computeTilePriority(t.info)),t.screenX===n.x&&t.screenY===n.y||(t.screenX=n.x,t.screenY=n.y,t.state!==it.ANIMATING&&t.state!==it.READY||(t.element.style.left=n.x+"px",t.element.style.top=n.y+"px"))},y._removeTile=function(t){t.state!==it.QUEUED&&t.state!==it.LOADING||t.abortController.abort(),t.state===it.LOADED&&y._loadedTiles.delete(t),t.state!==it.ANIMATING&&t.state!==it.READY||y.element.removeChild(t.element),t.state!==it.READY&&t.state!==it.ANIMATING&&t.state!==it.LOADED||!t.ctx||(t.ctx=void 0),dt(t,it.REMOVED)},y._generateTile=function(t,e,n){var o=dt(e,it.LOADING),i=y._tileSource.fitTileIntoWorld(e.info.x,e.info.y,y.zoom);if(null===i){var r=dt(o,it.EMPTY);return y._countReadyTile(r),Promise.resolve(r)}return t(i.x,i.y,y.zoom).then((function(t){if(n.aborted)throw new ct.a;var e=dt(o,it.LOADED),i=document.createElement("canvas");i.width=t.width,i.height=t.height,i.style.width="".concat(y._tileSource.tileSize,"px"),i.style.height="".concat(y._tileSource.tileSize,"px"),i.style.position="absolute";var r=i.getContext("2d");if(null===r)throw new Error("Can't obtain canvas context");return r.drawImage(t,0,0),e.ctx=r,e.element=i,y._countLoadedTile(e),e})).catch((function(t){if(Object(Q.b)(t),n.aborted)throw new ct.a;var e=dt(o,it.EMPTY);return y._countReadyTile(e),e}))},y._loadTile=function(t,e){var n=dt(t,it.LOADING),o=y._tileSource.generateTileUrl(n.info.x,n.info.y,y.zoom,Object(V.a)());if(!o){var i=dt(n,it.EMPTY);return y._countReadyTile(i),Promise.resolve(i)}var r=new at.b,a=new Image,s=function(t){if(a.onerror=null,a.onload=null,e.removeEventListener("abort",c),0===t){var o=dt(n,it.LOADED);o.element=a,r.resolve(o),y._countLoadedTile(o)}else if(1===t){var i=dt(n,it.EMPTY);r.resolve(i),y._countReadyTile(i)}else 2===t&&(a.src="",r.reject(new ct.a))},c=s.bind(null,2);e.addEventListener("abort",c);var u=s.bind(null,0),l=s.bind(null,1);return a.decode?(a.src=o,a.decode().then(u,l)):(a.onload=u,a.onerror=l,a.src=o),r.promise},y._onTileLoad=function(t){t.state===it.LOADED?(y._loadedTiles.add(t),y._emit("requestRender")):t.state===it.EMPTY&&y._countReadyTile(t)},y._shouldAwaitAllTiles=m,y._releaseAwaitAllTilesTrigger=f,y._visibleCenter=n,y._scale=o,y._azimuth=a,y._tilt=s,y._fov=u,y._size=d,y._tileSource=h,y._parent=e,y.zoom=l,y._animateFirstScreen=p,y._tileLoadingQueue=_,y.element.dataset.z=String(l),e.appendChild(y.element),y.element.addEventListener("dragstart",(function(t){t.stopPropagation(),t.preventDefault()})),y._fetchedCenter=y._visibleCenter,y._fetched=!1,y._firstScreen=!0,y}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"needsRender",{get:function(){return 0!==this._loadedTiles.size||this._haveTilesToAnimate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.element.parentElement.removeChild(this.element),this._currentTiles.forEach((function(t){t.state!==it.QUEUED&&t.state!==it.LOADING||t.abortController.abort()}))},e.prototype.resize=function(t){this._fetched=!1,this._size=t,this.reposition(g.a.FULL)},e.prototype.update=function(t,e,n,o,i){this._visibleCenter=H.a.computePixelPerfectWorldCoordinates(t,this.zoom,Object(V.a)(),o),this._azimuth=e,this._tilt=n,this._scale=o,this._fov=i},e.prototype.setVisibile=function(t){this.element.style.display=t?"":"none"},e.prototype.freeze=function(){var t=this;this._loadedTiles.clear(),this._currentTiles.forEach((function(e,n){e.state<=it.LOADED&&(t._currentTiles.delete(n),e.state!==it.QUEUED&&e.state!==it.LOADING||e.abortController.abort())}))},e.prototype.unfreeze=function(){this._fetched=!1},e.prototype.reposition=function(t){var e=c.sub(this._fetchedCenter,this._visibleCenter),n=this._tileSource.worldOptions.cycledX?H.a.moveCloseToCenter(this._fetchedCenter,this._visibleCenter,e):e,o=H.a.worldToRelativePixels(n,this.zoom),i=t>=g.a.FULL;if(i&&c.applyFunction(o,Math.round,o),t===g.a.FULL||!c.areEqual(o,this._renderedOffset)||this._renderedScale!==this._scale||this._renderedAzimuth!==this._azimuth||this._renderedTilt!==this._tilt){var r=t===g.a.QUICK?c.ORIGIN:this._computeContainerSubpixelOffset(Object(V.a)());this._renderedOffset=c.sub(o,r,o);var a=Object(U.a)(this._size.y,this._fov),s=a-a/this._scale,u=s*Math.sin(this._tilt),l=s*Math.cos(this._tilt),d=[(i?this._renderedOffset.x.toString():lt(this._renderedOffset.x))+"px",(i?this._renderedOffset.y.toString():lt(this._renderedOffset.y))+"px","0px"].join(", ");this.element.style.transform="\n            rotateX(".concat(lt(this._tilt),"rad)\n            translate3d(0px, ").concat(u,"px, ").concat(l,"px)\n            rotateZ(").concat(lt(this._azimuth),"rad) translate3d(").concat(d,")\n        "),this._renderedScale=this._scale,this._renderedAzimuth=this._azimuth,this._renderedTilt=this._tilt}},e.prototype.render=function(t){var e=Object(ut.c)(H.a.worldToPixels(this._visibleCenter,this.zoom),this._azimuth,this._size,this._scale,this._tileSource.tileSize);this._fetched&&!Object(ut.g)(e,this._tileBounds)||this._fetch(),this._fetch(),this.reposition(t.qualityHint),this._shouldAwaitAllTiles()&&this.state.tilesLoaded!==this.state.tilesTotal||(this._attachLoadedTiles(t.time),this._revealNewTiles(t.time))},e.prototype.finishTileAnimations=function(){var t=this;this._haveTilesToAnimate&&(this._currentTiles.forEach((function(e){e.state===it.ANIMATING&&(e.element.style.opacity="1",t._countReadyTile(dt(e,it.READY)))})),this._haveTilesToAnimate=!1)},e.prototype._computeContainerSubpixelOffset=function(t){var e=this._parent.getBoundingClientRect(),n={x:e.left,y:e.top};return c.applyFunction(n,(function(e){var n=e*t;return(n-Math.round(n))/t}))},e.prototype._fetch=function(){var t=this,e=c.sub(this._fetchedCenter,this._visibleCenter).x;this._fetchedCenter=this._visibleCenter;var n=H.a.worldToPixels(this._fetchedCenter,this.zoom);this._centralTilePoint=c.add(c.divn(n,this._tileSource.tileSize),{x:-.5,y:-.5});var o=Object(ut.b)(this._visibleCenter,this._azimuth,this._tilt,this.zoom,this._scale,this._size,this._tileSource.tileSize),i=o.tiles,a=o.tileBounds;this._tileBounds=a;var s=Object(ut.d)(this.zoom,this._tileSource.tileSize),u=this._currentTiles,l=e>1;(l||e<-1)&&(u=new r.Map,this._currentTiles.forEach((function(e){var n=e.info,o=n.x,i=n.y,r=l?-s:s;u.set(Object(ut.e)({x:o+r,y:i},t.zoom),e)})));var d=Object(st.a)(u,i,this._createTile,this._removeTile,this._updateTile);this._currentTiles=d.result,this._updateState()&&this._emitStateChanged(),this._fetched=!0,this._firstScreen=!1},e.prototype._attachLoadedTiles=function(t){var e=this;if(0!==this._loadedTiles.size){var n=document.createDocumentFragment();this._loadedTiles.forEach((function(o){if(o.element.style.left=o.screenX+"px",o.element.style.top=o.screenY+"px",o.element.style.width="".concat(e._tileSource.tileSize,"px"),o.element.style.height="".concat(e._tileSource.tileSize,"px"),o.animate){var i=dt(o,it.ANIMATING);i.element.style.opacity="0",i.animationStartTs=t}else o.element.style.opacity="1",e._countReadyTile(dt(o,it.READY));n.appendChild(o.element)})),this.element.appendChild(n),this._loadedTiles.clear()}},e.prototype._revealNewTiles=function(t){var e=this;this._haveTilesToAnimate=!1,this._currentTiles.forEach((function(n){if(n.state===it.ANIMATING){var o=e._tileSource.tileRevealDuration>0?Math.min(1,(t-n.animationStartTs)/e._tileSource.tileRevealDuration):1;n.element.style.opacity=String(o),o<1?e._haveTilesToAnimate=!0:e._countReadyTile(dt(n,it.READY))}})),this._haveTilesToAnimate?this._emit("requestRender"):this._releaseAwaitAllTilesTrigger()},e.prototype._countLoadedTile=function(t){t.info.border?this.state.borderLoaded++:this.state.tilesLoaded++,this._emitStateChanged()},e.prototype._countReadyTile=function(t){t.info.border?this.state.borderReady++:this.state.tilesReady++,this._emitStateChanged()},e.prototype._emitStateChanged=function(){this.state=Object(i.a)({},this.state),this._emit("stateChanged")},e.prototype._updateState=function(){var t={borderTotal:0,borderLoaded:0,borderReady:0,tilesTotal:0,tilesReady:0,tilesLoaded:0,graphicsTotal:0,graphicsReady:0};this._currentTiles.forEach((function(e){e.info.border?t.borderTotal++:t.tilesTotal++,e.state!==it.LOADED&&e.state!==it.ANIMATING&&e.state!==it.READY||(e.info.border?t.borderLoaded++:t.tilesLoaded++),e.state===it.READY&&(e.info.border?t.borderReady++:t.tilesReady++)}));var e=t.borderTotal!==this.state.borderTotal||t.borderLoaded!==this.state.borderLoaded||t.borderReady!==this.state.borderReady||t.tilesTotal!==this.state.tilesTotal||t.tilesReady!==this.state.tilesReady||t.tilesLoaded!==this.state.tilesLoaded;return e&&(this.state=t),e},e.prototype._computeTilePriority=function(t){return(t.border?Number.MAX_SAFE_INTEGER/2:0)+(e=t,n=this._centralTilePoint,Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));var e,n},e.prototype._computeScreenCordinatesForTile=function(t){var e=this._tileSource.tileSize,n=H.a.worldToPixels(this._visibleCenter,this.zoom),o=c.muln(t,e),i=c.add(c.sub(o,n),c.divn(this._size,2));return c.applyFunction(i,Math.round)},e}(Object(E.a)().with()),pt=n(58),_t=function(t){function e(e,n,o,i,r,a){var s=t.call(this)||this;return s._needsRender=!0,s._awaitAllTilesTrigger=!1,s._fov=O,s._deprecatedLayers=[],s.element=X("ymaps3x0--layer ymaps3x0--tile-layer"),s._onForegroundTileReady=function(){(s._layer.state.tilesReady===s._layer.state.tilesTotal||s._tileSource.transparent&&s._layer.state.tilesLoaded>0)&&s._cleanUpDeprecatedLayers(),s._emit("stateChanged")},s._shouldAwaitAllTiles=function(){return s._awaitAllTilesTrigger},s._releaseAwaitAllTilesTrigger=function(){s._awaitAllTilesTrigger=!1,s._oldDataSourceLayer&&(s._oldDataSourceLayer.destroy(),s._oldDataSourceLayer=void 0)},s._awaitAllTilesTrigger=o.awaitAllTilesOnFirstDisplay,s._size=e,s._camera=n,s._tileSource=o,s._zoomRoundingRule=i,s._processingQueue=a,s._updatePerspective(),s._roundZoom=s._zoomRoundingRule(s._camera.zoom),s._createLayerForCurrentZoom(r),s._inZoomRange=!0,s._tileSourceSubscription=s._tileSource.group().on("sourceChanged",(function(t){return s.handleDataSourceUpdate(t)})),s}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"center",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._layer.state},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._tileSourceSubscription.offAll(),this._layer.destroy(),this._cleanUpDeprecatedLayers()},e.prototype.update=function(t,e){this._needsRender=!0,Object(pt.e)(this._camera,t)||this._releaseAwaitAllTilesTrigger(),this._camera=t,this._fov=e,this._roundZoom=this._zoomRoundingRule(this._camera.zoom),this._roundZoom!==this._layer.zoom&&this._layer.freeze()},e.prototype.handleDataSourceUpdate=function(t){this._awaitAllTilesTrigger=this._tileSource.awaitAllTilesOnFirstDisplay,(t.fetchTile||t.tileSize)&&(t.fetchTile&&this._awaitAllTilesTrigger?this._oldDataSourceLayer||(this._oldDataSourceLayer=this._layer,this._oldDataSourceLayer.freeze()):this._layer.destroy(),this._cleanUpDeprecatedLayers(),this._createLayerForCurrentZoom(!0),this._emit("requestRender"))},e.prototype.render=function(t){if(this._needsRender||this._layer.needsRender||t.qualityHint===g.a.FULL){if(this._checkZoomInZoomRange())this._inZoomRange||(this._layer.unfreeze(),this._layer.setVisibile(!0),this._inZoomRange=!0);else{if(!this._inZoomRange)return;this._layer.freeze(),this._layer.setVisibile(!1),this._cleanUpDeprecatedLayers(),this._inZoomRange=!1}this._updatePerspective(),this._needsRender=!1,t.qualityHint===g.a.FULL&&this._roundZoom!==this._layer.zoom&&(this._layerEventGroup.offAll(),Math.abs(this._layer.zoom-this._roundZoom)>3?this._layer.destroy():this._deprecatedLayers.push(this._layer),this._createLayerForCurrentZoom(!0));for(var e=0,n=this._deprecatedLayers;e<n.length;e++){var o=n[e];this._updateLayer(o),o.reposition(t.qualityHint),o.finishTileAnimations()}this._updateLayer(this._layer),this._roundZoom===this._layer.zoom?this._layer.render(t):this._layer.reposition(t.qualityHint),this._sortLayers()}},e.prototype._updateLayer=function(t){var e=H.a.getScale(t.zoom,this._camera.zoom);t.update(this._camera.worldCenter,this._camera.azimuth,this._camera.tilt,e,this._fov)},e.prototype.resize=function(t){this._needsRender=!0,this._size=t,this._layer.resize(t);for(var e=0,n=this._deprecatedLayers;e<n.length;e++){n[e].resize(t)}this._updatePerspective()},e.prototype.findObjectInPosition=function(){return null},e.prototype._updatePerspective=function(){this.element.style.perspective="".concat(Object(U.a)(this._size.y,this._fov),"px")},e.prototype._checkZoomInZoomRange=function(){return this._roundZoom>=this._tileSource.zoomRange.min&&this._roundZoom<=this._tileSource.zoomRange.max},e.prototype._cleanUpDeprecatedLayers=function(){for(var t=0,e=this._deprecatedLayers;t<e.length;t++){e[t].destroy()}this._deprecatedLayers=[]},e.prototype._createLayerForCurrentZoom=function(t){var e=this,n=Object(r.arrayFind)(this._deprecatedLayers,(function(t){return t.zoom===e._roundZoom}));if(n)this._deprecatedLayers.splice(this._deprecatedLayers.indexOf(n),1),n.unfreeze();else{var o=Object(q.b)(this._zoomRoundingRule(this._camera.zoom),this._tileSource.zoomRange.min,this._tileSource.zoomRange.max),i=H.a.getScale(o,this._camera.zoom);n=new ht(this.element,this._camera.worldCenter,i,this._camera.azimuth,this._camera.tilt,this._fov,o,this._size,this._tileSource,t,this._processingQueue,this._shouldAwaitAllTiles,this._releaseAwaitAllTilesTrigger)}this._layer=n,this._layerEventGroup=this._layer.on("stateChanged",this._onForegroundTileReady).on("requestRender",(function(){return e._emit("requestRender")}))},e.prototype._sortLayers=function(){for(var t=Math.round(this._camera.zoom),e=Object(i.c)([this._layer],this._deprecatedLayers,!0),n=e.reduce((function(t,e){var n=e.zoom;return Math.max(n,t)}),-1/0),o=0,r=e;o<r.length;o++){var a=r[o];t===a.zoom?a.element.style.zIndex=String(n):t>a.zoom?a.element.style.zIndex=String(a.zoom-t):a.element.style.zIndex=String(n-a.zoom)}},e}(Object(E.a)().with()),mt=n(230),ft=n(127),yt=function(t){function e(e){var n=e.size,o=e.camera,i=e.worldOptions,r=e.projection,a=e.dataSource,s=t.call(this)||this;return s._fov=O,s._fullRenderedZoom=-1/0,s.element=X("ymaps3x0--layer ymaps3x0--marker-layer"),s._size=n,s._camera=o,s._needsRender=!0,s._dataSource=a,s.projection=r,s.worldOptions=i,s._dataSourceEventGroup=s._dataSource.group().on("markerAdded",(function(t){return s._addMarker(t)})).on("markerRemoved",(function(t){return s._removeMarker(t)})),s._dataSource.markers.forEach((function(t){return s._addMarker(t)})),s}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return ft.a},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var t=this;this._dataSource.markers.forEach((function(e){return t._removeMarker(e)})),this._dataSourceEventGroup.offAll()},Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuth",{get:function(){return this._camera.azimuth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilt",{get:function(){return this._camera.tilt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.update=function(t,e){this._needsRender=!0,this._camera=t,this._fov=e,this._dataSource.markers.forEach((function(t){return t.onLayerUpdate()}))},e.prototype.resize=function(t){this._needsRender=!0,this._size=t},e.prototype.render=function(t){var e=t.qualityHint;this._needsRender&&(e>=g.a.FULL&&(this._fullRenderedZoom=this._camera.zoom),this._needsRender=e<g.a.FULL,this._reposition(e>=g.a.FULL||this._fullRenderedZoom===this._camera.zoom))},e.prototype.findObjectByElement=function(t){var e=Object(r.arrayFind)(this._dataSource.markers,(function(e){return e.container.contains(t)}));return e?{type:"marker",marker:e}:null},e.prototype.findObjectInPosition=function(t){var e=Object(U.e)(t,Object(i.a)(Object(i.a)({},this._camera),{size:this._size,container:this.element,fov:this._fov}));if(!isFinite(e.x)||!isFinite(e.y))return null;var n=document.elementFromPoint(e.x,e.y);if(!this.element.contains(n))return null;for(var o=0,r=this._dataSource.markers;o<r.length;o++){var a=r[o];if(a.container.contains(n))return{type:"marker",marker:a}}return null},e.prototype._addMarker=function(t){var e=t;e.attachToLayer(this),this.element.appendChild(e.container),this._needsRender=!0},e.prototype._removeMarker=function(t){var e=t;e.detachFromLayer(),this.element.removeChild(e.container),this._needsRender=!0},e.prototype._reposition=function(t){void 0===t&&(t=!1),this.element.style.transformOrigin="".concat(this._size.x/2,"px ").concat(this._size.y/2,"px"),this._dataSource.markers.forEach((function(e){return e.reposition(t)}))},e}(Object(E.a)().with());var vt="http://www.w3.org/2000/svg";function gt(t,e){for(var n=Math.floor((t+1)/2),o=Math.floor((e+1)/2),i=[],r=n;r<=o;r++)i.push(r);return i}function bt(t,e){if(t.length<3||e<=0)return Object(i.c)([],t,!0);var n=new Uint8Array(t.length);n[0]=1,n[t.length-1]=1,function t(e,n,o,i,r){var a=e[o],s=e[i],c=s.x-a.x,u=s.y-a.y;if(0!==c||0!==u){var l=Math.sqrt(Math.pow(c,2)+Math.pow(u,2));c/=l,u/=l}for(var d=0,h=0,p=-1/0,_=-1,m=o+1;m<i;m++){d=e[m].x-a.x,h=e[m].y-a.y;var f=0;if(0===c&&0===u)f=Math.pow(d,2)+Math.pow(h,2);else{var y=c*d+u*h;f=Math.pow(c*y-d,2)+Math.pow(u*y-h,2)}f>p&&(p=f,_=m)}p>r&&(n[_]=1,t(e,n,o,_,r),t(e,n,_,i,r))}(t,n,0,t.length-1,Math.pow(e,2));for(var o=[],r=0;r<t.length;r++)n[r]&&o.push(t[r]);return o}function St(t,e,n){for(var o=[],i={x:0,y:0},r={x:1/0,y:1/0},a={x:e,y:-e},s=0,u=0,l=0,d=t;l<d.length;l++){var h=d[l];s=h.x-r.x,u=h.y-r.y,(o.length<2||s>=n||s<=-n||u>=n||u<=-n)&&(c.mulv(h,a,i),o.push({x:i.x,y:i.y}),r.x=h.x,r.y=h.y)}return o}var xt=function(){function t(t,e,n){var o=this;this._strokeStamp="",this._lineSegments=[],this._simplifiedLineSegments=new r.Map,this._colorLines=new r.Map,this.worldsTranslations=[],this.geometry=Object(i.a)({},t.geometry),this.bbox=n,gt(n.minX,n.maxX).reduce((function(t,e){return t.add(e).add(-e)}),new r.Set).forEach((function(t){return o.worldsTranslations.push({x:2*t,y:0})})),this.worldsTranslations.sort((function(t,e){return t.x-e.x})),this.updateStyle(e)}return Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeSize",{get:function(){return this._strokeSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStrokeWidth",{get:function(){return this._maxStrokeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeStamp",{get:function(){return this._strokeStamp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPalette",{get:function(){return this.style.paletteColorStops.length>0},enumerable:!1,configurable:!0}),t.prototype.updateStyle=function(t){this._style=t,this._strokeSize="LineString"===this.geometry.type||"MultiLineString"===this.geometry.type?this._style.stroke.length:1,this._maxStrokeWidth=-1/0,this._strokeStamp="";for(var e=0;e<this._strokeSize;e++){var n=this.style.stroke[e];n.width>this._maxStrokeWidth&&(this._maxStrokeWidth=n.width),this._strokeStamp+=n.paletteColors.length>0?"c":"p"}"LineString"===this.geometry.type&&t.paletteColorStops.length>0&&(this._lineSegments=function(t,e){for(var n=[],o=0,i=0,r=e;i<r.length;i++){var a=r[i],s=t.slice(o,a+1);n.push({coordinates:s,length:Ot(s)}),o=a}return n}(this.geometry.coordinates,t.paletteColorStops))},t.prototype.getStrokeStyleForStrokeIndex=function(t){return this.style.stroke.length-1<t&&Object(Q.c)(new Error("Can't find stroke style for stroke with index ".concat(t))),this.style.stroke[this.style.stroke.length-1-t]},t.prototype.getSimplifiedLineSegments=function(t,e){var n=this;if(t=Math.round(t),!this._simplifiedLineSegments.has(t)){var o=H.a.getWorldPixelSize(t)/2,r=this._lineSegments.map((function(t){var r=St(t.coordinates,o,e);return Object(i.a)(Object(i.a)({},t),{coordinates:bt(r,n.style.simplificationRate)})}));this._simplifiedLineSegments.set(t,r)}return this._simplifiedLineSegments.get(t)},t.prototype.getColorLine=function(t,e,n){e=Math.round(e);var o="".concat(t,"_").concat(e);if(!this._colorLines.has(o)){var i=this.getStrokeStyleForStrokeIndex(t),r=i.paletteColors,a=i.simplifyPalette;this._colorLines.set(o,function(t,e,n,o){for(var i=[],r=t.length-1,a=1.5/H.a.getWorldPixelSize(n),s=[],c=0,u="",l=0,d={},h=0;h<t.length;h++){var p=t[h],_=p.coordinates,m=p.length;o?s.push.apply(s,_):s=_,c+=m;var f=e[h];d[f]=void 0===d[f]?m:d[f]+m,d[f]>l&&(l=d[f],u=f);var y=i[i.length-1];o&&h!==r&&(!y||u!==y.color)&&c<a||(y&&u===y.color?y.coordinates=y.coordinates.concat(s):i.push({coordinates:s,color:u}),s=[],c=0,u="",l=0,d={})}return i}(this.getSimplifiedLineSegments(e,n),r,e,a))}return this._colorLines.get(o)},t.prototype.hasStructuralDifferenceWithOtherModel=function(t){return this.geometry.type!==t.geometry.type||this._strokeStamp!==t.strokeStamp||"MultiPolygon"===this.geometry.type&&"MultiPolygon"===t.geometry.type&&this.geometry.coordinates.length!==t.geometry.coordinates.length},t}();function Ot(t){for(var e={x:0,y:0},n=0,o=1;o<t.length;o++)c.sub(t[o-1],t[o],e),n+=c.length(e);return n}function Et(t,e,n,o){var i=e.y-t.y,r=t.x-e.x,a=i*t.x+r*t.y,s=o.y-n.y,u=n.x-o.x,l=s*n.x+u*n.y,d=i*u-s*r;if(Math.abs(d)<1e-12)return null;var h=(u*a-r*l)/d,p=(l*i-a*s)/d;return c.create(h,p)}function zt(t,e,n){return void 0===n&&(n=!1),function(t,e,n){for(var o=t,i=[],r=e[e.length-1],a=0,s=e;a<s.length;a++){for(var c=s[a],u=o[n?o.length-1:0],l=0,d=o;l<d.length;l++){var h=d[l],p=wt(r,c,u);if(wt(r,c,h)){if(!p)null===(_=Et(r,c,u,h))&&Object(Q.c)(new Error("Lines are collinear or parallel")),i.push(_);i.push(h)}else if(p){var _;null===(_=Et(r,c,u,h))&&Object(Q.c)(new Error("Lines are collinear or parallel")),i.push(_)}u=h}o=i,i=[],r=c}return o}(t,e,n)}function wt(t,e,n){return(e.x-t.x)*(n.y-t.y)>(e.y-t.y)*(n.x-t.x)}var jt=n(229);function Rt(t){for(;t.firstChild;)t.removeChild(t.firstChild)}var Ct=[Object(i.a)({},c.ORIGIN)],Tt=function(){function t(t,e,n){this._recreateDomStructureOnNextRender=!1,this._clippedPointElements=[],this._renderedCenter=c.ORIGIN,this._renderedZoom=-1/0,this._renderedBBoxes=[],this._isVisible=!1,this._translation={x:0,y:0};var o="ymaps3x0--feature-".concat(t,"-").concat(e);this._model=n,this.element=document.createElementNS(vt,"g"),this.element.setAttribute("stroke-linejoin","round"),this.element.setAttribute("stroke-linecap","round"),this.element.setAttribute("id",o),this.elementCopy=document.createElementNS(vt,"use"),this.elementCopy.setAttribute("href","#".concat(o)),this.elementCopy.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#".concat(o)),this.elementCopy.setAttribute("data-feature-id",e),this._featureId=e,this._fullWorldVisibleData={worldsTranslations:Ct,bboxes:[n.bbox]},this._createDomStructure()}return Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!1,configurable:!0}),t.prototype.setModel=function(t){this._recreateDomStructureOnNextRender=this._recreateDomStructureOnNextRender||this._model.hasStructuralDifferenceWithOtherModel(t),this._model=t,this._teardownRenderedState(),this._fullWorldVisibleData={worldsTranslations:Ct,bboxes:[t.bbox]}},t.prototype.render=function(t){var e=t.fullWorldVisible?this._fullWorldVisibleData:this._computeWorldsTranslationsAndBBoxes(t.svgBBox,t.viewportWorldsTranslations),n=e.worldsTranslations,o=e.bboxes;0!==n.length?(this._setVisibility(!0),this._needsFullRender(o,t.zoom)?(this._fullRender(t,n,o),this.adjustStrokeWidthAndDash(t.clippingPadding)):this._reposition(t.pixelCenter)):this._setVisibility(!1)},t.prototype.adjustStrokeWidthAndDash=function(t,e){void 0===e&&(e=1),Math.min(this.model.maxStrokeWidth/e,t)===t&&(e=this.model.maxStrokeWidth/t);for(var n=0;n<this.model.strokeSize;n++){var o=this.model.getStrokeStyleForStrokeIndex(n),i=o.dash,r=(o.width/e).toFixed(3),a=(1===e?i:i.map((function(t){return t/e}))).join(" ");if("MultiPolygon"===this.model.geometry.type||"Polygon"===this.model.geometry.type)return this.element.setAttribute("stroke-width",r),void this.element.setAttribute("stroke-dasharray",a);var s=this.element.childNodes[n];s&&(s.setAttribute("stroke-width",r),s.setAttribute("stroke-dasharray",a))}},t.prototype._computeWorldsTranslationsAndBBoxes=function(t,e){for(var n=this.model,o=n.bbox,i=n.worldsTranslations,r={},a={worldsTranslations:[],bboxes:[]},s=0,c=e.concat(i);s<c.length;s++){var u=c[s];if(r[u.x]=r[u.x]||{},!r[u.x][u.y]){r[u.x][u.y]=!0;var d=l(t,{minX:o.minX+u.x,maxX:o.maxX+u.x,minY:o.minY+u.y,maxY:o.maxY+u.y});d&&(a.worldsTranslations.push(u),a.bboxes.push(d))}}return a},t.prototype._needsFullRender=function(t,e){if(this._recreateDomStructureOnNextRender||0===this._renderedBBoxes.length||this._renderedBBoxes.length!==t.length||this._renderedZoom!==e)return!0;for(var n=0;n<this._renderedBBoxes.length;n++)if(!p(this._renderedBBoxes[n],t[n]))return!0;return!1},t.prototype._reposition=function(t){var e=c.sub(this._renderedCenter,t);this._setTranslation(e.x,e.y)},t.prototype._fullRender=function(t,e,n){var o=t.fullWorldVisible||1===n.length&&_(this._model.bbox,n[0]);switch(this._renderedCenter=t.pixelCenter,this._renderedZoom=t.zoom,this._renderedBBoxes=n,this.element.style.cursor=this.model.style.cursor,this.model.style.interactive?this.element.style.pointerEvents="":this.element.style.pointerEvents="none",this._setTranslation(0,0),this._recreateDomStructureOnNextRender&&(this._recreateDomStructureOnNextRender=!1,this._createDomStructure()),this.model.geometry.type){case"Point":this.element.setAttribute("fill","none"),this._renderPoint(this.model.geometry.coordinates,t,e);break;case"LineString":case"MultiLineString":if(this.element.setAttribute("fill","none"),this.model.hasPalette)this._renderLineWithPalette(e,t,o);else{var i="LineString"===this.model.geometry.type?[this.model.geometry.coordinates]:this.model.geometry.coordinates;this._renderLinesWithoutPalette(i,e,t,o)}break;case"Polygon":case"MultiPolygon":this.element.setAttribute("fill",this.model.style.fill),this.element.setAttribute("fill-opacity",String(this.model.style.fillOpacity)),this.element.setAttribute("fill-rule",this.model.style.fillRule);var r=this.model.geometry,a="Polygon"===r.type?[r.coordinates]:r.coordinates;this._renderPolygons(a,e,t,o);break;default:Object(Q.c)(new Error("Unexpected geometry type: ".concat(this.model.geometry.type)))}},t.prototype._renderLineWithPalette=function(t,e,n){for(var o=null,i=0;i<this.model.strokeSize;i++){var r=this.element.childNodes[i],a=this.model.getStrokeStyleForStrokeIndex(i);a.paletteColors.length>0?this._renderColorLineStroke(r,i,e,n,t):(null===o&&(o=this._computeSplittedLinePath(e,n,t)),Mt(r,o,a))}},t.prototype._renderLinesWithoutPalette=function(t,e,n,o){for(var i=[],r=0,a=t;r<a.length;r++){var s=St(a[r],n.halfWorldSize,n.pointFilterBox);i.push(Pt(s,n,o,e,this.model.style.simplificationRate))}for(var c=i.join(" "),u=0;u<this.model.strokeSize;u++)Mt(this.element.childNodes[u],c,this.model.getStrokeStyleForStrokeIndex(u))},t.prototype._renderPolygons=function(t,e,n,o){for(var i=0;i<t.length;i++){for(var r=[],a=0,s=t[i];a<s.length;a++){var c=St(s[a],n.halfWorldSize,n.pointFilterBox);r.push(Pt(c,n,o,e,this.model.style.simplificationRate,!0))}Mt(this.element.childNodes[i],r.join(" "),this.model.style.stroke[0])}},t.prototype._renderColorLineStroke=function(t,e,n,o,i){var r=this,a=this.model.getColorLine(e,n.zoom,n.pointFilterBox),s=this.model.getStrokeStyleForStrokeIndex(e);Rt(t);var c=document.createDocumentFragment(),u=H.a.getScale(Math.round(n.zoom),n.zoom),l=null;a.forEach((function(t){var e=t.coordinates,a=t.color;if(a!==jt.a){var d=Pt(e,n,o,i,0,!1,u),h=At(r._featureId);Mt(h,d,s),h.setAttribute("stroke",a),c.insertBefore(h,l),l=h}})),t.appendChild(c)},t.prototype._computeSplittedLinePath=function(t,e,n){for(var o=[],i=0,r=this.model.getSimplifiedLineSegments(t.zoom,t.pointFilterBox);i<r.length;i++){var a=r[i].coordinates;o.push.apply(o,a)}return Pt(o,t,e,n,0,!1,H.a.getScale(Math.round(t.zoom),t.zoom))},t.prototype._renderPoint=function(t,e,n){this._setImageElementsCount(n.length);for(var o=this.model.style.icon,i=o.scale,r=o.offset,a="scale(".concat(i,") translate(").concat(100*r[0],"%, ").concat(100*r[1],"%)"),s=0;s<n.length;s++){var u=this.element.children[s];u.getAttribute("transform")!==a&&(u.style.transform=a),u.getAttribute("href")!==this.model.style.icon.url&&u.setAttribute("href",this.model.style.icon.url);var l=c.add(t,n[s]),d=H.a.worldToRelativePixels(l,e.zoom);c.sub(d,e.pixelCenter,d),u.setAttribute("x",d.x.toString()),u.setAttribute("y",d.y.toString())}},t.prototype._setImageElementsCount=function(t){for(;this.element.children.length<t;){var e=document.createElementNS(vt,"image");e.style.transformBox="fill-box",e.setAttribute("data-feature-id",this._featureId),this.element.appendChild(e)}for(;this.element.children.length>t&&this.element.lastChild;)this.element.removeChild(this.element.lastChild)},t.prototype._setPointVisibility=function(t){t?this._unclipPoint():this._clipPoint()},t.prototype._clipPoint=function(){this._clippedPointElements.length=0;for(var t=0;t<this.element.children.length;t++){var e=this.element.children[t];this._clippedPointElements.push(e),this.element.removeChild(e)}},t.prototype._unclipPoint=function(){for(var t=0,e=this._clippedPointElements;t<e.length;t++){var n=e[t];this.element.appendChild(n)}this._clippedPointElements.length=0},t.prototype._createDomStructure=function(){if(Rt(this.element),"Point"!==this.model.geometry.type)if("MultiPolygon"!==this.model.geometry.type)for(e=0;e<this.model.strokeSize;e++){var t=this.model.getStrokeStyleForStrokeIndex(e).paletteColors.length>0&&"LineString"===this.model.geometry.type?document.createElementNS(vt,"g"):At(this._featureId);this.element.appendChild(t)}else for(var e=0;e<this.model.geometry.coordinates.length;e++){var n=At(this._featureId);this.element.appendChild(n)}},t.prototype._setVisibility=function(t){this._isVisible!==t&&(this.element.style.display=t?"":"none","Point"===this._model.geometry.type&&this._setPointVisibility(t),this._isVisible=t)},t.prototype._setTranslation=function(t,e){this._translation.x===t&&this._translation.y===e||(this.element.setAttribute("transform","translate(".concat(t," ").concat(e,")")),this._translation={x:t,y:e})},t.prototype._teardownRenderedState=function(){this._renderedZoom=-1/0,this._renderedBBoxes=[],this._renderedCenter=c.ORIGIN},t}();function Pt(t,e,n,o,i,r,a){void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=1);for(var s=[],u={x:0,y:0},l=function(o){var l=H.a.worldToRelativePixels(o,e.zoom),d=t;if(!n){var h=c.sub(e.pixelCenter,l),p=e.clippingWindow.map((function(t){var e=c.add(t,h);return 1===a?e:c.divn(e,a,e)}));d=zt(t,p,r)}if(d.length>0){var _=0===i?d:bt(d,i),m=c.sub(l,e.pixelCenter),f="M"+_.map((function(t){return 1!==a&&(t=c.muln(t,a,u)),c.add(t,m,u),"".concat(u.x,",").concat(u.y)})).join(" L");r&&(f+=" Z"),s.push(f)}},d=0,h=o;d<h.length;d++){l(h[d])}return s.join(" ")}function At(t){var e=document.createElementNS(vt,"path");return e.setAttribute("data-feature-id",t),e}function Mt(t,e,n){t.setAttribute("d",e);var o=n.opacity,i=n.color;t.setAttribute("stroke-opacity",String(o)),t.setAttribute("stroke",i)}var Lt=n(100),Dt={x:50,y:50},It=18*x.a,kt=0,Ft=function(t){function e(e,n,o,i){var a=t.call(this)||this;a._svg=document.createElementNS(vt,"svg"),a._zeroWorld=document.createElementNS(vt,"g"),a._groups=new r.Map,a._features=new r.Map,a._nodesToRemove=new r.Set,a._renderedWorldCopies=new r.Set,a._multiWorldsSource=document.createDocumentFragment(),a._layerId=String(kt++),a._elementChildrenKey=Object(r.Symbol)("childrenSet"),a._shouldRender=!0,a._fullWorldRendered=!1,a._lastTimeStrokeAdjusted=0,a._willChangeFlag=!1,a._fov=O,a._isSvgFixedAtAzimuth=!1,a.element=X("ymaps3x0--layer ymaps3x0--graphics-layer"),a._camera=n,a.resize(e),a._worldOptions=o,a._dataSource=i,a._renderedZoom=n.zoom,a._zoomOfAdjustedStoke=n.zoom,a._renderedCenter=n.worldCenter;var s=document.createElementNS(vt,"g");return a._multiWorldsSource.appendChild(s),a._groups.set(Lt.b,{id:Lt.b,element:a._zeroWorld,elementCopy:s}),a._svg.appendChild(a._zeroWorld),a._svg.setAttributeNS("xmlns","xlink","http://www.w3.org/1999/xlink"),a._svg.ondragstart=function(){return!1},a.element.appendChild(a._svg),a._dataSourcesSubscriptions=i.group().on("groupAdded",(function(t){return a._addGroup(t)})).on("groupRemoved",(function(t){return a._removeGroup(t)})).on("featureAdded",(function(t){return a._addFeatureById(t)})).on("featureRemoved",(function(t){return a._removeFeatureById(t)})).on("featureUpdated",(function(t){return a._updateFeatureById(t)})).on("featureMovedToGroup",(function(){return a._shouldRender=!0})),a._dataSource.groups.forEach((function(t){var e=t.id;e!==Lt.b&&a._addGroup(e)})),a._dataSource.features.forEach((function(t){var e=t.id;return a._addFeatureById(e)})),a}return Object(i.b)(e,t),e.prototype.destroy=function(){this._features.clear(),this._dataSourcesSubscriptions.offAll(),this._shouldRender=!0},Object.defineProperty(e.prototype,"state",{get:function(){return ft.a},enumerable:!1,configurable:!0}),e.prototype.resize=function(t){this._size=t,this._halfSize=c.divn(this._size,2),this._setSvgSizeValues(),this._shouldRender=!0,this._updatePerspective()},e.prototype.update=function(t,e){this._camera=t,this._fov=e},e.prototype.render=function(t){var e=t.qualityHint;if(this._cleanupNodesToRemove(),this._updatePerspective(),0!==this._features.size){this.element.style.setProperty("display",null);var n=this._getVisibleWorlds(),o=H.a.getScale(this._renderedZoom,this._camera.zoom);e===g.a.QUICK?(this._setWillChange(!0),this._positionZeroWorld(o)):this._needsFullRender(e)?(this._fullRender(n),this._renderWorldCopies(this._camera.zoom,!0)):(this._adjustStrokeWidthAndDash(o),this._positionZeroWorld(o),this._renderWorldCopies(this._renderedZoom))}else this.element.style.display="none"},e.prototype.findObjectInPosition=function(t){var e=Object(U.e)(t,Object(i.a)(Object(i.a)({},this._camera),{size:this._size,container:this.element,fov:this._fov}));if(!isFinite(e.x)||!isFinite(e.y))return null;var n=document.elementFromPoint(e.x,e.y);if(!n)return null;var o=n.getAttribute("data-feature-id");return null!==o&&this._dataSource.hasFeatureWithId(o)&&this.element.contains(n)?{type:"feature",featureId:o}:null},e.prototype._addGroup=function(t){var e=document.createElementNS(vt,"g");this._groups.set(t,{id:t,element:e,elementCopy:e.cloneNode()}),this._shouldRender=!0},e.prototype._removeGroup=function(t){var e=t.id,n=t.removed;this._nodesToRemove.add(this._groups.get(e));for(var o=0,i=n;o<i.length;o++){var r=i[o];"feature"===r.type?this._removeFeatureById(r.id):this._groups.delete(r.id)}this._shouldRender=!0},e.prototype._addFeatureById=function(t){var e=this._dataSource.features.get(t),n=e.feature,o=e.style,i=e.bbox,r=new xt(n,o,i),a=new Tt(this._layerId,n.id,r),s={id:n.id,element:a.element,elementCopy:a.elementCopy,renderer:a};this._features.set(n.id,s),this._shouldRender=!0},e.prototype._removeFeatureById=function(t){this._nodesToRemove.add(this._features.get(t)),this._features.delete(t),this._shouldRender=!0},e.prototype._updateFeatureById=function(t){var e=this._features.get(t),n=this._dataSource.features.get(t),o=n.feature,i=n.style,r=n.bbox;e.renderer.setModel(new xt(o,i,r)),this._shouldRender=!0},e.prototype._needsFullRender=function(t){if(t===g.a.QUICK)return!1;var e=this._computeHalfSvgWorldSize(),n={minX:this._renderedCenter.x-e.x,maxX:this._renderedCenter.x+e.x,minY:this._renderedCenter.y-e.y,maxY:this._renderedCenter.y+e.y},o=this._computeHalfViewportSize(),i=!p(n,{minX:this._camera.worldCenter.x-o.x,maxX:this._camera.worldCenter.x+o.x,minY:this._camera.worldCenter.y-o.y,maxY:this._camera.worldCenter.y+o.y}),r=Math.abs(this._renderedZoom-this._camera.zoom);return i||r>=2||t===g.a.FULL&&(this._shouldRender||this._camera.zoom!==this._renderedZoom)},e.prototype._fullRender=function(t){var e=this;this._setSvgSizeValues(),this._setSvgAttributes();var n=this._getRenderVariables(t);this._setWillChange(!1),this._shouldRender=!1,this._renderedZoom=this._camera.zoom,this._renderedCenter=this._camera.worldCenter,this._fullWorldRendered=n.fullWorldVisible,this._zoomOfAdjustedStoke=this._camera.zoom,this._lastTimeStrokeAdjusted=performance.now(),this._positionZeroWorld(),this._dataSource.groups.forEach((function(t){var o=e._groups.get(t.id),i=o.element,r=o.elementCopy;i.setAttribute("opacity",String(t.style.opacity)),r.setAttribute("opacity",String(t.style.opacity)),e._renderChildren(t.children,i,r,n)}))},e.prototype._updatePerspective=function(){var t=Object(U.a)(this._size.y,this._fov);this._perspective!==t&&(this._perspective=t,this.element.style.perspective="".concat(t,"px"))},e.prototype._renderChildren=function(t,e,n,o){for(var i,r,a=null,s=null,c=0,u=(r=function(t,e){return e.style.zIndex-t.style.zIndex},(i=t).map((function(t,e){return e})).sort((function(t,e){var n=i[t],o=i[e],a=r(n,o);return 0!==a?a:t-e})).map((function(t){return i[t]})));c<u.length;c++){var l=u[c],d=void 0,h=void 0;switch(l.type){case"group":var p=this._groups.get(l.id);d=p.element,h=p.elementCopy;break;case"feature":var _=this._features.get(l.id);_.renderer.render(o),d=_.element,h=_.elementCopy}this._insertElementBefore(e,d,a),this._insertElementBefore(n,h,s),a=d,s=h}},e.prototype._getCachedChildren=function(t){var e,n;return(e=t)[n=this._elementChildrenKey]||(e[n]=new r.Set)},e.prototype._insertElementBefore=function(t,e,n){var o=this._getCachedChildren(t);o.has(e)||(t.insertBefore(e,n),o.add(e))},e.prototype._removeElement=function(t){var e=t.parentNode;e&&(e.removeChild(t),this._getCachedChildren(e).delete(t))},e.prototype._adjustStrokeWidthAndDash=function(t){var e=performance.now(),n=e-this._lastTimeStrokeAdjusted;Math.abs(this._zoomOfAdjustedStoke-this._camera.zoom)>=.5&&n>250?(this._setWillChange(!1),this._zoomOfAdjustedStoke=this._camera.zoom,this._lastTimeStrokeAdjusted=e,this._features.forEach((function(e){e.renderer.adjustStrokeWidthAndDash(50,t)}))):this._setWillChange(!0)},e.prototype._cleanupNodesToRemove=function(){var t=this;0!==this._nodesToRemove.size&&(this._nodesToRemove.forEach((function(e){t._removeElement(e.element),t._removeElement(e.elementCopy)})),this._nodesToRemove.clear())},e.prototype._getSvgPixelBBox=function(){var t=H.a.worldToPixels(this._camera.worldCenter,this._camera.zoom);return{minX:t.x-this._halfSvgSize.x,maxX:t.x+this._halfSvgSize.x,minY:t.y-this._halfSvgSize.y,maxY:t.y+this._halfSvgSize.y}},e.prototype._getClippingWindow=function(t){var e=h(t,Dt),n=e.minX,o=e.maxX,i=e.minY,r=e.maxY,a=H.a.worldToPixels(this._camera.worldCenter,this._camera.zoom),s=c.sub({x:n,y:i},a);return[c.sub({x:n,y:r},a),s,c.sub({x:o,y:i},a),c.sub({x:o,y:r},a)]},e.prototype._positionZeroWorld=function(t){void 0===t&&(t=1);var e=this._worldOptions.cycledX?H.a.moveCloseToCenter(this._renderedCenter,this._camera.worldCenter):this._renderedCenter,n=this._camera,o=n.zoom,i=n.azimuth,r=n.tilt,a=H.a.worldToRelativePixels(e,o),s=H.a.worldToRelativePixels(this._camera.worldCenter,o),u=c.sub(a,s),l=c.sub(this._halfSize,this._halfSvgSize),d="translate3d(".concat(u.x,"px, ").concat(u.y,"px, 0px)"),h="translate3d(".concat(l.x,"px, ").concat(l.y,"px, 0px)"),p=["".concat(h),"rotateX(".concat(r,"rad)"),"rotateZ(".concat(i,"rad)"),"".concat(d),"scale(".concat(t,")")];this._svg.style.setProperty("transform",p.join(" "))},e.prototype._clearWorldCopies=function(){for(var t=this._svg.querySelectorAll("g[data-world-copy]"),e=0;e<t.length;e++)this._svg.removeChild(t[e]);this._renderedWorldCopies.clear()},e.prototype._renderWorldCopies=function(t,e){void 0===e&&(e=!1),this._worldOptions.cycledX&&(e&&this._clearWorldCopies(),this._fullWorldRendered&&this._makeMissingWorldCopies(t))},e.prototype._makeMissingWorldCopies=function(t){for(var e=H.a.getWorldPixelSize(t),n=0,o=Object(i.c)([-1,1],this._getVisibleWorlds(),!0);n<o.length;n++){var r=o[n];if(0!==r&&!this._renderedWorldCopies.has(r)){var a=document.createElementNS(vt,"g");a.setAttribute("data-world-copy",String(r));var s=this._halfSvgSize.x+e*r;a.setAttribute("transform","translate(".concat(s,", ").concat(this._halfSvgSize.y,")")),a.appendChild(this._multiWorldsSource.cloneNode(!0)),this._svg.appendChild(a),this._renderedWorldCopies.add(r)}}},e.prototype._getVisibleWorlds=function(){var t=this._computeHalfViewportSize().x+2/180*10,e=this._camera.worldCenter;return gt(e.x-t,e.x+t)},e.prototype._getRenderVariables=function(t){var e,n,o,i,r,a,s,c,u=H.a.getWorldPixelSize(this._camera.zoom),l=this._getSvgPixelBBox(),d=(e=l,n=this._camera.zoom,o=e.minX,i=e.maxX,r=e.minY,a=e.maxY,s=H.a.pixelsToWorld({x:o,y:a},n),c=H.a.pixelsToWorld({x:i,y:r},n),{minX:s.x,maxX:c.x,minY:s.y,maxY:c.y}),h=d.minX<=-1&&d.maxX>=1;return{pixelCenter:H.a.worldToRelativePixels(this._camera.worldCenter,this._camera.zoom),zoom:this._camera.zoom,worldSize:u,halfWorldSize:u/2,clippingWindow:this._getClippingWindow(l),clippingPadding:50,pointFilterBox:1/u,fullWorldVisible:h,viewportWorldsTranslations:t.map((function(t){return{x:2*t,y:0}})),svgBBox:d}},e.prototype._setWillChange=function(t){this._willChangeFlag!==t&&(this._willChangeFlag=t,this._svg.style.setProperty("will-change",t?"transform":""))},e.prototype._computeHalfViewportSize=function(){var t=H.a.convertPixelSizeToWorldSize(this._halfSize,this._camera.zoom);return c.applyFunction(t,Math.abs,t),t},e.prototype._computeHalfSvgWorldSize=function(){var t=H.a.convertPixelSizeToWorldSize(this._halfSvgSize,this._renderedZoom);if(c.applyFunction(t,Math.abs,t),this._camera.tilt){var e=Math.cos(pt.a),n={x:this._camera.azimuth?e:1,y:e};c.mulv(t,n,t)}if(this._camera.azimuth){var o=Object(q.a)(-It,0,2*Math.PI)<this._camera.azimuth||this._camera.azimuth<It,i=this._isSvgFixedAtAzimuth||o?.65:.45;c.muln(t,i,t)}return t},e.prototype._setSvgSizeValues=function(){var t=c.muln(this._size,2);if(this._camera.tilt){var e={x:1,y:1/Math.cos(pt.a)};c.mulv(t,e,t)}if(this._camera.azimuth){var n=c.length(t);t={x:n,y:n},this._isSvgFixedAtAzimuth=!0}else this._isSvgFixedAtAzimuth=!1;this._svgSize=t,this._halfSvgSize=c.divn(t,2)},e.prototype._setSvgAttributes=function(){this._svg.setAttribute("width",String(this._svgSize.x)),this._svg.setAttribute("height",String(this._svgSize.y)),this._svg.setAttribute("viewBox","0 0 ".concat(this._svgSize.x," ").concat(this._svgSize.y)),this._zeroWorld.setAttribute("transform","translate(".concat(this._halfSvgSize.x,", ").concat(this._halfSvgSize.y,")"))},e}(Object(E.a)().with());var Gt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._markers=[],e.markers=e._markers,e}return Object(i.b)(e,t),e.prototype.addMarker=function(t){this._markers.push(t),this._emit("markerAdded",t),this._emit("changed")},e.prototype.removeMarker=function(t){var e=Object(r.arrayFindIndex)(this._markers,(function(e){return e===t}));-1!==e&&(this._markers.splice(e,1),this._emit("markerRemoved",t),this._emit("changed"))},e}(Object(E.a)().with()),Wt=n(128),Zt=n(101),Bt=new r.WeakMap,Nt=function(t){function e(e,n,o,a,s,c,u,l){var d=t.call(this)||this;return d._layerImplementationsById=new r.Map,d._dataSourceSubscriptions=[],d._dataSources={},d._processingQueue=new at.a(20),d.element=X(),d._createLayerImplementation=function(t){if("customDomLayer"===t.type){t.options.raster.implementation||Object(Q.c)(new Error("Implementation not provided"));var e=new(0,t.options.raster.implementation)({camera:d._camera,size:d._size,projection:d._projection,layerDescription:t});e instanceof Wt.a||Object(Q.c)(new Error("Implementation must be derived from CustomDomLayer"));var n=e.group().on("requestRender",d._requestRenderLoopUpdate);return Object(i.a)(Object(i.a)({},t),{layer:e,eventGroup:n})}var o=d._dataSources[t.source];if(o instanceof Lt.a)return d._createGraphicsLayerImplementation(t,o);if(o instanceof Gt)return d._createMarkersLayerImplementation(t,o);if(o instanceof Zt.a)throw new Error("Tile3dDataSource is not supported by raster engine");return d._createTileLayerImplementation(t,o)},d._destroyLayerImplementation=function(t){d._removeLayerElementFromDom(t.layer),t.layer.destroy(),t.eventGroup.offAll(),d._resetTileHotspotsLayer(t,null),t.tileSourceEventGroup&&t.tileSourceEventGroup.offAll()},d._requestRenderLoopUpdate=function(){return d.renderLoop.update()},d._emitHotspotsChanged=function(){return d._emit("hotspotsChanged")},d._onLayerStateChange=function(){var t=!0,e=!1,n=!0,o=!1;d._layerImplementationsById.forEach((function(i){var r=i.layer,a=Bt.get(r),s=a.loaded;a.loaded=r.state.tilesLoaded===r.state.tilesTotal,t=t&&a.loaded,!s&&a.loaded&&(e=!0);var c=a.ready;a.ready=r.state.tilesReady===r.state.tilesTotal,n=n&&a.ready,!c&&a.ready&&(o=!0)})),d._emit("stateChanged"),t&&e&&d._emit("tilesLoaded"),n&&o&&d._emit("tilesReady")},d._size=e,d._camera=n,d._worldOptions=a,d._projection=s,d.renderLoop=o,d._zoomRoundingRule=u,d.animateFirstScreen=l,d._layers=[],d._renderLoopSubscriptions=d.renderLoop.on("render",d._render.bind(d)),d.setDataSources(c),d}return Object(i.b)(e,t),e.prototype.setDataSources=function(t){this._destroyDataSourceSubscriptions(),this._dataSources=Object(i.a)({},t);for(var e=0,n=Object.keys(this._dataSources);e<n.length;e++){var o=n[e];this._dataSourceSubscriptions.push(this._dataSources[o].on("changed",this._requestRenderLoopUpdate))}},e.prototype.setLayers=function(t){var e=[];this._layerImplementationsById.forEach((function(t,n){return e.push(n)}));for(var n=new r.Map,o=0,i=t;o<i.length;o++){var a=i[o],s=this._dataSources[a.source];(s instanceof rt.a&&s.rasterSourceDescription&&"ground"===a.type||s instanceof Lt.a||s instanceof Gt||"customDomLayer"===a.type)&&n.set(a.id,a)}var c=Object(st.a)(this._layerImplementationsById,n,this._createLayerImplementation,this._destroyLayerImplementation,(function(){}),(function(t,e){return t.source===e.source&&t.type===e.type}));this._layerImplementationsById=c.result,this._flattenLayers(),this._layerImplementationsById.forEach((function(t){var e=t.layer;Bt.has(e)||Bt.set(e,{ready:e.state.tilesReady===e.state.tilesTotal,loaded:e.state.tilesLoaded===e.state.tilesTotal})})),this._applyLayersOptions(),this._addLayerElementsToDom(),0===c.created.length&&0===c.removed.length&&function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(e,t.map((function(t){return t.id})))||(this._emit("stateChanged"),this.renderLoop.update())},e.prototype.getIndoorPlans=function(){return null},e.prototype.getVisibleObjects=function(){return null},e.prototype.getLayerReadyState=function(t){var e=this._layerImplementationsById.get(t);return e?e.layer.state:void 0},e.prototype.destroy=function(){this.setLayers([]),this._destroyDataSourceSubscriptions(),this._renderLoopSubscriptions.offAll(),this._removeLayerElementsFromDom()},e.prototype.update=function(t,e){this._camera=t,this._layers.forEach((function(n){return n.layer.update(t,e)}))},e.prototype.resize=function(t){this._size=t,this._layers.forEach((function(e){return e.layer.resize(t)}))},e.prototype.findObjectInPosition=function(t){for(var e=this._layers.length-1;e>=0;e--){var n=this._layers[e],o=n.layer,r=n.implementation,a=r.id,s=r.source,c=o.findObjectInPosition(t);if(c)return Object(i.a)({layer:a,source:s},c)}return null},e.prototype.findObjectInPositionEx=function(t){for(var e={layers:[]},n=this._layers.length-1;n>=0;n--){var o=this._layers[n],r=o.layer,a=o.implementation,s=a.id,c=a.source,u=r.findObjectInPosition(t);if(e.layers.push({layer:s,object:u&&Object(i.a)({layer:s,source:c},u)}),u)break}return e},e.prototype.findMarkerByElement=function(t){for(var e=this._layers.length-1;e>=0;e--){var n=this._layers[e],o=n.layer,r=n.implementation,a=r.id,s=r.source;if(o instanceof yt){var c=o.findObjectByElement(t);if(c)return Object(i.a)(Object(i.a)({},c),{layer:a,source:s})}}return null},e.prototype._flattenLayers=function(){var t=this;this._layers=[],this._layerImplementationsById.forEach((function(e){t._layers.push({layer:e.layer,implementation:e}),e.hotspots&&t._layers.push({layer:e.hotspots.layer,implementation:e})}))},e.prototype._createGraphicsLayerImplementation=function(t,e){var n=new Ft(this._size,this._camera,this._worldOptions,e),o=n.group().on("requestRender",this._requestRenderLoopUpdate);return Object(i.a)(Object(i.a)({},t),{layer:n,eventGroup:o})},e.prototype._createMarkersLayerImplementation=function(t,e){var n=new yt({size:this._size,camera:this._camera,worldOptions:this._worldOptions,projection:this._projection,dataSource:e}),o=n.group().on("requestRender",this._requestRenderLoopUpdate);return Object(i.a)(Object(i.a)({},t),{layer:n,eventGroup:o})},e.prototype.preloadHotspotsInPoint=function(t){this._layerImplementationsById.forEach((function(e){var n=e.hotspots;n&&n.layer.preloadHotspotsInPoint(t)}))},e.prototype.preloadHotspotsForViewport=function(){this._layerImplementationsById.forEach((function(t){var e=t.hotspots;e&&e.layer.preloadHotspotsForViewport()}))},e.prototype.setObjectFilters=function(t){},e.prototype.setInvisibleCollidingPrimitives=function(t){},e.prototype.setObjectHighlight=function(t){},e.prototype._createTileLayerImplementation=function(t,e){var n=this,o=new _t(this._size,this._camera,e,this._zoomRoundingRule,this.animateFirstScreen,this._processingQueue),r=o.group().on("stateChanged",this._onLayerStateChange).on("requestRender",this._requestRenderLoopUpdate),a=e.group(),s=Object(i.a)(Object(i.a)({},t),{layer:o,eventGroup:r,tileSourceEventGroup:a});return a.on("sourceChanged",(function(){n._resetTileHotspotsLayer(s,e.getHotspotTileDataSource())})),this._resetTileHotspotsLayer(s,e.getHotspotTileDataSource()),s},e.prototype._resetTileHotspotsLayer=function(t,e){if(!(!e&&!t.hotspots||e&&t.hotspots&&Object(rt.b)(t.hotspots.source,e))){if(t.hotspots&&(t.hotspots.eventGroup.offAll(),t.hotspots.layer.destroy(),t.hotspots=void 0),e){var n=new mt.a(this._size,this._camera,e,this._processingQueue,this._worldOptions,this._zoomRoundingRule),o=n.on("hotspotsChanged",this._emitHotspotsChanged).on("requestRender",this._requestRenderLoopUpdate);t.hotspots={layer:n,eventGroup:o,source:e}}this._flattenLayers()}},e.prototype._render=function(t){this._processingQueue.pause(),this._layers.forEach((function(e){return e.layer.render(t)})),this._processingQueue.resume()},e.prototype._removeLayerElementFromDom=function(t){t.element&&t.element.parentElement&&t.element.parentElement.removeChild(t.element)},e.prototype._removeLayerElementsFromDom=function(){for(var t=0,e=this._layers;t<e.length;t++){var n=e[t].layer;this._removeLayerElementFromDom(n)}},e.prototype._addLayerElementsToDom=function(){for(var t=new r.Map,e=0,n=this._layers;e<n.length;e++){var o=n[e].layer;if(o.element){var i=this.element,a=t.get(i)||0,s=i.childNodes[a];o.element!==s&&i.insertBefore(o.element,s||null),t.set(i,a+1)}}},e.prototype._applyLayersOptions=function(){for(var t,e=0,n=this._layers;e<n.length;e++){var o=n[e],i=o.layer,r=o.implementation;if(i.element){var a=Object(q.b)(null!==(t=r.options.raster.opacity)&&void 0!==t?t:1,0,1);i.element.style.opacity=String(a)}}},e.prototype._destroyDataSourceSubscriptions=function(){for(var t=0,e=this._dataSourceSubscriptions;t<e.length;t++){e[t].offAll()}this._dataSourceSubscriptions=[]},Object.defineProperty(e.prototype,"fov",{get:function(){return O},enumerable:!1,configurable:!0}),e}(Object(E.a)().with());var Yt,Ht=n(123),Xt=Object(Ht.a)("ease");function Vt(t,e,n){return t(e)-t(e-n)}function Ut(t,e,n,o,i){void 0===i&&(i=Xt);var r=o?H.a.worldToRelativePixels(c.sub(o,t.worldCenter),t.zoom):null,a=Kt(i,e-t.zoom,r);return t.animateForDuration(n,a)}function qt(t,e,n,o){if(void 0===o&&(o=Xt),c.areFuzzyEqual(e,c.ORIGIN,1e-10))return{complete:Promise.resolve(),isRunning:!1,stop:function(){}};var r=Object(Ht.a)(o);return t.animateForDuration(n,(function(t,n,o){var a=c.muln(e,Vt(r,n,o)),s=c.add(t.worldCenter,a);return Object(i.a)(Object(i.a)({},t),{worldCenter:s})}))}function Qt(t,e,n,o,r){return void 0===r&&(r=Xt),Math.abs(n-t.zoom)<1e-10?qt(t,c.sub(e,t.worldCenter),o,r):function(t,e,n,o,r){void 0===r&&(r=Xt);var a=t.worldCenter,s={x:0,y:0},c={x:!1,y:!1},u=Kt(r,n-t.zoom,s);return t.animateForDuration(o,(function(o,r,l){if(1===r)return Object(i.a)(Object(i.a)({},o),{worldCenter:e,zoom:n});var d=H.a.convertPixelSizeToWorldSize(t.size,o.zoom),h=!t.worldOptions.cycledX&&d.x>2,p=!t.worldOptions.cycledY&&Math.abs(d.y)>2;if(!c.x&&!h){var _=Jt(e,n,a,o.zoom).x;s.x=_,c.x=!0}if(!c.y&&!p){var m=Jt(e,n,a,o.zoom).y;s.y=m,c.y=!0}return u(o,r,l)}))}(t,e,n,o,r)}function Kt(t,e,n){var o=Object(Ht.a)(t);return function(t,r,a){var s=t.zoom+e*Vt(o,r,a);if(!n)return Object(i.a)(Object(i.a)({},t),{zoom:s});var u=c.sub(H.a.convertPixelSizeToWorldSize(n,t.zoom),H.a.convertPixelSizeToWorldSize(n,s)),l=c.add(t.worldCenter,u);return Object(i.a)(Object(i.a)({},t),{worldCenter:l,zoom:s})}}function Jt(t,e,n,o){var i=e-o,a=c.sub(t,n),s=c.muln(a,Object(r.mathSign)(i)/(Math.pow(2,Math.abs(i))-1)),u=i>0?t:n,l=c.add(u,s);return H.a.worldToRelativePixels(c.sub(l,n),o)}function $t(t,e,n){var o=e.zoom,i=e.azimuth,r=H.a.getScale(o,n),a=c.muln(t,r-1);return c.rotate(H.a.convertPixelSizeToWorldSize(a,n,a),i)}!function(t){t[t.ZOOM_TO_CENTER=0]="ZOOM_TO_CENTER",t[t.ZOOM_TO_POINTER=1]="ZOOM_TO_POINTER"}(Yt||(Yt={}));var te=function(t){function e(e,n,o,a){var u=t.call(this)||this;return u._deltaAccumulator=0,u._zoomPointCenterOffset=c.ORIGIN,u._onWheel=function(t){var e=Date.now();u._deltaAccumulator=t;var n=u.zoomDuration;if(u._updateWheelTrend(t)&&!(u._state&&e-u._state.startTs<n)){u._zoomPointCenterOffset=c.sub(u._zoomPointSource(),c.divn(u._map.size,2));var o=Object(r.mathSign)(u._deltaAccumulator);u._deltaAccumulator=0;var i=u._computeNewState(u._state,e,o);if(i){var a=!u._state;u._state=i,a&&u._emit("zoomStart")}u._state&&!u.isInAction&&(u._animation=u._map.animate(u._animationStep),Object(s.promiseFinally)(u._animation.complete,(function(){return u._emit("zoomEnd")})))}},u._animationStep=function(t){var e=ee(u._state,Date.now()),n=e.zoom;if(e.dt>=u._state.duration+50&&(u._animation.stop(),u._animation=void 0,u._state=void 0,u._currentWheelTrend=void 0),n===t.zoom)return t;var o=$t(u._zoomPointCenterOffset,t,n),r=c.add(t.worldCenter,o);return Object(i.a)(Object(i.a)({},t),{worldCenter:r,zoom:n})},u._map=e,u._device=n,u._zoomPointSource=o,u.zoomDuration=a,u._init(),u}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._device.on("wheel",this._onWheel))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0)},e.prototype._computeNewState=function(t,e,n){var o=t?ee(t,e).zoom:this._map.zoom,i=o+n;if(t&&(i=Object(q.b)(i,t.startZoom-4,t.startZoom+4)),i=Object(q.b)(i,this._map.zoomRange.min,this._map.zoomRange.max),i=Math.round(i),(i=Number(i.toFixed(2)))!==o)return{startZoom:o,targetZoom:i,startTs:e,duration:this.zoomDuration}},e.prototype._updateWheelTrend=function(t){var e=this._currentWheelTrend,n=Object(r.mathSign)(t);return!(Math.abs(n)<1e-10)&&(this._currentWheelTrend=n,!e||n===e)},e}(Object(E.a)().with());function ee(t,e){var n=e-t.startTs,o=Object(q.b)(n/t.duration,0,1);return{zoom:t.startZoom+(t.targetZoom-t.startZoom)*o,dt:n}}var ne=function(t){function e(e,n,o){var a=t.call(this)||this;return a._wheelAccumulator=0,a._zoomPointCenterOffset=c.ORIGIN,a._deltaZoom=0,a._prevFrameTimestamp=0,a._onWheel=function(t){a._wheelAccumulator+=t,a._zoomPointCenterOffset=c.sub(a._zoomPointSource(),c.divn(a._map.size,2)),a._animation||(a._prevFrameTimestamp=Date.now(),a._animation=a._map.animate(a._animationStep),Object(s.promiseFinally)(a._animation.complete,(function(){clearTimeout(a._zoomEndTimer),a._zoomEndTimer=setTimeout((function(){a._emit("zoomEnd"),a._zoomEndTimer=void 0}))})),clearTimeout(a._zoomEndTimer),a._zoomEndTimer=void 0,a._emit("zoomStart"))},a._animationStep=function(t){var e,n,o,s,u;a._wheelAccumulator&&(Object(r.mathSign)(a._wheelAccumulator)!==Object(r.mathSign)(a._deltaZoom)&&(a._deltaZoom=0),a._deltaZoom+=(e=a._wheelAccumulator,n=a._deltaZoom,o=Object(r.mathSign)(e),s=Math.min(1,1/Math.abs(5.5*Math.abs(n)-1)),u=Object(q.b)(Math.abs(e)*s/600,.005,2),o*u),a._wheelAccumulator=0);var l,d=Date.now();if(d-a._prevFrameTimestamp>400||Math.abs(a._deltaZoom)<=.03){var h=t.zoom,p=Object(q.b)(h+a._deltaZoom,a._map.zoomRange.min,a._map.zoomRange.max);a._deltaZoom=0,a._animation.stop(),a._animation=void 0;var _=$t(a._zoomPointCenterOffset,t,p),m=c.add(t.worldCenter,_);return Object(i.a)(Object(i.a)({},t),{worldCenter:m,zoom:p})}l=Math.abs(a._deltaZoom)>.12?.25*a._deltaZoom:.03*Object(r.mathSign)(a._deltaZoom),a._deltaZoom-=l;var f=Object(q.b)(t.zoom+l,a._map.zoomRange.min,a._map.zoomRange.max),y=$t(a._zoomPointCenterOffset,t,f),v=c.add(t.worldCenter,y);return a._prevFrameTimestamp=d,Object(i.a)(Object(i.a)({},t),{worldCenter:v,zoom:f})},a._map=e,a._device=n,a._zoomPointSource=o,a._init(),a}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._device.on("wheel",this._onWheel))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0)},e}(Object(E.a)().with());var oe=Math.cos(Math.PI/6),ie=Object(Ht.a)("ease-out"),re=function(){function t(){this._history=[]}return t.prototype.push=function(t){this._history.push({position:t,ts:Date.now()}),this._history.length>=30&&this._history.shift()},t.prototype.computeMovement=function(){var t=Date.now(),e=this._history.filter((function(e){return e.ts>=t-500}));if(e.length<2||t-e[e.length-1].ts>=100)return null;var n=c.sub(e[e.length-2].position,e[e.length-1].position);if(c.areFuzzyEqual(n,c.ORIGIN,2))return null;c.normalize(n,n);for(var o=0,i=e.length-1;i>=1;i--){var a=c.sub(e[i-1].position,e[i].position),s=c.length(a);if(c.dot(a,n)/s<=oe)break;var u=(t-e[i].ts)/500;o+=s/Object(r.mathLog2)(2+u)}return c.muln(n,Math.min(o,500))},t}(),ae=function(t){function e(e,n){var o=t.call(this)||this;return o._map=e,o._dragger=n,o._dragSubscription=o._initDrag(),o}return Object(i.b)(e,t),e.prototype.destroy=function(){this._stopAnimationIfAny(),this._stopAllSubscriptions()},e.prototype.enable=function(){this._dragSubscription||(this._dragSubscription=this._initDrag())},e.prototype.disable=function(){this._stopAnimationIfAny(),this._stopAllSubscriptions(),this._dragger.isDragging&&this._emit("dragEnd")},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._dragAnimation&&this._dragAnimation.isRunning},enumerable:!1,configurable:!0}),e.prototype._stopAllSubscriptions=function(){this._dragEndSubscription&&(this._dragEndSubscription.offAll(),this._dragEndSubscription=void 0),this._dragSubscription&&(this._dragSubscription.offAll(),this._dragSubscription=void 0)},e.prototype._initDrag=function(){var t=this,e=this._dragger.group();return e.on("dragStart",(function(){t._emit("dragStart"),t._stopAnimationIfAny();var n=Object(U.c)(t._dragger.dragStartingPoint,t._map),o=new re;o.push(t._dragger.pointerPosition),e.on("dragMove",(function(){return o.push(t._dragger.pointerPosition)})),t._dragAnimation=t._map.animate((function(e){return Object(i.a)(Object(i.a)({},e),{worldCenter:t._computeWorldCenter(n)})})),t._dragEndSubscription=t._dragger.on("dragEnd",(function(){t._dragEndSubscription.offAll();var e={worldCenter:t._computeWorldCenter(n),zoom:t._map.zoom,azimuth:t._map.azimuth,tilt:t._map.tilt};t._map.setCamera(e),t._stopAnimationIfAny();var i=o.computeMovement();if(i){var r=H.a.convertPixelSizeToWorldSize(i,t._map.zoom),a=c.rotate(r,e.azimuth),u=c.add(t._map.worldCenter,a);t._emit("inertiaStart",{targetPositionWcs:u}),t._dragAnimation=qt(t._map,a,400,ie),Object(s.promiseFinally)(t._dragAnimation.complete,(function(){return t._emit("dragEnd")}))}else t._emit("dragEnd")}))})),e},e.prototype._stopAnimationIfAny=function(){this._dragAnimation&&this._dragAnimation.isRunning&&this._dragAnimation.stop()},e.prototype._computeWorldCenter=function(t){var e=Object(U.c)(this._dragger.pointerPosition,this._map),n=c.sub(e,t);return c.sub(this._map.worldCenter,n)},e}(Object(E.a)().with()),se=function(t){function e(e,n,o){var i=t.call(this)||this;return i._isEnabled=!1,i._onDblClick=function(){i._zoomOn(1)},i._onRightDblClick=function(){i._zoomOn(-1)},i._map=e,i._zoomDuration=n,i._zoomPointSrc=o,i._init(),i}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._isEnabled||(this._map.events.on("dblclick","any",this._onDblClick),this._map.events.on("rightdblclick","any",this._onRightDblClick),this._isEnabled=!0)},e.prototype._suspend=function(){this._isEnabled&&(this._map.events.off("dblclick","any",this._onDblClick),this._map.events.off("rightdblclick","any",this._onRightDblClick)),this._animation&&this._animation.isRunning&&this._animation.stop(),this._isEnabled=!1},e.prototype._zoomOn=function(t){var e=this;this._emit("zoomStart");var n=Object(U.b)(this._zoomPointSrc(),this._map);this._animation=Ut(this._map,this._map.zoom+t,this._zoomDuration,n),Object(s.promiseFinally)(this._animation.complete,(function(){return e._emit("zoomEnd")}))},e}(Object(E.a)().with()),ce=function(t){function e(e,n,o){var a=t.call(this)||this;return a.rotationAllowed=!1,a.tiltAllowed=!1,a._onTiltStart=function(){if(!a.tiltAllowed)return a._onPinchRotateStart();a._stopAnimationIfAny(),a._emit("tiltStart"),a._map.updateCameraOptions({enabledTiltTransition:!0});var t=a._map.tilt,e=a._map.animate((function(e){var n=t+Math.PI*a._gestureRecognizer.panTiltDelta/a._map.size.y;return a._emit("tiltChanged"),Object(i.a)(Object(i.a)({},e),{tilt:n})})),n=a._gestureRecognizer.on("gestureEnd",(function(){n.offAll(),e.stop();var t=function(){a._emit("tiltEnd"),a._map.updateCameraOptions({enabledTiltTransition:!1})},o=a._map.tilt<pt.b;if(o||a._map.tilt>pt.a){var r=o?pt.b:pt.a;a._stopTiltAnimationIfAny(),a._tiltAnimation=function(t,e,n,o){void 0===o&&(o=Xt);var r=e-t.tilt,a=Object(Ht.a)(o);return t.animateForDuration(n,(function(t,n,o){if(1===n)return Object(i.a)(Object(i.a)({},t),{tilt:e});var s=t.tilt+r*Vt(a,n,o);return Object(i.a)(Object(i.a)({},t),{tilt:s})}))}(a._map,r,a._tiltDuration),Object(s.promiseFinally)(a._tiltAnimation.complete,t)}else t()}))},a._onPinchRotateStart=function(){a._stopAnimationIfAny(),a._emit("zoomStart");var t=a._map.zoom,e=a._map.azimuth,n=a._map.animate((function(n){var o,s=t+Object(r.mathLog2)(a._gestureRecognizer.scale);o=a.rotationAllowed?e+a._gestureRecognizer.angle:n.azimuth;var u=n.worldCenter;if(a._getZoomStrategy()===Yt.ZOOM_TO_CENTER){var l=$t(c.sub(a._getZoomPointSrc(),c.divn(a._map.size,2)),n,s);u=c.add(n.worldCenter,l)}return a._emit("zoomChanged"),Object(i.a)(Object(i.a)({},n),{worldCenter:u,azimuth:o,zoom:s})})),o=a._gestureRecognizer.on("gestureEnd",(function(){o.offAll(),n.stop();var t=Math.round(a._map.zoom),r=[];if(a.rotationAllowed&&Math.abs(a._gestureRecognizer.angle)<a._rotateThreshold&&(a._stopRotateAnimationIfAny(),a._rotateAnimation=function(t,e,n,o,r){void 0===r&&(r=Xt);var a=Object(Ht.a)(r);return t.animateForDuration(o,(function(t,o,r){if(1===o)return Object(i.a)(Object(i.a)({},t),{azimuth:n});var s=t.azimuth+e*Vt(a,o,r);return Object(i.a)(Object(i.a)({},t),{azimuth:s})}))}(a._map,-a._gestureRecognizer.angle,e,a._rotateDuration),r.push(a._rotateAnimation.complete)),a.snapToRound&&t!==a._map.zoom){a._stopZoomAnimationIfAny();var c=void 0;if(a._getZoomStrategy()===Yt.ZOOM_TO_CENTER){var u=a._map.center,l=u[0],d=u[1];c=a._map.projection.toGlobalCoordinates([l,d])}a._zoomAnimation=Ut(a._map,t,a._zoomDuration,c),r.push(a._zoomAnimation.complete)}r.length?Object(s.promiseFinally)(Promise.all(r),(function(){return a._emit("zoomEnd")})).catch((function(t){return Object(Q.b)(t)})):a._emit("zoomEnd")}))},a._map=e,a.snapToRound=o.snapToRound,a._zoomDuration=o.zoomDuration,a._rotateDuration=o.rotateDuration,a._rotateThreshold=o.rotateThreshold,a._tiltDuration=o.tiltDuration,a._getZoomPointSrc=o.getZoomPointSrc,a._getZoomStrategy=o.getZoomStrategy,a._gestureRecognizer=n,a._init(),a}return Object(i.b)(e,t),e.prototype.destroy=function(){this._suspend()},Object.defineProperty(e.prototype,"isInAction",{get:function(){var t,e,n;return Boolean((null===(t=this._zoomAnimation)||void 0===t?void 0:t.isRunning)||(null===(e=this._rotateAnimation)||void 0===e?void 0:e.isRunning)||(null===(n=this._tiltAnimation)||void 0===n?void 0:n.isRunning))},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._gestureRecognizer.on("pinchRotateStart",this._onPinchRotateStart).on("panTiltStart",this._onTiltStart))},e.prototype._suspend=function(){this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0),this._stopAnimationIfAny()},e.prototype._stopAnimationIfAny=function(){this._stopZoomAnimationIfAny(),this._stopRotateAnimationIfAny(),this._stopTiltAnimationIfAny()},e.prototype._stopZoomAnimationIfAny=function(){var t;(null===(t=this._zoomAnimation)||void 0===t?void 0:t.isRunning)&&(this._zoomAnimation.stop(),this._zoomAnimation=void 0)},e.prototype._stopRotateAnimationIfAny=function(){var t;(null===(t=this._rotateAnimation)||void 0===t?void 0:t.isRunning)&&(this._rotateAnimation.stop(),this._rotateAnimation=void 0)},e.prototype._stopTiltAnimationIfAny=function(){var t;(null===(t=this._tiltAnimation)||void 0===t?void 0:t.isRunning)&&(this._tiltAnimation.stop(),this._tiltAnimation=void 0)},e}(Object(E.a)().with()),ue=function(t){function e(e,n,o){var i=t.call(this)||this;return i._element=X("ymaps3x0--magnifier"),i._backdropElement=X("ymaps3x0--magnifier-backdrop"),i._onDragStart=function(){i._selectionInfo=i._computeSelectionInfo(),i._map.container.appendChild(i._element),document.body.appendChild(i._backdropElement),i._updateElementDimensions(i._selectionInfo),i._emit("selectionStart")},i._onDragMove=function(){i._selectionInfo&&(i._selectionInfo=i._computeSelectionInfo(),i._updateElementDimensions(i._selectionInfo))},i._onDragEnd=function(){i._selectionInfo&&(i._animation=i._zoomByCurrentSelection(i._selectionInfo),Object(s.promiseFinally)(i._animation.complete,(function(){return i._emit("selectionEnd")})),i._cleanupSelection()),setTimeout((function(){return i._detachBackdrop()}))},i._onKeyDown=function(t){"Escape"===t.key&&i._selectionInfo&&(i._emit("selectionEnd"),i._cleanupSelection())},i._backdropElement.addEventListener("contextmenu",(function(t){return t.preventDefault()})),i._map=e,i._dragger=n,i.snapToRound=o,i._init(),i}return Object(i.b)(e,t),e.prototype.destroy=function(){this._suspend(),this._detachElement()},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._subscriptions||(document.addEventListener("keydown",this._onKeyDown),this._subscriptions=this._dragger.group().on("dragStart",this._onDragStart).on("dragMove",this._onDragMove).on("dragEnd",this._onDragEnd))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),document.removeEventListener("keydown",this._onKeyDown),this._subscriptions&&(this._subscriptions.offAll(),this._subscriptions=void 0),this._detachBackdrop()},e.prototype._cleanupSelection=function(){this._selectionInfo=void 0,this._detachElement()},e.prototype._detachElement=function(){this._element.parentNode&&this._element.parentNode.removeChild(this._element)},e.prototype._detachBackdrop=function(){this._backdropElement.parentNode&&this._backdropElement.parentNode.removeChild(this._backdropElement)},e.prototype._updateElementDimensions=function(t){var e=t.point,n=t.offset;this._element.style.left="".concat(Math.round(e.x),"px"),this._element.style.top="".concat(Math.round(e.y),"px"),this._element.style.width="".concat(Math.abs(Math.round(n.x)),"px"),this._element.style.height="".concat(Math.abs(Math.round(n.y)),"px"),this._element.style.transform="scale(".concat(n.x<0?-1:1,", ").concat(n.y<0?-1:1,")")},e.prototype._zoomByCurrentSelection=function(t){var e=function(t,e,n){var o=t.size,i=t.worldCenter,a=t.zoom,s=t.zoomRange,u=t.azimuth,l=t.tilt,d=t.fov,h=Object(q.b)(Math.abs(e.offset.x),1e-10,o.x),p=Object(q.b)(Math.abs(e.offset.y),1e-10,o.y),_=a+Math.min(Object(r.mathLog2)(o.x/h),Object(r.mathLog2)(o.y/p));n&&(_=Math.floor(_));var m=e.point,f=c.add(e.point,e.offset),y=c.divn(c.add(m,f),2);return{zoom:Math.min(Math.max(_,s.min),s.max),center:Object(U.b)(y,{size:o,worldCenter:i,zoom:a,azimuth:u,tilt:l,fov:d})}}(this._map,t,this.snapToRound),n=e.center,o=e.zoom;return Qt(this._map,n,o,300)},e.prototype._computeSelectionInfo=function(){var t=this._map.container.getBoundingClientRect(),e=t.left,n=t.top;return{point:c.sub(this._dragger.dragStartingPoint,{x:e,y:n}),offset:this._dragger.dragOffset}},e}(Object(E.a)().with());var le=function(t){function e(e,n,o,i){var r=t.call(this)||this;return r._isEnabled=!1,r._deviceStateChangedEventGroup=void 0,r._onClick=function(t){if(r._dragEventGroup)r._destroyDragEvents();else{var e=c.create(t.x,t.y);r._dragEventGroup=r._initDragEvents(e),window.clearTimeout(r._clickTimer),r._clickTimer=window.setTimeout((function(){r._destroyDragEvents()}),300)}},r._map=e,r._device=n,r._dragger=o,r.zoomStrategy=i,r._init(),r}return Object(i.b)(e,t),e.prototype.destroy=function(){this._suspend()},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._isEnabled||(this._addListeners(),this._isEnabled=!0)},e.prototype._suspend=function(){this._isEnabled&&(window.clearTimeout(this._clickTimer),this._destroyDragEvents(),this._removeListeners(),this._animation&&this._animation.isRunning&&this._animation.stop(),this._isEnabled=!1)},e.prototype._addListeners=function(){var t,e=this;this._deviceStateChangedEventGroup||(this._deviceStateChangedEventGroup=this._device.on("stateChanged",(function(){e._device.state!==y.PRIMARY?(t&&c.length(c.sub(t,e._device.pointerPosition))<=7&&e._onClick(t),t=void 0):t=e._device.pointerPosition})))},e.prototype._removeListeners=function(){this._deviceStateChangedEventGroup&&(this._deviceStateChangedEventGroup.offAll(),this._deviceStateChangedEventGroup=void 0)},e.prototype._initDragEvents=function(t){var e=this,n=this._dragger.group();return n.on("dragStart",(function(){var o=e._dragger.dragStartingPoint;window.clearTimeout(e._clickTimer),c.length(c.sub(t,o))>20||(e._emit("zoomStart"),n.on("dragMove",(function(){var n=e._dragger.pointerPosition,i=c.sub(n,o);o=n;var r=i.y/e._map.size.y*10,a=e._map.zoom+r,s=e._map.zoomRange;if(!(a<s.min||a>s.max)){var u=e.zoomStrategy===Yt.ZOOM_TO_CENTER?e._map.worldCenter:Object(U.c)(t,e._map);e._animation=Ut(e._map,a,0,u)}})),n.on("dragEnd",(function(){e._destroyDragEvents(),e._animation?Object(s.promiseFinally)(e._animation.complete,(function(){return e._emit("zoomEnd")})):e._emit("zoomEnd")})))})),n},e.prototype._destroyDragEvents=function(){this._dragEventGroup&&(this._dragEventGroup.offAll(),this._dragEventGroup=void 0)},e}(Object(E.a)().with()),de=function(t){function e(e,n){var o=t.call(this)||this;return o._state={type:0},o.rotationAllowed=!0,o.tiltAllowed=!0,o._onDragStart=function(){0===o._state.type&&(o._emit("start"),o._state={type:1,animation:o._map.animate(o._onAnimationStep),previousPoint:o._dragger.dragStartingPoint})},o._onDragMove=function(){o._state.type},o._onDragEnd=function(){1===o._state.type&&(o._state.animation.stop(),o._state={type:0},o._emit("end"))},o._onAnimationStep=function(t){if(1!==o._state.type)return t;var e=c.sub(o._state.previousPoint,o._dragger.pointerPosition);o._state.previousPoint=o._dragger.pointerPosition;var n=o.rotationAllowed?Math.PI*e.x/o._map.size.x:0,r=o.tiltAllowed?Math.PI*e.y/o._map.size.y:0;return Object(i.a)(Object(i.a)({},t),{azimuth:t.azimuth+n,tilt:t.tilt+r})},o._map=e,o._dragger=n,o._draggerSubscription=o._dragger.on("dragStart",o._onDragStart).on("dragMove",o._onDragMove).on("dragEnd",o._onDragEnd),o.enable(),o}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return 1===this._state.type},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._state={type:0}},e.prototype.disable=function(){this.stop(),this._state={type:2}},e.prototype.stop=function(){1===this._state.type&&(this._state.animation.stop(),this._emit("end"),this._state={type:0})},e.prototype.destroy=function(){this.disable(),this._draggerSubscription.offAll()},e}(Object(E.a)().with()),he=18*x.a,pe=function(t){function e(e,n){var o=t.call(this)||this;o._subscriptions=[],o._zoomStrategy=Yt.ZOOM_TO_POINTER,o._userEnabled=[],o._mapEnabledRotation=!0,o._restoreDrag=function(){-1!==o._userEnabled.indexOf("drag")&&o.drag.enable()},o._deviceEventsFilter=function(t){var n=t.target,o=n instanceof HTMLElement?e.findMarkerByElement(n):null;return Boolean(null==o?void 0:o.marker.options.blockBehaviors)};var i=I(e.container,{filter:o._deviceEventsFilter});o._map=e;var a="snap"===o._map.effectiveZoomRounding;o._zoomPointSrc=function(){if(o._zoomStrategy===Yt.ZOOM_TO_CENTER){var t=o._map.center,n=t[0],r=t[1],a=o._map.projection.toGlobalCoordinates([n,r]);return Object(U.d)(a,o._map)}var s=i.pointerPosition,c=e.container.getBoundingClientRect();return{x:s.x-c.left,y:s.y-c.top}},o._leftButtonDragger=new G(i),o._rightButtonDragger=new G(i,{listenToButtons:new r.Set([y.SECONDARY])}),o.magnifier=new ue(e,o._rightButtonDragger,a),o._proxyEvents(o.magnifier,"magnifier",["selectionStart","selectionEnd"]),o.drag=new ae(e,o._leftButtonDragger),o._proxyEvents(o.drag,"drag",["dragStart","dragEnd"]),o.dblClick=new se(e,200,o._zoomPointSrc),o._proxyEvents(o.dblClick,"dblClick",["zoomStart","zoomEnd"]),o.magnifier.disable();var s={zoomDuration:200,rotateDuration:200,rotateThreshold:he,tiltDuration:200,getZoomStrategy:function(){return o._zoomStrategy},getZoomPointSrc:o._zoomPointSrc,snapToRound:a};o._twoFingersGesture=new B(i),o.pinchZoom=new ce(e,o._twoFingersGesture,s),o._proxyEvents(o.pinchZoom,"pinchZoom",["zoomStart","zoomEnd"]);var c=o.pinchZoom.on("zoomStart",(function(){o._zoomStrategy===Yt.ZOOM_TO_CENTER&&o.drag.disable()})).on("zoomEnd",o._restoreDrag).on("tiltStart",(function(){return o.drag.disable()})).on("tiltEnd",o._restoreDrag);o._subscriptions.push(c),o._wheelDevice=new W(o._map.container,{filter:o._deviceEventsFilter}),o._roundScrollZoom=new te(o._map,o._wheelDevice,o._zoomPointSrc,200),o._proxyEvents(o._roundScrollZoom,"scrollZoom",["zoomStart","zoomEnd"]),o._smoothScrollZoom=new ne(o._map,o._wheelDevice,o._zoomPointSrc),o._proxyEvents(o._smoothScrollZoom,"scrollZoom",["zoomStart","zoomEnd"]),o.oneFingerZoom=new le(e,i,o._leftButtonDragger,o._zoomStrategy),o._proxyEvents(o.oneFingerZoom,"oneFingerZoom",["zoomStart","zoomEnd"]);var u=o.oneFingerZoom.on("zoomStart",(function(){return o.drag.disable()})).on("zoomEnd",o._restoreDrag);o._subscriptions.push(u);var l=new G(i,{listenToButtons:new r.Set([y.CTRL_PRIMARY,y.CMD_PRIMARY])});return o.rotate=new de(o._map,l),o._behaviorsRegistry={drag:o.drag,pinchZoom:o.pinchZoom,scrollZoom:a?o._roundScrollZoom:o._smoothScrollZoom,dblClick:o.dblClick,magnifier:o.magnifier,oneFingerZoom:o.oneFingerZoom,mouseRotate:!1,mouseTilt:!1,pinchRotate:!1,panTilt:!1},o.setEnabled(n),o._updateZoomRounding(),o}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){for(var t=0,e=Object.keys(this._behaviorsRegistry);t<e.length;t++){var n=e[t];if("pinchRotate"!==n&&"panTilt"!==n&&"mouseRotate"!==n&&"mouseTilt"!==n&&this._behaviorsRegistry[n].isInAction)return!0}return!1},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._subscriptions.forEach((function(t){return t.offAll()})),this.drag.destroy(),this.pinchZoom.destroy(),this.dblClick.destroy(),this.magnifier.destroy(),this.oneFingerZoom.destroy(),this.rotate.destroy(),this._roundScrollZoom.destroy(),this._smoothScrollZoom.destroy(),this._leftButtonDragger.destroy(),this._rightButtonDragger.destroy(),this._twoFingersGesture.destroy(),this._wheelDevice.destroy()},e.prototype.setEnabled=function(t){var e;(e=this._userEnabled).splice.apply(e,Object(i.c)([0,1/0],t,!1));for(var n=0,o=Object.keys(this._behaviorsRegistry);n<o.length;n++){var r=o[n];this._setEnabledSingle(r,-1!==t.indexOf(r))}},e.prototype.setZoomStrategy=function(t){this._zoomStrategy=t,this.oneFingerZoom.zoomStrategy=t},e.prototype.mapToggleRotation=function(t){this._mapEnabledRotation=t,this.setEnabled(this._userEnabled)},e.prototype._updateZoomRounding=function(){var t="snap"===this._map.effectiveZoomRounding;this.magnifier.snapToRound=t,this.pinchZoom.snapToRound=t,t?(this._roundScrollZoom.enable(),this._smoothScrollZoom.disable(),this._behaviorsRegistry.scrollZoom=this._roundScrollZoom):(this._roundScrollZoom.disable(),this._smoothScrollZoom.enable(),this._behaviorsRegistry.scrollZoom=this._smoothScrollZoom)},e.prototype._setEnabledSingle=function(t,e){"pinchRotate"===t?this._behaviorsRegistry.pinchZoom.rotationAllowed=this._mapEnabledRotation&&e:"panTilt"===t?this._behaviorsRegistry.pinchZoom.tiltAllowed=this._mapEnabledRotation&&e:"mouseRotate"===t?this.rotate.rotationAllowed=this._mapEnabledRotation&&e:"mouseTilt"===t?this.rotate.tiltAllowed=this._mapEnabledRotation&&e:e?this._behaviorsRegistry[t].enable():this._behaviorsRegistry[t].disable(),"scrollZoom"===t&&(e?this._wheelDevice.enable():this._wheelDevice.disable())},e.prototype._proxyEvents=function(t,e,n){var o=this;this._subscriptions.push(t.on(n[0],(function(){return o._emit("actionStart",e)})).on(n[1],(function(){return o._emit("actionEnd",e)})))},e}(Object(E.a)().with()),_e=function(){function t(t,e){void 0===t&&(t=6378137),void 0===e&&(e=.0818191908426),this.radius=t,this.e=e,this._e2=this.e*this.e,this._e4=this._e2*this._e2,this._e6=this._e4*this._e2,this._e8=this._e4*this._e4,this._subradius=1/t,this._d2=this._e2/2+5*this._e4/24+this._e6/12+13*this._e8/360,this._d4=7*this._e4/48+29*this._e6/240+811*this._e8/11520,this._d6=7*this._e6/120+81*this._e8/1120,this._d8=4279*this._e8/161280}return t.prototype.mercatorToGeo=function(t){return[this.xToLongitude(t.x),this.yToLatitude(t.y)]},t.prototype.geoToMercator=function(t){return{x:this.longitudeToX(t[0]),y:this.latitudeToY(t[1])}},t.prototype.xToLongitude=function(t){return x.b*Object(q.a)(t*this._subradius,-Math.PI,Math.PI)},t.prototype.yToLatitude=function(t){var e=.5*Math.PI-2*Math.atan(1/Math.exp(t*this._subradius)),n=e+this._d2*Math.sin(2*e)+this._d4*Math.sin(4*e)+this._d6*Math.sin(6*e)+this._d8*Math.sin(8*e);return x.b*n},t.prototype.longitudeToX=function(t){var e=Object(q.a)(x.a*t,-Math.PI,Math.PI);return this.radius*e},t.prototype.latitudeToY=function(t){var e=x.a*Object(q.b)(t,1e-10-90,90-1e-10),n=this.e*Math.sin(e),o=Math.tan(.25*Math.PI+.5*e)/Math.pow(Math.tan(.25*Math.PI+.5*Math.asin(n)),this.e);return this.radius*Math.log(o)},t}(),me=new(function(){function t(t,e){this._mercator=new _e(t,e),this._halfEquator=Math.PI*this._mercator.radius}return t.prototype.toGlobalCoordinates=function(t){var e=this._mercator.geoToMercator(t);return{x:(this._halfEquator+e.x)/this._halfEquator-1,y:Object(q.b)(1-(this._halfEquator-e.y)/this._halfEquator,-1,1)}},t.prototype.fromGlobalCoordinates=function(t){var e=this._mercator.yToLatitude(this._halfEquator-(1-t.y)*this._halfEquator);return e=Object(q.b)(e,-90,90),[x.b*Object(q.a)(Math.PI*t.x,-Math.PI,Math.PI),e]},t}()),fe=Math.pow(15,2),ye=["touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointercancel","click","dblclick","mouseup","mousedown","mouseenter","mouseleave","mousemove","contextmenu"],ve=["mousedown","touchstart","pointerdown","contextmenu"],ge=function(){},be=function(){function t(t,e){var n=this;this._previousRightClickTimestamp=0,this._stopWaitingHotspots=ge,this._handlers={},this._activeObject=null,this.clickTimeout=300,this.waitHotspotsTimeout=1e3,this._onEvent=function(t){if("dblclick"!==t.type&&!n._map.isInAction&&!t.ctrlKey){var e,o,i=t.target instanceof HTMLElement?n._map.findMarkerByElement(t.target):null;if(!(null==i?void 0:i.marker.options.blockEvents))if(ve.indexOf(t.type)>=0&&n._stopWaitingHotspots(!1),"click"===t.type)if(n._processEvent("fastclick",t),t.preventDefault(),void 0!==n._clickTimer){window.clearTimeout(n._clickTimer),n._clickTimer=void 0;var r=xe(t);e=n._previousClickPosition,o=r,Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2)<fe&&n._processEvent("dblclick",t)}else n._previousClickPosition=xe(t),n._clickTimer=window.setTimeout((function(){n._clickTimer=void 0,n._map.isInAction||n._waitHotspots(t).then((function(e){e&&!n._map.isInAction&&n._processEvent("click",t)}))}),n.clickTimeout);else if("contextmenu"===t.type){var a=Date.now();a-n._previousRightClickTimestamp<n.clickTimeout?(n._previousRightClickTimestamp=0,n._processEvent("rightdblclick",t)):n._previousRightClickTimestamp=a}else n._processEvent(t.type,t)}},this._waitHotspots=function(t){return new Promise((function(e){var o=n._computeAllCoordinates(t);if(o){var i=o[1],a=function(){var t=n._map.findObjectInWorldPositionEx(i),e=Object(r.arrayFind)(t.layers,(function(t){return null!==t.object}));e&&void 0===e.object||n._stopWaitingHotspots(!0)},s=window.setTimeout((function(){return n._stopWaitingHotspots(!0)}),n.waitHotspotsTimeout),c=n._map.on("hotspotsChanged",a);n._stopWaitingHotspots=function(t){window.clearTimeout(s),c.offAll(),e(t),n._stopWaitingHotspots=ge},a()}else e(!1)})).catch((function(t){Object(Q.c)(t)}))},this._computeAllCoordinates=function(t){var e=xe(t);if(!isFinite(e.x)||!isFinite(e.y))return null;var o=Object(U.c)(e,n._map);return[e,o,n._map.projection.fromGlobalCoordinates(o)]},this._processEvent=function(t,e){var o=n._computeAllCoordinates(e);if(o){var i=o[0],r=o[1],a=o[2],s=n._map.findObjectInWorldPosition(r);n._eventObjectsFilter&&!n._eventObjectsFilter(s)&&(s=null);var c={coordinates:a,screenCoordinates:[i.x,i.y]};if("mousemove"===e.type){var u=n._activeObject;u&&s&&Se(u,s)?n._emitLayerEvent("mousemove",u,c,e):u&&s&&Se(u,s)||(u&&n._emitLayerEvent("mouseleave",u,c,e),s&&n._emitLayerEvent("mouseenter",s,c,e)),n._activeObject=s}else s&&n._emitLayerEvent(t,s,c,e);s||(n._initHandlers(t,"none"),n._handlers[t].none.forEach((function(t){return t(null,c,e)})),n._initHandlers(t,"any"),n._handlers[t].any.forEach((function(t){return t(null,c,e)})))}},this._emitLayerEvent=function(t,e,o,i){n._initHandlers(t,e.layer),n._handlers[t][e.layer].forEach((function(t){return t(e,o,i)})),n._initHandlers(t,"any"),n._handlers[t].any.forEach((function(t){return t(e,o,i)}))},this._initHandlers=function(t,e){n._handlers[t]=n._handlers[t]||{},n._handlers[t][e]=n._handlers[t][e]||[]},this._map=t,this._eventObjectsFilter=e,ye.forEach((function(t){return n._map.container.addEventListener(t,n._onEvent)}))}return t.prototype.destroy=function(){var t=this;this._stopWaitingHotspots(!1),window.clearInterval(this._clickTimer),ye.forEach((function(e){return t._map.container.removeEventListener(e,t._onEvent)}))},t.prototype.on=function(t,e,n){this._initHandlers(t,e),this._handlers[t][e].push(n)},t.prototype.off=function(t,e,n){this._initHandlers(t,e);var o=this._handlers[t][e].indexOf(n);-1!==o&&this._handlers[t][e].splice(o,1)},t}();function Se(t,e){return t.type===e.type&&t.layer===e.layer&&("hotspot"===t.type&&t.feature.id===e.feature.id||"feature"===t.type&&t.feature.id===e.feature.id||"marker"===t.type&&t.marker===e.marker)}function xe(t){if("touches"in t){var e=t.touches[0]||t.changedTouches[0];return{x:e.clientX,y:e.clientY}}return{x:t.clientX,y:t.clientY}}var Oe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.element=X(),e}return Object(i.b)(e,t),e.prototype.getLayerReadyState=function(){},e.prototype.destroy=function(){},e.prototype.update=function(){},e.prototype.resize=function(){},e.prototype.setLayers=function(){},e.prototype.setObjectFilters=function(){},e.prototype.setInvisibleCollidingPrimitives=function(){},e.prototype.findObjectInPosition=function(){return null},e.prototype.findObjectInPositionEx=function(){return{layers:[]}},e.prototype.preloadHotspotsInPoint=function(){},e.prototype.preloadHotspotsForViewport=function(){},e.prototype.setDataSources=function(){},e.prototype.getIndoorPlans=function(){return null},e.prototype.getVisibleObjects=function(){return null},e.prototype.setObjectHighlight=function(){},Object.defineProperty(e.prototype,"fov",{get:function(){return O},enumerable:!1,configurable:!0}),e}(Object(E.a)().with()),Ee=function(){function t(t,e,n,o){var i=this;this._dataSources={},this._layers=new r.Map,this._onMouseEnter=function(t){var e;if("feature"===t.type){var n=null===(e=i._dataSources[t.source].features.get(t.feature.id))||void 0===e?void 0:e.style.cursor;void 0!==n&&(void 0===i._prevCursor&&(i._prevCursor=i._element.style.cursor),i._element.style.cursor=n)}},this._onMouseLeave=function(){void 0!==i._prevCursor&&(i._element.style.cursor=i._prevCursor,i._prevCursor=void 0)},this._map=t,this._element=e,this.setDataSources(n),this.setLayers(o)}return t.prototype.destroy=function(){var t=this;this._layers.forEach((function(e,n){return t._unsubscribeFromLayerEvents(n)}))},t.prototype.setDataSources=function(t){this._dataSources=Object(i.a)({},t)},t.prototype.setLayers=function(t){for(var e=this,n=new r.Set,o=0,i=t;o<i.length;o++){var a=i[o];a.source in this._dataSources&&n.add(a.id)}var s=Object(st.a)(this._layers,n,(function(t){return e._subscribeToLayerEvents(t)}),(function(t,n){return e._unsubscribeFromLayerEvents(n)})).result;this._layers=s},t.prototype._subscribeToLayerEvents=function(t){this._map.events.on("mouseenter",t,this._onMouseEnter),this._map.events.on("mouseleave",t,this._onMouseLeave)},t.prototype._unsubscribeFromLayerEvents=function(t){this._map.events.off("mouseenter",t,this._onMouseEnter),this._map.events.off("mouseleave",t,this._onMouseLeave)},t}();function ze(t,e,n){var o=H.a.pixelsToWorld(e,n);return t.fromGlobalCoordinates(o)}function we(t,e,n){var o=t.toGlobalCoordinates(e);return H.a.worldToPixels(o,n)}function je(t,e,n){var o=we(t,e[0],n),i=we(t,e[1],n),r=H.a.getWorldPixelSize(n),a=[[o.x,o.y],[i.x,i.y]];return o.x>i.x&&(a[0][0]=o.x,a[1][0]=i.x+r),o.y>i.y&&(a[0][1]=i.y,a[1][1]=o.y),a}function Re(t,e){return{x:Math.max(t.x-(e?e[1]+e[3]:0),1),y:Math.max(t.y-(e?e[0]+e[2]:0),1)}}function Ce(t,e,n,o,i,a){void 0===i&&(i=!0),void 0===a&&(a=Object(b.c)());var s=function(t,e,n,o,i){var a=je(t,e,0),s=Math.max(Math.abs(a[1][0]-a[0][0]),1e-10),c=Math.max(Math.abs(a[1][1]-a[0][1]),1e-10),u=Object(q.b)(Math.min(Object(r.mathLog2)(n.x/s),Object(r.mathLog2)(n.y/c)),i.min,i.max);return o?Math.floor(u+1e-6):u}(t,e,Re(n,o),i,a);return{center:function(t,e,n,o){void 0===o&&(o=[0,0,0,0]);var i=je(t,e,n),r=i[0],a=r[0],s=r[1],c=i[1],u=c[0],l=c[1];return ze(t,{x:(a+u-(o[1]-o[3]))/2,y:(s+l-(o[0]-o[2]))/2},n)}(t,e,s,o),zoom:s}}var Te=Math.round,Pe=Math.round,Ae=function(t){function e(e){var n=t.call(this)||this;n._renderLoop=new g.b,n._dataSources={},n._filters=new r.Set,n._invisibleCollidingPrimitives=new r.Map,n._topRasterLayers=[],n._mainLayers=[],n._vectorFailed=!1,n._featuresByDataSource=new r.Map,n._cameraOptions={enabledTiltTransition:!1},n._destroyed=!1,n.container=X("ymaps3x0--map"),n._onVectorError=function(t){n._vectorFailed=!0,n._applyMode(),n._emit("vectorError"),Object(Q.b)(t),console.error(t)};var o,a=e.element,s=e.dataSources,c=e.topRasterLayers,u=e.mainLayers,l=e.mode,d=e.margin,h=e.zoomRange,p=e.zoomRounding,_=void 0===p?"auto":p,m=e.behaviors,f=void 0===m?["drag","scrollZoom","pinchZoom","dblClick","magnifier"]:m,y=e.projection,v=void 0===y?me:y,x=e.worldOptions,O=void 0===x?{cycledX:!0,cycledY:!1}:x,E=e.eventObjectsFilter,z=e.disableRasterPreload,w=e.experiments,j=void 0===w?{}:w,R=e.nonRotatableRasterSources,C=void 0===R?[]:R,T=e.metricsTransport,P=void 0===T?function(){}:T,A=e.devpreview,M=void 0===A?{}:A;o=P,nt||(nt=o),n._experiments=j,n._devpreview=M,n.projection=v,n.worldOptions=O,n._nonRotatableRasterSources=new r.Set(C),n._topEngineContainer=X("ymaps3x0--top-engine-container"),n._mainEngineContainer=X("ymaps3x0--main-engine-container"),n.container.appendChild(n._mainEngineContainer),n.container.appendChild(n._topEngineContainer),a.appendChild(n.container);var L=Me(n.container),D=L.size,I=L.offset;n._size=D,n._offset=I,n._zoomRange=h?Object(i.a)({},h):Object(b.c)(),n._zoomRounding=_,n._margin=d;var k=e,F=k.bounds,G=k.center,W=k.zoom;n._camera=n._createCamera(F,G,W),n._effectiveMode=null,n._desiredMode=l,n._disableRasterPreload=Boolean(z),n._dataSourceDescriptions={};for(var Z=0,B=Object.keys(s);Z<B.length;Z++){var N=B[Z];n._dataSourceDescriptions[N]=Object(S.d)(s[N]);var Y=n._createDataSource(n._dataSourceDescriptions[N]);null!==Y&&(n._dataSources[N]=Y)}De(n._zoomRange,n._dataSourceDescriptions),n._mainLayers=Le(u,s),n._topRasterLayers=Le(c,s),n._assertLayersIsValid(n._topRasterLayers,n._mainLayers);var H=n._createTopEngine(),V=H.topEngine,U=H.eventGroup;return n._topRasterEngine=V,n._topRasterEngineEventGroup=U,n._applyMode(),n.events=new be(n,E),n.behaviors=new pe(n,f),n._subscribeToDomEvents(),n._handleRotatability(),n._update(),n.on("ready",(function(){n._topRasterEngine.animateFirstScreen=!0,"raster"===n._mainEngine.type&&(n._mainEngine.engine.animateFirstScreen=!0)})),n}return Object(i.b)(e,t),e.prototype._createCamera=function(t,e,n,o,i){var r;void 0===o&&(o=0),void 0===i&&(i=0),t&&(e=(r=Ce(this.projection,t,this.size,this.margin,"snap"===this.zoomRounding,this.zoomRange)).center,n=r.zoom);var a=tt(this.projection,e,n,o,this.margin),s=H.a.restrictToZeroWorld(a,this.worldOptions);return this._restrictCamera({zoom:n,worldCenter:s,azimuth:o,tilt:i})},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this.calculateCenter(this._camera.worldCenter)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldCenter",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return t=this.projection,e=this.center,n=this.zoom,o=this.size,i=this.margin,r=Re(o,i),a=we(t,e,n),s={x:a.x-r.x/2,y:a.y-r.y/2},c={x:a.x+r.x/2,y:a.y+r.y/2},[ze(t,s,n),ze(t,c,n)];var t,e,n,o,i,r,a,s,c},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilt",{get:function(){return this._camera.tilt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuth",{get:function(){return this._camera.azimuth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._mainEngine.engine.fov},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRange",{get:function(){for(var t=Object(i.a)({},this._zoomRange),e=0,n=Object(i.c)(Object(i.c)([],this._topRasterLayers,!0),this._mainLayers,!0);e<n.length;e++){var o=n[e];if(o.source&&o.source!==ot.a){var r=this._dataSourceDescriptions[o.source];"tile"===r.type&&r.clampMapZoom&&(t=Object(b.b)(t,r.zoomRange||this._zoomRange))}}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInAction",{get:function(){return Boolean(this._animateHandler&&this._animateHandler.isRunning||this.behaviors&&this.behaviors.isInAction)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRounding",{get:function(){return this._zoomRounding},enumerable:!1,configurable:!0}),e.prototype.setZoomRounding=function(t){t!==this._zoomRounding&&(this._zoomRounding=t,this._chooseEffectiveZoomRounding())},Object.defineProperty(e.prototype,"effectiveZoomRounding",{get:function(){return this._effectiveZoomRounding},enumerable:!1,configurable:!0}),e.prototype.addObjectFilter=function(t){this._filters.add(t),this._applyFilters()},e.prototype.removeObjectFilter=function(t){this._filters.delete(t),this._applyFilters()},e.prototype.getInvisibleCollidingPrimitives=function(){return this._invisibleCollidingPrimitives},e.prototype.addInvisibleCollidingPrimitives=function(t){var e=this;t.forEach((function(t,n){e._invisibleCollidingPrimitives.set(n,{anchor:e.projection.toGlobalCoordinates(t.anchor),rect:t.rect})})),this._applyInvisibleCollidingPrimitives()},e.prototype.removeInvisibleCollidingPrimitives=function(t){var e=this;t.forEach((function(t){e._invisibleCollidingPrimitives.delete(t)})),this._applyInvisibleCollidingPrimitives()},e.prototype.setObjectHighlight=function(t){this._mainEngine.engine.setObjectHighlight(t),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setObjectHighlight(t)},e.prototype.calculateCenter=function(t){return function(t,e,n,o,i){if(i){var r=et(i,n,o);e=c.add(e,r)}return t.fromGlobalCoordinates(e)}(this.projection,t,this._camera.zoom,this._camera.azimuth,this._margin)},e.prototype.setCamera=function(t){var e=t.worldCenter,n=t.zoom;isFinite(e.x)&&isFinite(e.y)||Object(Q.c)(new Error("Trying to set non-finite center")),isFinite(n)||Object(Q.c)(new Error("Trying to set non-finite zoom")),this._camera=this._restrictCamera(Object(i.a)(Object(i.a)({},t),{zoom:n})),this._update()},e.prototype.animate=function(t){var e=this;return this._renderLoop.animate((function(n){var o=e._camera,i=t(o,n);i!==o&&e.setCamera(i)}))},e.prototype.animateForDuration=function(t,e){var n=this,o=0;return this._renderLoop.animateForDuration((function(t){var i=t-o;o=t;var r=n._camera,a=e(r,t,i);a!==r&&n.setCamera(a)}),t)},e.prototype.setZoomRange=function(t){De(t,this._dataSourceDescriptions),this._zoomRange=Object(i.a)({},t),this._emit("zoomRangeChange")},e.prototype.getMode=function(){return this._desiredMode},e.prototype.getEffectiveMode=function(){return this._effectiveMode},e.prototype.setMode=function(t){this._desiredMode!==t&&(this._desiredMode=t,this._applyMode())},Object.defineProperty(e.prototype,"margin",{get:function(){if(this._margin)return this._margin},enumerable:!1,configurable:!0}),e.prototype.setMargin=function(t){this._margin=t,this._emit("update")},e.prototype.setCenter=function(t){this._setCenterAndZoom(t,this.zoom)},e.prototype._setCenterAndZoom=function(t,e){var n=tt(this.projection,t,e,this._camera.azimuth,this._margin);c.areEqual(n,this._camera.worldCenter)||this.setCamera(Object(i.a)(Object(i.a)({},this._camera),{worldCenter:n,zoom:e,azimuth:0,tilt:0}))},e.prototype.setZoom=function(t){var e=this._restrictZoom(t);e!==this._camera.zoom&&(this._camera=this._restrictCamera(Object(i.a)(Object(i.a)({},this._camera),{zoom:e})),this._update())},e.prototype.setBounds=function(t){var e=Ce(this.projection,t,this.size,this.margin,"snap"===this.zoomRounding,this.zoomRange),n=e.center,o=e.zoom;this._setCenterAndZoom(n,o)},e.prototype.animateCenterAndZoom=function(t,e,n,o){var i=this;this._animateHandler&&this._animateHandler.isRunning&&this._animateHandler.stop();var r=this.zoomRange,a=Object(q.b)(e,r.min,r.max),s=tt(this.projection,t,e,this._camera.azimuth,this._margin),c=H.a.moveCloseToCenter(s,this._camera.worldCenter);return this._animateHandler=Qt(this,c,a,n,o),this._animateHandler.complete.then((function(){return i._emit("update")}))},e.prototype.getLayerReadyState=function(t){var e=this._topRasterEngine.getLayerReadyState(t),n=this._mainEngine.engine.getLayerReadyState(t);return e||n},e.prototype.destroy=function(){this._destroyed||(this._emit("beforeDestroy"),this.events.destroy(),this.behaviors.destroy(),this._destroyMainEngine(),this._topRasterEngineEventGroup.offAll(),this._topRasterEngine.destroy(),this.container.removeChild(this._topEngineContainer),this.container.removeChild(this._mainEngineContainer),this.container.parentElement.removeChild(this.container),this._destroyed=!0)},e.prototype.resize=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var n=Me(this.container),o=n.size,r=n.offset;if(!c.areEqual(o,this._size)){var a=this._camera.worldCenter;if(t){var s=c.divn(c.sub(o,this._size),2);c.rotate(s,this._camera.azimuth,s);var u=H.a.convertPixelSizeToWorldSize({x:s.x,y:-s.y},this._camera.zoom);a=c.sub(this._camera.worldCenter,u)}var l=H.a.convertPixelSizeToWorldSize(c.divn(o,2),this._camera.zoom);a={x:a.x,y:Object(q.b)(a.y,-1-l.y,1+l.y)},c.areEqual(a,this._camera.worldCenter)||this.setCamera(Object(i.a)(Object(i.a)({},this._camera),{worldCenter:a})),this._size=o,this._offset=r,this._topRasterEngine.resize(this._size),this._mainEngine.engine.resize(this._size),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.resize(this._size),this._emit("resize"),e?this.renderImmediately():this._renderLoop.update()}},e.prototype.addGroup=function(t,e,n,o){void 0===n&&(n={}),void 0===o&&(o=Lt.b),this._assertDataSourceExistence(t),this._dataSources[t].addGroup(e,n,o)},e.prototype.removeGroupAndChildren=function(t,e){this._assertDataSourceExistence(t),this._dataSources[t].removeGroupAndChildren(e)},e.prototype.addFeature=function(t,e,n,o){void 0===n&&(n={}),void 0===o&&(o=Lt.b),this._assertDataSourceExistence(t);var i=this._dataSources[t],r=this._convertFeatureToWorld(e),a=r.feature,s=r.bbox;i.addFeature(a,n,s,o),this._getFeaturesForDataSource(t).set(e.id,e)},e.prototype.removeFeatureById=function(t,e){this._assertDataSourceExistence(t),this._dataSources[t].removeFeatureById(e),this._getFeaturesForDataSource(t).delete(e)},e.prototype.updateFeature=function(t,e,n){void 0===n&&(n={}),this._assertDataSourceExistence(t);var o=this._dataSources[t],i=this._convertFeatureToWorld(e),r=i.feature,a=i.bbox;o.updateFeature(r,n,a),this._getFeaturesForDataSource(t).set(e.id,e)},e.prototype.upsertFeature=function(t,e,n,o){void 0===n&&(n={}),void 0===o&&(o=Lt.b),this._assertDataSourceExistence(t);var i=this._dataSources[t],r=this._convertFeatureToWorld(e),a=r.feature,s=r.bbox;i.hasFeatureWithId(e.id)?(i.updateFeature(a,n,s),i.moveFeatureToGroup(e.id,o)):i.addFeature(a,n,s,o),this._getFeaturesForDataSource(t).set(e.id,e)},e.prototype.moveFeatureToGroup=function(t,e,n){void 0===n&&(n=Lt.b),this._assertDataSourceExistence(t),this._dataSources[t].moveFeatureToGroup(e,n)},e.prototype.hasFeature=function(t,e){return this._assertDataSourceExistence(t),this._dataSources[t].hasFeatureWithId(e)},e.prototype.createMarker=function(t){return new K(t)},e.prototype.addMarker=function(t,e){this._assertDataSourceExistence(t);var n=this._dataSources[t];n instanceof Gt?n.addMarker(e):Object(Q.c)(new Error('Data source "'.concat(t,'" must be instanceof MarkersDataSource')))},e.prototype.removeMarker=function(t,e){this._assertDataSourceExistence(t);var n=this._dataSources[t];n instanceof Gt?n.removeMarker(e):Object(Q.c)(new Error('Data source "'.concat(t,'" must be instanceof MarkersDataSource')))},e.prototype.addTile3d=function(t,e,n,o,i){void 0===o&&(o=[]),void 0===i&&(i=1),this._assertDataSourceExistence(t),this._dataSources[t].addRootTile(e,n,o,i)},e.prototype.removeTile3d=function(t,e){this._assertDataSourceExistence(t),this._dataSources[t].removeRootTile(e)},e.prototype.setLayers=function(t){var e=t.topRasterLayers,n=t.mainLayers;e&&(this._topRasterLayers=Le(e,this._dataSourceDescriptions)),n&&(this._mainLayers=Le(n,this._dataSourceDescriptions)),this._assertLayersIsValid(this._topRasterLayers,this._mainLayers),this._topRasterEngine.setLayers(this._topRasterLayers),"vector"===this._mainEngine.type&&this._mainEngine.initLayersTimer||this._setMainEngineLayers(this._mainLayers),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.setLayersAbortController&&this._mainEngine.vector.engine.setLayers(this._mainLayers),this._chooseEffectiveZoomRounding(),this._handleRotatability(),this._emit("update"),this._emit("copyrightsChange")},e.prototype.getLayers=function(){return{topRasterLayers:this._topRasterLayers.map(Ie),mainLayers:this._mainLayers.map(Ie)}},e.prototype.getDataSource=function(t){var e=this._dataSourceDescriptions[t];return e?Object(S.d)(e):void 0},e.prototype.addDataSource=function(t,e){this._dataSourceDescriptions[t]=Object(S.d)(e);var n=this._createDataSource(this._dataSourceDescriptions[t]);null!==n&&(this._dataSources[t]=n),this._setEngineDataSources(this._dataSources)},e.prototype.removeDataSource=function(t){Object(i.c)(Object(i.c)([],this._mainLayers,!0),this._topRasterLayers,!0).some((function(e){return e.source===t}))&&Object(Q.c)(new Error("Can't remove, data source with id=\"".concat(t,' is used"'))),delete this._dataSourceDescriptions[t],delete this._dataSources[t],this._setEngineDataSources(this._dataSources)},e.prototype.updateTileDataSource=function(t,e){this._assertDataSourceExistence(t);var n=this._dataSources[t];if(n instanceof rt.a){var o=Object(S.d)(e);this._dataSourceDescriptions[t]=o,n.setSource(o)}else Object(Q.c)(new Error('Data source "'.concat(t,'" must be instanceof "TileDataSource"')));De(this._zoomRange,this._dataSourceDescriptions),this._emit("zoomRangeChange"),this._emit("copyrightsChange")},e.prototype.provideVectorMapEngineFactory=function(t){this._vectorMapEngineFactory=t,this._emit("vectorLoad"),"vector"===this._desiredMode&&this._applyMode()},e.prototype.isVectorMapEngineFactoryProvided=function(){return Boolean(this._vectorMapEngineFactory)},e.prototype.findMarkerByElement=function(t){var e=this._topRasterEngine.findMarkerByElement(t);return e?Object(i.a)(Object(i.a)({},e),{layer:e.layer,source:e.source,marker:e.marker}):null},e.prototype.findObjectInWorldPosition=function(t){var e=this._topRasterEngine.findObjectInPosition(t)||this._mainEngine.engine.findObjectInPosition(t);return this._toMapObject(e)||null},e.prototype.findObjectInWorldPositionEx=function(t){var e=this,n=this._topRasterEngine.findObjectInPositionEx(t),o=Object(r.arrayFind)(n.layers,(function(t){return t.object}))?{layers:[]}:this._mainEngine.engine.findObjectInPositionEx(t);return{layers:Object(i.c)(Object(i.c)([],n.layers.map((function(t){var n=t.layer,o=t.object;return{layer:n,object:e._toMapObject(o)}})),!0),o.layers.map((function(t){var n=t.layer,o=t.object;return{layer:n,object:e._toMapObject(o)}})),!0)}},e.prototype.renderImmediately=function(t){void 0===t&&(t=g.a.FULL),this._renderLoop.renderImmediately(t)},e.prototype.preloadHotspotsInPoint=function(t){var e=H.a.restrictToZeroWorld(t,this.worldOptions);this._topRasterEngine.preloadHotspotsInPoint(e),this._mainEngine.engine.preloadHotspotsInPoint(e),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.preloadHotspotsInPoint(t)},e.prototype.preloadHotspotsForViewport=function(){this._topRasterEngine.preloadHotspotsForViewport(),this._mainEngine.engine.preloadHotspotsForViewport(),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.preloadHotspotsForViewport()},e.prototype.getIndoorPlans=function(){return"vector"===this._mainEngine.type?this._mainEngine.engine.getIndoorPlans():"transitionToVector"===this._mainEngine.type?this._mainEngine.vector.engine.getIndoorPlans():null},e.prototype.getVisibleObjects=function(t){return"vector"===this._mainEngine.type?this._mainEngine.engine.getVisibleObjects(t):"transitionToVector"===this._mainEngine.type?this._mainEngine.vector.engine.getVisibleObjects(t):null},e.prototype._setMainEngineLayers=function(t){this._mainEngine.engine.setLayers(t),"vector"===this._mainEngine.type&&this._mainEngine.cursorController&&this._mainEngine.cursorController.setLayers(t)},e.prototype._setEngineDataSources=function(t){this._topRasterEngine.setDataSources(t),this._mainEngine.engine.setDataSources(t),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setDataSources(t),"vector"===this._mainEngine.type&&this._mainEngine.cursorController&&this._mainEngine.cursorController.setDataSources(t)},e.prototype._applyMode=function(){var t=this,e=Boolean(this._vectorMapEngineFactory),n=e&&!this._vectorFailed,o="vector"===this._desiredMode&&!e&&!this._vectorFailed&&this._disableRasterPreload?"preVector":n?this._desiredMode:"raster";if(this._effectiveMode===o)return this._setMainEngineLayers(this._mainLayers),void this._renderLoop.update();if(this._effectiveMode=o,"preVector"===this._effectiveMode){var i=new Oe;this._mainEngine={type:"preVector",engine:i,eventGroup:i.group()}}else if("raster"===this._effectiveMode){this._destroyMainEngine();i=new Nt(this._size,this._camera,this._renderLoop,this.worldOptions,this.projection,this._dataSources,Pe,this._topRasterEngine.animateFirstScreen);this._mainEngineContainer.appendChild(i.element),i.setLayers(this._mainLayers),i.setObjectFilters(this._filters);var r=i.group().on("tilesReady",(function(){return t._emit("ready")})).on("tilesLoaded",(function(){return t._emit("loaded")})).on("stateChanged",(function(){return t._emit("stateChanged")})).on("hotspotsChanged",(function(){return t._emit("hotspotsChanged")}));this._mainEngine={type:"raster",engine:i,eventGroup:r},this._emit("mainEngineChanged"),this._chooseEffectiveZoomRounding(),this._handleRotatability(),this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov)}else{var a,s={init:performance.now(),duration:-1};try{a=this._vectorMapEngineFactory(this._size,this._camera,this._dataSources,this._renderLoop,this.worldOptions)}catch(d){return void this._onVectorError(new Error("ymaps3: failed to create vector engine: ".concat(d)))}if("preVector"===this._mainEngine.type){var c=this._switchMainEngineToVector(a);c.initLayersTimer=setTimeout((function(){var e=a.on("stateChanged",(function(){var n;t._isReadyToShowVector(a)&&(e.offAll(),t._mainEngineContainer.appendChild(a.element),t._emit("vectorStart",{duration:s.duration}),n={vectorStart:s.duration},null==nt||nt(n))}));t._setVectorLayers(c,s),c.initLayersTimer=void 0}))}else{var u=a.on("internalError",(function(){return t._onVectorError(new Error("vector: internal error"))})).on("indoorPlansChanged",(function(){return t._emit("indoorPlansChanged")})).on("hotspotsChanged",(function(){return t._emit("hotspotsChanged")})),l={type:"vector",engine:a,eventGroup:u};this._mainEngine={engine:this._mainEngine.engine,eventGroup:this._mainEngine.eventGroup,type:"transitionToVector",vector:l},this._mainEngine.vector.initLayersTimer=setTimeout((function(){"transitionToVector"===t._mainEngine.type?(u.on("stateChanged",(function(){t._isReadyToShowVector(a,t._mainEngine.engine)&&(u.offAll(),t._finalizeSwitchingToVector(s.duration))})),t._setVectorLayers(l,s),t._mainEngine.vector.initLayersTimer=void 0):t._onVectorError(new Error("ymaps3: unexpected main engine state: ".concat(t._mainEngine.type)))}))}}this._renderLoop.update(),this._emit("indoorPlansChanged")},e.prototype._setVectorLayers=function(t,e){var n=this;return new Promise((function(o){var i=t.engine,r=function(t){n._onVectorError(new Error("ymaps3: failed to set vector layers: ".concat(t)))},s=function(){i.setObjectFilters(n._filters),i.setInvisibleCollidingPrimitives(n._invisibleCollidingPrimitives),e.duration=performance.now()-e.init,o()};try{if(i.initLayersAsync){t.setLayersAbortController=new a.AbortController;var c=t.setLayersAbortController.signal;i.initLayersAsync(n._mainLayers,c).then(s).catch(r)}else i.setLayers(n._mainLayers),s();t.cursorController&&t.cursorController.setLayers(n._mainLayers)}catch(u){r(u)}}))},e.prototype._switchMainEngineToVector=function(t){var e=this;return this._mainEngine.eventGroup.offAll(),this._mainEngine.engine.destroy(),this._mainEngine={type:"vector",engine:t,cursorController:new Ee(this,t.element,this._dataSources,this._mainLayers),eventGroup:t.group().on("internalError",(function(){return e._onVectorError(new Error("vector: internal error"))})).on("tilesReady",(function(){return e._emit("ready")})).on("tilesLoaded",(function(){return e._emit("loaded")})).on("stateChanged",(function(){return e._emit("stateChanged")})).on("indoorPlansChanged",(function(){return e._emit("indoorPlansChanged")}))},this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov),this._emit("indoorPlansChanged"),this._emit("mainEngineChanged"),this._chooseEffectiveZoomRounding(),this._handleRotatability(),this._mainEngine},e.prototype._isReadyToShowVector=function(t,e){var n=0,o=0,i=0,r=0,a=0,s=0;return this._mainLayers.forEach((function(c){var u=t.getLayerReadyState(c.id);u&&(r+=u.tilesTotal,i+=u.tilesReady),u&&(a+=u.graphicsTotal,s+=u.graphicsReady);var l=null==e?void 0:e.getLayerReadyState(c.id);l&&(o+=l.tilesTotal,n+=l.tilesReady)})),0!==r&&0!==i&&(0===o||s===a&&(i>=.75*r||i/r>=n/o))},e.prototype._finalizeSwitchingToVector=function(t){var e=this;if("transitionToVector"===this._mainEngine.type){var n=this._mainEngine.vector.engine;this._mainEngine.vector.animationAbortController=new a.AbortController;var o=this._mainEngine.vector.animationAbortController.signal,i=this._mainEngineContainer;this._mainEngineContainer=X("ymaps3x0--main-engine-container"),this._mainEngineContainer.appendChild(n.element),this._emit("vectorStart",{duration:t}),function(t,e,n){return new Promise((function(o,i){t.parentElement.insertBefore(e,t),n.addEventListener("abort",(function(){i()})),t.addEventListener("transitionend",(function(){ke(t),o()})),t.classList.add("ymaps3x0--hide"),getComputedStyle(t).opacity}))}(i,this._mainEngineContainer,o).then((function(){"transitionToVector"===e._mainEngine.type?e._switchMainEngineToVector(n):e._onVectorError(new Error("ymaps3: unexpected main engine state: ".concat(e._mainEngine.type)))})).catch((function(t){e._onVectorError(new Error("ymaps3: switch to vector aborted: ".concat(t)))}))}else this._onVectorError(new Error("ymaps3: unexpected main engine state: ".concat(this._mainEngine.type)))},e.prototype._handleRotatability=function(){var t,e=this,n=Object(i.c)(Object(i.c)([],this._topRasterLayers,!0),"vector"!==this._mainEngine.type?this._mainLayers:[],!0).every((function(t){return!e._nonRotatableRasterSources.has(t.source)}));null===(t=this.behaviors)||void 0===t||t.mapToggleRotation(n),!n&&(0!==this._camera.azimuth||this._camera.tilt>0)&&(this._camera=Object(i.a)(Object(i.a)({},this._camera),{azimuth:0,tilt:0}),this._update())},e.prototype._assertLayersIsValid=function(t,e){for(var n=0,o=e;n<o.length;n++){var a=o[n].source,s=this._dataSourceDescriptions[a];s?"tile"!==s.type||s.hasOwnProperty("vector")?"indoor"!==a||"tile"===s.type&&s.vector&&s.vector.indoorPlanUrl||Object(Q.c)(new Error('Source "indoor" has a special meaning and must be a vector indoor data source.')):Object(Q.c)(new Error('Source "'.concat(a,'" in main engine does not have vector field'))):Object(Q.c)(new Error("Unknown data source ".concat(a)))}var c=Object(i.c)(Object(i.c)([],e,!0),t,!0).map((function(t){return t.id}));new r.Set(c)},e.prototype._destroyMainEngine=function(){this._mainEngine&&("vector"===this._mainEngine.type&&(this._mainEngine.setLayersAbortController&&this._mainEngine.setLayersAbortController.abort(),this._mainEngine.cursorController&&this._mainEngine.cursorController.destroy(),clearTimeout(this._mainEngine.initLayersTimer),ke(this._mainEngine.engine.element)),"transitionToVector"===this._mainEngine.type&&(this._mainEngine.vector.animationAbortController&&this._mainEngine.vector.animationAbortController.abort(),this._mainEngine.vector.setLayersAbortController&&this._mainEngine.vector.setLayersAbortController.abort(),clearTimeout(this._mainEngine.vector.initLayersTimer),this._mainEngine.vector.eventGroup.offAll(),ke(this._mainEngine.vector.engine.element),this._mainEngine.vector.engine.destroy()),this._mainEngine.eventGroup.offAll(),this._mainEngine.engine.destroy())},e.prototype._createTopEngine=function(){var t=this,e=new Nt(this._size,this._camera,this._renderLoop,this.worldOptions,this.projection,this._dataSources,(function(e){return t._mainEngine&&"vector"===t._mainEngine.type?function(t){var e=Math.floor(t);return t-e<.5?e:e+1}(e):Pe(e)}),!1);this._topEngineContainer.appendChild(e.element);var n=e.group().on("tilesReady",(function(){return t._emit("ready")})).on("tilesLoaded",(function(){return t._emit("loaded")})).on("stateChanged",(function(){return t._emit("stateChanged")})).on("hotspotsChanged",(function(){return t._emit("hotspotsChanged")}));return e.setLayers(this._topRasterLayers),e.setObjectFilters(this._filters),{topEngine:e,eventGroup:n}},e.prototype._update=function(){this._mainEngine.engine.update(this._camera,O),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.update(this._camera,O),this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov),this._renderLoop.update(),this._emit("update")},e.prototype._subscribeToDomEvents=function(){this.container.addEventListener("contextmenu",(function(t){return t.preventDefault()}))},e.prototype.convertScreenToWorldCoordinates=function(t){var e=t.clientX,n=t.clientY,o=Object(U.c)({x:e,y:n},this);return{worldCoordinates:o,coordinates:this.projection.fromGlobalCoordinates(o)}},e.prototype._restrictZoom=function(t){var e=this.zoomRange,n=e.min,o=e.max;return Object(q.b)(t,n,o)},e.prototype._convertFeatureToWorld=function(t){var e=this,n=1/0,o=-1/0,i=1/0,r=-1/0;return{feature:Object(v.c)(t,(function(t){var a=e.projection.toGlobalCoordinates(t);if(e.worldOptions.cycledX){var s=t[0]<-180||t[0]>180?Math.round(t[0]/360):0;a.x+=2*s}return n=a.x<n?a.x:n,o=a.x>o?a.x:o,i=a.y<i?a.y:i,r=a.y>r?a.y:r,a})),bbox:{minX:n,maxX:o,minY:i,maxY:r}}},e.prototype._getFeaturesForDataSource=function(t){return this._featuresByDataSource.has(t)||this._featuresByDataSource.set(t,new r.Map),this._featuresByDataSource.get(t)},e.prototype._assertDataSourceExistence=function(t){},e.prototype._createDataSource=function(t){var e=t.type;return"geojson"===e?new Lt.a({disablePointGeometry:"mapsapi15139"!==this._devpreview.pointGeometry}):"tile"===e?new rt.a(t,this.worldOptions):"markers"===e?new Gt:"tile3d"===e?new Zt.a(t):null},e.prototype._chooseEffectiveZoomRounding=function(){var t,e=this._effectiveZoomRounding;if("auto"===this._zoomRounding?"vector"===this._effectiveMode&&0!==this._mainLayers.length?this._effectiveZoomRounding="smooth":this._effectiveZoomRounding="snap":this._effectiveZoomRounding=this._zoomRounding,e!==this._effectiveZoomRounding){if("snap"===this._effectiveZoomRounding){var n=Te(this._camera.zoom);this.setCamera(Object(i.a)(Object(i.a)({},this._camera),{zoom:n}))}null===(t=this.behaviors)||void 0===t||t._updateZoomRounding(),this._emit("zoomRoundingChanged")}},e.prototype._applyFilters=function(){this._mainEngine.engine.setObjectFilters(this._filters),this._topRasterEngine.setObjectFilters(this._filters),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setObjectFilters(this._filters)},e.prototype._applyInvisibleCollidingPrimitives=function(){this._mainEngine.engine.setInvisibleCollidingPrimitives(this._invisibleCollidingPrimitives),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setInvisibleCollidingPrimitives(this._invisibleCollidingPrimitives)},e.prototype._toMapObject=function(t){var e=this;if(!t)return t;if("raw-hotspot"===t.type){var n=Object(i.a)(Object(i.a)({},t.feature),{geometry:t.feature.geometry&&Object(v.d)(t.feature.geometry,(function(t){var e=t[0];return[t[1],e]}))});return{type:"hotspot",layer:t.layer,source:t.source,feature:n}}if("hotspot"===t.type){var n=Object(i.a)(Object(i.a)({},t.feature),{geometry:t.feature.geometry&&Object(v.d)(t.feature.geometry,(function(t){return e.projection.fromGlobalCoordinates(t)}))});return{type:"hotspot",layer:t.layer,source:t.source,feature:n}}return"feature"===t.type?(n=this._getFeaturesForDataSource(t.source).get(t.featureId))?{type:"feature",layer:t.layer,source:t.source,feature:n}:null:"marker"===t.type?Object(i.a)(Object(i.a)({},t),{marker:t.marker}):"empty-object"===t.type?Object(i.a)({},t):null},e.prototype.updateCameraOptions=function(t){this._cameraOptions=Object(i.a)(Object(i.a)({},this._cameraOptions),t)},e.prototype._restrictCamera=function(t){var e=this._restrictZoom(t.zoom),n=this._cameraOptions.enabledTiltTransition;return{zoom:e,worldCenter:H.a.fitViewportToWorld(t.worldCenter,{zoom:e,worldOptions:this.worldOptions,size:this.size}),azimuth:Object(q.a)(t.azimuth,0,2*Math.PI),tilt:Object(q.b)(t.tilt,n?pt.d:pt.b,n?pt.c:pt.a)}},e}(Object(E.a)().with());function Me(t){var e=t.getBoundingClientRect(),n=e.top,o=e.left;return{size:{x:t.offsetWidth,y:t.offsetHeight},offset:{top:n,left:o}}}function Le(t,e){var n={};return t.map((function(t){var o="string"==typeof t?Object(ot.c)(t):t,i=Object(ot.b)(o);if(i.source===ot.a||e[i.source]||Object(Q.c)(new Error('Nonexistent data source "'.concat(i.source,'" in "').concat(o.id,'"'))),i.source!==ot.a&&"markers"===e[i.source].type)if(n[i.source]){var r='Marker data source "'.concat(i.source,'" is already used in layer "').concat(o.id,'". ');r+="Marker data source can be used to construct only one layer",Object(Q.c)(new Error(r))}else n[i.source]=!0;return i}))}function De(t,e){Object(b.a)(t);for(var n=Object(i.a)({},t),o=0,r=Object.keys(e);o<r.length;o++){var a=e[r[o]];if("tile"===a.type&&(a.zoomRange&&Object(b.a)(a.zoomRange),a.clampMapZoom)){var s=a.zoomRange||t;Object(b.b)(n,s,n)}}Object(b.a)(n)}function Ie(t){return t.id}function ke(t){t.parentElement&&t.parentElement.removeChild(t)}var Fe=n(108);function Ge(t){var e,n=function(){if(!t.behaviors.isInAction&&e){var n={x:e.clientX,y:e.clientY},o=Object(U.c)(n,t);t.preloadHotspotsInPoint(o)}},o=function(t){e=t,n()},i=t.behaviors.on("actionEnd",(function(){n()})),r=t.on("beforeDestroy",(function(){r.offAll(),i.offAll(),t.container.removeEventListener("mousemove",o)}));t.container.addEventListener("mousemove",o)}function We(t){var e,n=t.behaviors.on("actionStart",(function(){e&&(e.offAll(),e=void 0)})).on("actionEnd",(function(){e||t.behaviors.isInAction||(t.preloadHotspotsForViewport(),e=t.on("update",(function(){return t.preloadHotspotsForViewport()})))})),o=t.on("beforeDestroy",(function(){o.offAll(),n.offAll(),e&&(e.offAll(),e=void 0)}));e=t.on("update",(function(){return t.preloadHotspotsForViewport()}))}function Ze(t){var e=Object(rt.c)(t);return function(t,n,o,i){return function(t,e){if(e.aborted)return Promise.reject(new ct.a);var n=new XMLHttpRequest;n.open("get",t,!0);var o=n.abort.bind(n);e.addEventListener("abort",o);var i=new Promise((function(e,o){n.onload=function(){if(200===n.status)try{e(JSON.parse(n.responseText))}catch(i){Object(Q.b)(i),o(i)}else if(204===n.status)e(null);else{var t=new Error("Bad status code: ".concat(n.status));Object(Q.b)(t),o(t)}},n.onerror=function(){var e=new Error("Error on GET to ".concat(t,". ").concat(n.status,", ").concat(n.statusText,". ").concat(n.response));Object(Q.b)(e),o(e)},n.onabort=function(){return o(new ct.a)}}));return n.send(),Object(s.promiseFinally)(i,(function(){return e.removeEventListener("abort",o)}))}(e(t,n,o,1),i).then((function(t){if(!t||t.error&&404===t.error.code)return[];if(t.error)throw new Error("Server sent an error (code = ".concat(t.error.code,"): ").concat(t.error.message));return Object(v.b)(t.data).map((function(t){return{type:"rendered",feature:Be(t),geometry:Object(v.d)(t.properties.HotspotMetaData.RenderedGeometry,(function(t){return{x:t[0],y:t[1]}}))}}))})).catch((function(t){Object(Q.c)(t)}))}}function Be(t){var e=t.properties.URIMetaData;return{type:"Feature",id:String(t.properties.HotspotMetaData.id),geometry:t.geometry,properties:Object(i.a)(Object(i.a)({},t.properties),{uri:(e&&e.URIs[0]||{}).uri})}}var Ne=n(228);n.d(e,"polyfills",(function(){return Ye})),n.d(e,"YaMap",(function(){return Ae})),n.d(e,"MarkersDataSource",(function(){return Gt})),n.d(e,"eventify",(function(){return E.a})),n.d(e,"worldUtils",(function(){return H.a})),n.d(e,"QualityHint",(function(){return g.a})),n.d(e,"screenToWorldCoordinates",(function(){return U.c})),n.d(e,"transformFeatureCoordinates",(function(){return v.c})),n.d(e,"transformGeometryCoordinates",(function(){return v.d})),n.d(e,"flattenFeatures",(function(){return v.b})),n.d(e,"assertFeatureOrCollectionIdIsString",(function(){return v.a})),n.d(e,"computeStrokeStyle",(function(){return Fe.c})),n.d(e,"computeDrawingStyle",(function(){return Fe.a})),n.d(e,"computeGroupStyle",(function(){return Fe.b})),n.d(e,"createDevice",(function(){return I})),n.d(e,"DeviceActiveState",(function(){return y})),n.d(e,"Dragger",(function(){return G})),n.d(e,"WheelDevice",(function(){return W})),n.d(e,"ZoomDirection",(function(){return k})),n.d(e,"TwoFingersGestureRecognizer",(function(){return B})),n.d(e,"cycleRestrict",(function(){return q.a})),n.d(e,"restrict",(function(){return q.b})),n.d(e,"getDefaultZoomRange",(function(){return b.c})),n.d(e,"DblClickBehavior",(function(){return se})),n.d(e,"DragBehavior",(function(){return ae})),n.d(e,"PinchTiltRotateBehavior",(function(){return ce})),n.d(e,"RoundScrollZoomBehavior",(function(){return te})),n.d(e,"SmoothScrollZoomBehavior",(function(){return ne})),n.d(e,"Magnifier",(function(){return ue})),n.d(e,"Behaviors",(function(){return pe})),n.d(e,"OneFingerZoomBehavior",(function(){return le})),n.d(e,"ZoomStrategy",(function(){return Yt})),n.d(e,"RotateBehavior",(function(){return de})),n.d(e,"EventsManager",(function(){return be})),n.d(e,"loadHotspotsByPointerPosition",(function(){return Ge})),n.d(e,"loadHotspotsForViewport",(function(){return We})),n.d(e,"createYandexHotspotFetchFunction",(function(){return Ze})),n.d(e,"extractCopyrights",(function(){return Ne.a})),n.d(e,"vec2",(function(){return c})),n.d(e,"bbox2",(function(){return o})),n.d(e,"CustomDomLayer",(function(){return Wt.a})),n.d(e,"errorLoggerFactory",(function(){return Q.a}));var Ye=Object(i.a)(Object(i.a)(Object(i.a)({},r),a),s)},64:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return a}));var o=n(13),i=function(){return{min:0,max:21}},r=function(t){t.min>=t.max&&Object(o.c)(new Error("Invalid zoom range, min >= max (".concat(t.min," >= ").concat(t.max,")"))),(t.min<0||t.max<0)&&Object(o.c)(new Error("Invalid zoom range, min or max is less than zero (min=".concat(t.min," max=").concat(t.max,")")))},a=function(t,e,n){return void 0===n&&(n=i()),n.min=Math.max(t.min,e.min),n.max=Math.min(t.max,e.max),n}},65:function(t,e,n){"use strict";function o(t,e,n){return{x:t,y:e,z:n}}n.d(e,"e",(function(){return o})),n.d(e,"a",(function(){return i})),n.d(e,"d",(function(){return r})),n.d(e,"c",(function(){return a})),n.d(e,"m",(function(){return s})),n.d(e,"i",(function(){return c})),n.d(e,"j",(function(){return u})),n.d(e,"g",(function(){return l})),n.d(e,"f",(function(){return d})),n.d(e,"k",(function(){return h})),n.d(e,"l",(function(){return p})),n.d(e,"b",(function(){return _})),n.d(e,"h",(function(){return m}));var i=o(0,0,0);function r(t,e){return void 0===e&&(e=o(0,0,0)),e.x=t.x,e.y=t.y,e.z=t.z,e}function a(t,e,n){return void 0===n&&(n=o(0,0,0)),n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z,n}function s(t,e,n){return void 0===n&&(n=o(0,0,0)),n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n}function c(t,e,n){return void 0===n&&(n=o(0,0,0)),n.x=t.x*e.x,n.y=t.y*e.y,n.z=t.z*e.z,n}function u(t,e){return void 0===e&&(e=o(0,0,0)),function(t,e,n){return void 0===n&&(n=o(0,0,0)),n.x=t.x/e,n.y=t.y/e,n.z=t.z/e,n}(t,function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))}(t),e)}function l(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function d(t,e,n){void 0===n&&(n=o(0,0,0));var i=t.y*e.z-t.z*e.y,r=t.z*e.x-t.x*e.z,a=t.x*e.y-t.y*e.x;return n.x=i,n.y=r,n.z=a,n}function h(t,e,n){void 0===n&&(n=o(0,0,0));var i=Math.cos(e),r=Math.sin(e),a=t.y;return n.x=t.x,n.y=a*i-t.z*r,n.z=a*r+t.z*i,n}function p(t,e,n){void 0===n&&(n=o(0,0,0));var i=Math.cos(e),a=Math.sin(e);return t=t===n?r(t):t,n.x=t.x*i-t.y*a,n.y=t.x*a+t.y*i,n.z=t.z,n}var _={normal:o(0,0,1),distance:0};function m(t,e,n){void 0===n&&(n=o(0,0,0));var i=l(e.direction,t.normal);if(0===i)return null;var s=(t.distance-l(t.normal,e.origin))/i;return s<0?null:(r(e.direction,n),function(t,e,n){void 0===n&&(n=o(0,0,0)),n.x=t.x*e,n.y=t.y*e,n.z=t.z*e}(n,s,n),a(n,e.origin,n),n)}},80:function(t,e,n){"use strict";n.r(e),n.d(e,"AbortController",(function(){return o}));var o,i=n(8),r=n(11),a=window;if(a.AbortController)o=a.AbortController;else{var s=function(t){function e(e){var n=t.call(this)||this;return n.onabort=null,n._controller=e,n}return Object(i.b)(e,t),Object.defineProperty(e.prototype,"aborted",{get:function(){return this._controller.aborted},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(t,e){this.on(String(t),e)},e.prototype.removeEventListener=function(t,e){this.offSingle(String(t),e)},e.prototype.dispatchEvent=function(t){return this.onabort&&this.onabort(t),this._emit(t.type,t),!1},e}(Object(r.a)().with());o=function(){function t(){this._aborted=!1,this.signal=new s(this)}return t.prototype.abort=function(){if(!this._aborted){this._aborted=!0;var t=document.createEvent("Event");t.initEvent("abort",!1,!1),this.signal.dispatchEvent(t)}},Object.defineProperty(t.prototype,"aborted",{get:function(){return this._aborted},enumerable:!1,configurable:!0}),t}()}},81:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return s}));var o=n(80),i=n(25),r=n(82),a=n(13),s=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=function(t){t&&Object(a.b)(t),n(t)}}))},c=function(){function t(t){var e=this;this._queue=[],this._processing=[],this._paused=!1,this._changed=!1,this._onTaskAbort=function(t,n){var o=e._processing.indexOf(t);if(-1!==o)e._processing.splice(o,1);else{var i=e._queue.indexOf(t);-1!==i&&e._queue.splice(i,1),n.reject(new r.a)}},this._maxConcurrency=t}return t.prototype.enqueue=function(t,e){var n=this;void 0===e&&(e=0);var i=new o.AbortController,r=new s,a={task:t,abortController:i,process:function(){return t(i.signal).then(r.resolve,r.reject)},priority:e};return i.signal.addEventListener("abort",(function(){return n._onTaskAbort(a,r)})),this._queue.push(a),this._changed=!0,this._paused||this._process(),{abortController:i,promise:r.promise,updatePriority:function(){a.priority=e,n._changed=!0}}},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1,this._process()},t.prototype._process=function(){var t,e=this;if(!(this._processing.length>=this._maxConcurrency)){this._changed&&this._queue.sort((function(t,e){return t.priority-e.priority}));var n=this._queue.splice(0,this._maxConcurrency-this._processing.length);(t=this._processing).push.apply(t,n);for(var o=function(t){Object(i.promiseFinally)(t.process(),(function(){var n=e._processing.indexOf(t);-1!==n&&e._processing.splice(n,1),e._process()}))},r=0,a=n;r<a.length;r++){o(a[r])}}},t}()},82:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(8),i=function(t){function e(n){var o=t.call(this,void 0===n?"Aborted":n)||this;return o.name="AbortError",o.__proto__=e.prototype,o}return Object(o.b)(e,t),e}(Error)},83:function(t,e,n){"use strict";n.d(e,"a",(function(){return d})),n.d(e,"c",(function(){return h})),n.d(e,"b",(function(){return p})),n.d(e,"f",(function(){return f})),n.d(e,"h",(function(){return m})),n.d(e,"d",(function(){return y})),n.d(e,"e",(function(){return v})),n.d(e,"g",(function(){return _}));var o=n(8),i=n(10),r=n(17),a=n(12),s=n(16),c=n(98),u=n(65),l=n(13);function d(t,e,n,o){var i=a.divn(e,2*n),r=a.sub(t,i);a.divn(r,o,r),a.applyFunction(r,Math.floor,r);var s=a.add(t,i);return a.divn(s,o,s),a.applyFunction(s,Math.floor,s),{minX:r.x,minY:r.y,maxX:s.x,maxY:s.y}}function h(t,e,n,o,i){var r=a.divn(n,2*o);return[{x:r.x,y:r.y},{x:r.x,y:-r.y},{x:-r.x,y:-r.y},{x:-r.x,y:r.y}].map((function(t){return a.rotate(t,-e)})).map((function(e){return a.sub(t,e)})).map((function(t){return a.divn(t,i)}))}function p(t,e,n,s,c,d,h){var p={worldCenter:t,zoom:Object(i.mathLog2)(Math.pow(2,s)*c),azimuth:e,tilt:n},_=function(t,e,n,i,s){var c=e.worldCenter,d=e.tilt,h=e.azimuth,p=e.zoom,_={x:0,y:0,z:.5*-r.a.convertPixelSizeToWorldSize(n,p).y/Math.tan(.5*t)};u.k(_,d,_),u.l(_,h,_),u.c(_,Object(o.a)(Object(o.a)({},c),{z:0}),_);for(var m=Math.tan(.5*t),f=n.x/n.y,y=u.e(m*f,m,1),v=[u.d(u.a),u.d(u.a),u.d(u.a),u.d(u.a)],b=u.e(0,0,0),S={origin:_,direction:b},x=0;x<4;++x){u.i(g[x],y,b),u.k(b,d,b),u.l(b,h,b),u.h(u.b,S,v[x])||Object(l.c)(new Error("Visible quadrilateral is unbounded, engine can't handle that case (yet)"))}return v.map((function(t){var e=r.a.worldToPixels(t,i);return a.divn(e,s)}))}(Math.PI/6,p,d,s,h),m=function(t){for(var e=1/0,n=-1/0,o=[],i=0,r=1;i<t.length;++i,r=++r%t.length){var a=[t[i],t[(i+1)%t.length]].sort((function(t,e){return t.y-e.y})),s=a[0],c=a[1],u=Math.floor(s.y),l=Math.ceil(c.y);e=Math.min(e,u),n=Math.max(n,l);var d=(c.x-s.x)/(c.y-s.y),h=s.x-(isFinite(d)?d*(s.y-u):0);o.push({firstRow:u,lastRow:l,startX:s.x,endX:c.x,x:h,k:d})}for(var p=[],_=e;_<n;_++){for(var m=1/0,f=-1/0,y=0,v=o;y<v.length;y++){var g=v[y];if(!(_<g.firstRow||_>=g.lastRow)){var b=g.x+g.k,S=g.k>=0?Math.max(g.x,g.startX):Math.min(g.x,g.startX),x=g.k>=0?Math.min(b,g.endX):Math.max(b,g.endX);m=Math.floor(Math.min(m,S,x)),f=Math.ceil(Math.max(f,S,x)),g.x=b}}for(h=m;h<f;h++)p.push({x:h,y:_})}return p}(_),f=new i.Map;return m.forEach((function(t){return f.set(v(t,s),Object(o.a)(Object(o.a)({},t),{border:!1}))})),{tiles:f,tileBounds:_}}function _(t,e){return t.every((function(t){return Object(c.b)(e,t)}))}function m(t,e){return{x:Object(s.a)(t.x,0,e),y:Object(s.a)(t.y,0,e)}}function f(t,e,n){var o=t.x,i=t.y;return(n.cycledX||o<e&&o>=0)&&(n.cycledY||i<e&&i>=0)}function y(t,e){return Math.ceil(Math.pow(2,t+8)/e)}function v(t,e){return"".concat(t.x,".").concat(t.y,".").concat(e)}var g=[u.e(-1,1,-1),u.e(1,1,-1),u.e(1,-1,-1),u.e(-1,-1,-1)]},98:function(t,e,n){"use strict";function o(t,e){for(var n=e.x,o=e.y,i=t.length-1,r=!1,a=0;a<t.length;a++){var s=t[a].y<=o&&t[i].y>o||t[i].y<=o&&t[a].y>o,c=n>(t[i].x-t[a].x)*(o-t[a].y)/(t[i].y-t[a].y)+t[a].x;s&&c&&(r=!r),i=a}return r}function i(t,e){for(var n=1;n<t.length;n++)if(o(t[n],e))return!1;return o(t[0],e)}function r(t,e){if("Point"===t.type)return!1;if("LineString"===t.type)return!1;if("Polygon"===t.type)return i(t.coordinates,e);if("MultiPolygon"===t.type){for(var n=0,o=t.coordinates;n<o.length;n++){if(i(o[n],e))return!0}return!1}return!1}n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return r}))},99:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(10);function i(t,e,n,i,r,a){void 0===i&&(i=function(){}),void 0===r&&(r=function(){}),void 0===a&&(a=function(){return!0});var s=new o.Map,c=[],u=[],l=[];function d(t,e){i(t,e),l.push(t)}return e.forEach((function(e,o){var i=t.get(o);if(i&&a(i,e)?(r(i,e),u.push(i)):i&&(d(i,o),i=void 0),!i){var l=n(e);c.push(l),i=l}s.set(o,i)})),t.forEach((function(t,n){e.has(n)||d(t,n)})),{result:s,created:c,updated:u,removed:l}}}}]);